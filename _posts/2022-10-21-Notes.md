
<!-- vim-markdown-toc Redcarpet -->

* [Quick Notes](#quick-notes)
* [Nagios ; deploy](#nagios-deploy)
* [PTS ; r12.1 ; How to preserve the pts database when upgrading](#pts-r12-1-how-to-preserve-the-pts-database-when-upgrading)
* [DB ; create or upgrade DB](#db-create-or-upgrade-db)
* [PTS ; start stop processes](#pts-start-stop-processes)
* [PTS ; r12.1 ; Install a new PTS database](#pts-r12-1-install-a-new-pts-database)
  * [more database stuff](#more-database-stuff)
* [Java ; Install Java 11](#java-install-java-11)
* [Java ; Alternative install java](#java-alternative-install-java)
* [Java ; java version is not correct ,  or it requires to be in that location](#java-java-version-is-not-correct-or-it-requires-to-be-in-that-location)
* [Java ; Updating java to 11 on gwserver in f09 , to be able to use dekimo configurator](#java-updating-java-to-11-on-gwserver-in-f09-to-be-able-to-use-dekimo-configurator)
  * [Selection    Alternative](#selection-alternative)
  * [Selection    Path                                    Priority   Status](#selection-path-priority-status)
* [PTS database ; Renaming the old and new databases:](#pts-database-renaming-the-old-and-new-databases)
* [PTS ; How to preserve the pts database when upgrading](#pts-how-to-preserve-the-pts-database-when-upgrading)
* [PTS ; using the test virtual machine](#pts-using-the-test-virtual-machine)
* [r12 upgrade in Reading](#r12-upgrade-in-reading)
* [3par](#3par)
* [PTS ; upgrade in Caen](#pts-upgrade-in-caen)
  * [Issue 3 ; Delay from ambiguous instruction](#issue-3-delay-from-ambiguous-instruction)
  * [Issue 4 ; Gantry unable to home](#issue-4-gantry-unable-to-home)
  * [Issue 5 .  Quench!](#issue-5-quench)
  * [Issue 6. issue with motion vetos appearing](#issue-6-issue-with-motion-vetos-appearing)
  * [Dose received](#dose-received)
* [PTS ; blocking safety parameters](#pts-blocking-safety-parameters)
* [PTS ; updating SEW parameters](#pts-updating-sew-parameters)
* [Errors ; Relay check in BSS initialization](#errors-relay-check-in-bss-initialization)
* [PTS ; r12.1 ; random errors  ; may need to change the electrometer versions ?](#pts-r12-1-random-errors-may-need-to-change-the-electrometer-versions)
  * [18th Aug shift report](#18th-aug-shift-report)
* [PTS ; r12.1 ; List of tasks](#pts-r12-1-list-of-tasks)
* [PTS ; r12.1 ; user-db.csv](#pts-r12-1-user-db-csv)
* [PTS ; r12.1 ; PPSCU ; logs](#pts-r12-1-ppscu-logs)
* [PTS ; r12.1 ; Phase 1 ; Release 5; PTS 12.1](#pts-r12-1-phase-1-release-5-pts-12-1)
  * [Upgrade kits](#upgrade-kits)
  * [Prepare site configuration](#prepare-site-configuration)
  * [AI config update](#ai-config-update)
  * [usersdb.csv](#usersdb-csv)
  * [Prepare new PCU kernel](#prepare-new-pcu-kernel)
  * [Prepare CUs and safety keys](#prepare-cus-and-safety-keys)
  * [Update hand pendant apk from HPv3b to HPv3c](#update-hand-pendant-apk-from-hpv3b-to-hpv3c)
  * [Deploy PTS-12.1.0 clinically](#deploy-pts-12-1-0-clinically)
  * [Install the HPv3c apk](#install-the-hpv3c-apk)
  * [BDSIO upgrade - Needed for new temperature and pressure sensors](#bdsio-upgrade-needed-for-new-temperature-and-pressure-sensors)
  * [CU Cards](#cu-cards)
  * [Install new r12 to tcs and install an ER tag](#install-new-r12-to-tcs-and-install-an-er-tag)
  * [How to roll forward](#how-to-roll-forward)
  * [Update SEW drives](#update-sew-drives)
  * [Validations](#validations)
  * [Perform a mock treatment](#perform-a-mock-treatment)
  * [Perform the operational scenario, OPSC PTC-VTC-213](#perform-the-operational-scenario-opsc-ptc-vtc-213)
  * [Enter blcu checksum in to archestra after updating Archestra](#enter-blcu-checksum-in-to-archestra-after-updating-archestra)
  * [Collision avoidance calibration](#collision-avoidance-calibration)
  * [Update cogent bridge](#update-cogent-bridge)
* [PTS ; r12.1 ; Phase 2, Release 6, PTS 12.1 with ACU 4.0, Site config changes](#pts-r12-1-phase-2-release-6-pts-12-1-with-acu-4-0-site-config-changes)
  * [SCC PS V1 and V2, delay required on the water interlock, ramp down necessary](#scc-ps-v1-and-v2-delay-required-on-the-water-interlock-ramp-down-necessary)
* [PTS ; r12.1 ; Phase 3?, Release 7, ACU 4.0, SRSEU 4.0](#pts-r12-1-phase-3-release-7-acu-4-0-srseu-4-0)
  * [PTS ; r12.1 ; Caen ; Creation of site config RC instead of ER tag ,  check this is alread done for Caen ?](#pts-r12-1-caen-creation-of-site-config-rc-instead-of-er-tag-check-this-is-alread-done-for-caen)
  * [Get the CU checksums from vdog or from the tracking bug and enter them in the site configs](#get-the-cu-checksums-from-vdog-or-from-the-tracking-bug-and-enter-them-in-the-site-configs)
  * [Update the bdcu electrometers using dekimo configurator, and comment out the versions in the site config](#update-the-bdcu-electrometers-using-dekimo-configurator-and-comment-out-the-versions-in-the-site-config)
* [PTS ; r12.1 ; random Issues encountered](#pts-r12-1-random-issues-encountered)
  * [Beam stuck in EnablingBeam state](#beam-stuck-in-enablingbeam-state)
  * [Run a noise map](#run-a-noise-map)
  * [Firmware of BPMs and bcms1](#firmware-of-bpms-and-bcms1)
  * [try to shoot a map,](#try-to-shoot-a-map)
  * [T&P correction factor showing NaN](#t-amp-p-correction-factor-showing-nan)
  * [2kV EMIO](#2kv-emio)
  * [Error during beam enabled check activity. Error beam enabled still present after un-prepare burst. Timeout",](#error-during-beam-enabled-check-activity-error-beam-enabled-still-present-after-un-prepare-burst-timeout-quot)
* [PTS ; r12.1 ; Site team preliminaries](#pts-r12-1-site-team-preliminaries)
  * [Site team run MID 18829](#site-team-run-mid-18829)
  * [Collision Avoidance Calibration (MID 91046)](#collision-avoidance-calibration-mid-91046)
  * [Upgrade kits (UKs)](#upgrade-kits-uks)
  * [Weekend 1](#weekend-1)
  * [Weekend 2](#weekend-2)
  * [Weekend 3](#weekend-3)
  * [Install Cogent Bridge](#install-cogent-bridge)
  * [Weekend of 7/8 Aug](#weekend-of-7-8-aug)
  * [Site config updates](#site-config-updates)
  * [Updating the userdb.csv file in the site configs](#updating-the-userdb-csv-file-in-the-site-configs)
  * [Installation of bdcu](#installation-of-bdcu)
  * [Roll back archestra and historian](#roll-back-archestra-and-historian)
  * [Cards srcu and blcu back](#cards-srcu-and-blcu-back)
  * [safekey](#safekey)
* [PTS ; PCU](#pts-pcu)
* [Linux Terminal Server](#linux-terminal-server)
* [BDCU ; get log messages](#bdcu-get-log-messages)
* [Template ; mission report](#template-mission-report)
* [Control units ; Example session - update ACU code](#control-units-example-session-update-acu-code)
* [PTS ; may need ; Run the software manually:](#pts-may-need-run-the-software-manually)
* [PTS ; r12.1 ; Caen 15 July](#pts-r12-1-caen-15-july)
* [PTS ; r12.1 ; Connect laptop with hand pendant phone](#pts-r12-1-connect-laptop-with-hand-pendant-phone)
* [PTS ; r12.1 ; Troubleshoot HP problems:](#pts-r12-1-troubleshoot-hp-problems)
* [PTS ; r12.1 ; Possible issues that may help](#pts-r12-1-possible-issues-that-may-help)
  * [PTS ;  SRCU 4.2 ; srcu 4.1 ; 'no entry' light is permanently on](#pts-srcu-4-2-srcu-4-1-39-no-entry-39-light-is-permanently-on)
* [PTS ; r12.1 ; install dekimo configurator tool](#pts-r12-1-install-dekimo-configurator-tool)
* [PTS ; r12.1 ; set up the eideu](#pts-r12-1-set-up-the-eideu)
  * [Example in f10](#example-in-f10)
  * [Example in f15](#example-in-f15)
* [PTS ; r12.1 ; random issues](#pts-r12-1-random-issues)
  * [Room light command seems inverted when interacting with the HPv3](#room-light-command-seems-inverted-when-interacting-with-the-hpv3)
  * [update dekimo firmwares](#update-dekimo-firmwares)
  * [is temperature and pressure working?](#is-temperature-and-pressure-working)
  * [use AdaptPrescribe](#use-adaptprescribe)
  * [Collision avoidance issue](#collision-avoidance-issue)
* [PTS ; r12.1 ; preparing site config](#pts-r12-1-preparing-site-config)
* [3PAR ; set to maintenance mode:](#3par-set-to-maintenance-mode)
* [3par ; Troubleshoot the 3par](#3par-troubleshoot-the-3par)
* [3par ; Upgrade the vsp-3par firmware](#3par-upgrade-the-vsp-3par-firmware)
* [AI](#ai)
  * [global file has changed?](#global-file-has-changed)
  * [site wants to change something in local ?](#site-wants-to-change-something-in-local)
* [Archestra - set up a new user](#archestra-set-up-a-new-user)
* [Backups ; Set up backups](#backups-set-up-backups)
* [Backups ; Restoring from backup](#backups-restoring-from-backup)
* [Backups ; Using the tape autoloader](#backups-using-the-tape-autoloader)
* [Backups ; Changing the tape protection](#backups-changing-the-tape-protection)
* [Backups ; checking backups](#backups-checking-backups)
* [Backups ; Deal with a corrupted Leoni-acu or Leoni-mcu card](#backups-deal-with-a-corrupted-leoni-acu-or-leoni-mcu-card)
* [Backups - Generate barcodes for tapes](#backups-generate-barcodes-for-tapes)
* [Backups ; Configure the backup schedule in cron](#backups-configure-the-backup-schedule-in-cron)
  * [Example from Nice](#example-from-nice)
  * [Example from Bomarsund](#example-from-bomarsund)
* [Backups - Replace fair or poor tapes with new ones.](#backups-replace-fair-or-poor-tapes-with-new-ones)
* [Backups - How to access xomni in Reading f15](#backups-how-to-access-xomni-in-reading-f15)
* [Backups ; Using the screen command](#backups-using-the-screen-command)
* [BDSIO ; r12.1 ; Updating BDSIO firmware](#bdsio-r12-1-updating-bdsio-firmware)
* [Control units ; MID references](#control-units-mid-references)
* [Controlserver ; historian ; archestra ; Install a new Archestra (galaxy) version](#controlserver-historian-archestra-install-a-new-archestra-galaxy-version)
* [datarec ; getting irradiation logs ; getting data recorder logs](#datarec-getting-irradiation-logs-getting-data-recorder-logs)
* [datarec ; archive script for datarec files](#datarec-archive-script-for-datarec-files)
* [datarec ; archive datarec files using rsync](#datarec-archive-datarec-files-using-rsync)
* [Maintenance ; clean servers and workstations](#maintenance-clean-servers-and-workstations)
* [mcbackup ; set up Data protector](#mcbackup-set-up-data-protector)
* [mcrw1 ; Archestra ; put archestra start up script on to desktop](#mcrw1-archestra-put-archestra-start-up-script-on-to-desktop)
* [Operating - How to troubleshoot pauses when using the pristine beam](#operating-how-to-troubleshoot-pauses-when-using-the-pristine-beam)
* [Operating - Troubleshooting s1g](#operating-troubleshooting-s1g)
* [Operating - Beamline Vacuum loss](#operating-beamline-vacuum-loss)
* [Operating ; Ion source power supply dropping out](#operating-ion-source-power-supply-dropping-out)
* [PTS ; site configs ; r12.1 ; generate the collision avoidance config files](#pts-site-configs-r12-1-generate-the-collision-avoidance-config-files)
* [Controltools ; Install controltools VM](#controltools-install-controltools-vm)
* [mcrs3 ; Updating hosts file](#mcrs3-updating-hosts-file)
* [DNS](#dns)
* [Mcfirewall ; iba-firewall ; open a firewall](#mcfirewall-iba-firewall-open-a-firewall)
* [Template ; please open your firewall](#template-please-open-your-firewall)
* [Network ; customer side](#network-customer-side)
* [Fsecure ; install](#fsecure-install)
* [Fsecure ; upgrade](#fsecure-upgrade)
* [Fsecure ; recover from a lost admin password](#fsecure-recover-from-a-lost-admin-password)
* [F-secure ; update the license](#f-secure-update-the-license)
* [mcrouter ; switch-psr ; watchdog reset](#mcrouter-switch-psr-watchdog-reset)
* [Support ; contact Technogroup](#support-contact-technogroup)
* [Tools ; iba servers](#tools-iba-servers)
* [MPSS ; swap an mpss controller](#mpss-swap-an-mpss-controller)
* [IBA wallpaper](#iba-wallpaper)
* [RAID ; Show the RAID status](#raid-show-the-raid-status)
* [Travel ; how to book travel](#travel-how-to-book-travel)
* [Nagios ; Deploy nagios](#nagios-deploy-nagios)
* [Nagios ; Restart nagios service](#nagios-restart-nagios-service)
* [Nagios ; Dealing with this error 1](#nagios-dealing-with-this-error-1)
* [Nagios ; Is the communication between nagios and the remote host using SSL?](#nagios-is-the-communication-between-nagios-and-the-remote-host-using-ssl)
* [Nagios ; Nrpe running on the remote machine?](#nagios-nrpe-running-on-the-remote-machine)
* [Nagios ; Issue with users / contacts ?](#nagios-issue-with-users-contacts)
* [Nagios ; How to install Nagios NSClient++](#nagios-how-to-install-nagios-nsclient)
* [Nagios ; Idea: Use the Nagios Remote Data Sender (NRDS)](#nagios-idea-use-the-nagios-remote-data-sender-nrds)
* [Nagios ; zypper update breaks the nagios set-up](#nagios-zypper-update-breaks-the-nagios-set-up)
* [Nagios ; check_load plugin](#nagios-check_load-plugin)
* [Nagios ; configs v1 update](#nagios-configs-v1-update)
* [Nagios ; Network ; xinetd](#nagios-network-xinetd)
* [Network ; control unites ; scalance ; profinet devices](#network-control-unites-scalance-profinet-devices)
* [IBA office file shares](#iba-office-file-shares)
* [Network ;  troubleshoot](#network-troubleshoot)
* [Network ; Reading ; Port Patching](#network-reading-port-patching)
* [PCU](#pcu)
* [Network ; customer side](#network-customer-side)
* [Network ; Accessing customer shared drive from adapt insight pc ; ppvs ws](#network-accessing-customer-shared-drive-from-adapt-insight-pc-ppvs-ws)
* [mcrouter ; commands](#mcrouter-commands)
* [Network ; Dealing with a port loop protecction](#network-dealing-with-a-port-loop-protecction)
* [Office file share server ; how to find ip of network folder](#office-file-share-server-how-to-find-ip-of-network-folder)
* [Network ; troubleshooting](#network-troubleshooting)
* [mcrouter ; switch-psr ; dealing with the watchdog reset issue](#mcrouter-switch-psr-dealing-with-the-watchdog-reset-issue)
* [Leoni](#leoni)
* [Network ; Reading ; Port Patching](#network-reading-port-patching)
* [Operation scenario ; Generate plans for the operation scenario](#operation-scenario-generate-plans-for-the-operation-scenario)
* [Leoni webpage](#leoni-webpage)
* [PTS ; Install components separately](#pts-install-components-separately)
* [PTS ; How to recurse through site config .properties files](#pts-how-to-recurse-through-site-config-properties-files)
* [PTS ; How to create the folder on the desktop to the PTS tools](#pts-how-to-create-the-folder-on-the-desktop-to-the-pts-tools)
* [PTS ; How to install the Access-point Software Kit (ASK)](#pts-how-to-install-the-access-point-software-kit-ask)
* [PTS ; Backup the previous installation/runtime/environment:](#pts-backup-the-previous-installation-runtime-environment)
* [PTS ; site config](#pts-site-config)
  * [Get the installation script/files:](#get-the-installation-script-files)
  * [Run the installation script:](#run-the-installation-script)
* [PTS ; Install individual PTS process](#pts-install-individual-pts-process)
* [Workspace](#workspace)
* [PTS ; how to start TCS and clinical environments](#pts-how-to-start-tcs-and-clinical-environments)
* [PTS ; Example cases of looking in logs](#pts-example-cases-of-looking-in-logs)
* [PTS ; Install individual PTS process](#pts-install-individual-pts-process)
* [PTS ; How to bypass checksums](#pts-how-to-bypass-checksums)
* [PTS ; Viewing PTS configs](#pts-viewing-pts-configs)
* [Idea ; Test environment](#idea-test-environment)
* [Control units](#control-units)
* [Control units ; MMC cards : Flashing the cards](#control-units-mmc-cards-flashing-the-cards)
* [Control Units ; Updating the modules in Automation Studio](#control-units-updating-the-modules-in-automation-studio)
* [Control units ; Fixing an issue with the Siemens Prommer](#control-units-fixing-an-issue-with-the-siemens-prommer)
* [Control units ; Editing the Config.txt file](#control-units-editing-the-config-txt-file)
* [Control units ; Buying the CU cards](#control-units-buying-the-cu-cards)
* [Control units ; PLC battery warning light is on](#control-units-plc-battery-warning-light-is-on)
  * [Example: ACU code update](#example-acu-code-update)
  * [Leoni ACU issue](#leoni-acu-issue)
* [Change CU cards](#change-cu-cards)
* [Pridex ; Opening a route from pridex to nagios](#pridex-opening-a-route-from-pridex-to-nagios)
* [Pridex ; Validating pridex installation](#pridex-validating-pridex-installation)
* [PTS ; install BMS separately](#pts-install-bms-separately)
* [Linux ; commands](#linux-commands)
* [Linux ; updating the OS ; before updating OS , make a rear backup](#linux-updating-the-os-before-updating-os-make-a-rear-backup)
* [Remote desktop ; dealing wiht the license issue](#remote-desktop-dealing-wiht-the-license-issue)
* [SUSE ; update the registration key](#suse-update-the-registration-key)
* [SCCHDRVM ; install](#scchdrvm-install)
* [Pridex Instructions on how to integrate Nagios logs to Pridex](#pridex-instructions-on-how-to-integrate-nagios-logs-to-pridex)
* [PTS ; site config ; Update site configuration](#pts-site-config-update-site-configuration)
  * [Install the config to tcs environment](#install-the-config-to-tcs-environment)
  * [Update the bug](#update-the-bug)
  * [send the email](#send-the-email)
  * [Install the config to tcs environment](#install-the-config-to-tcs-environment)
  * [Update the bug](#update-the-bug)
  * [send the email](#send-the-email)
* [PTS ; Checksums](#pts-checksums)
* [Pridex ; References](#pridex-references)
* [Pridex ; Fixing Pridex issues](#pridex-fixing-pridex-issues)
* [Pridex ; Troubleshooting pridex logs not being sent](#pridex-troubleshooting-pridex-logs-not-being-sent)
  * [Post IoT deployment :](#post-iot-deployment)
  * [Pre IoT deployment](#pre-iot-deployment)
  * [Examples](#examples)
* [SRCU ; Put SRCU in power maintain](#srcu-put-srcu-in-power-maintain)
* [SRCU ; How to start the SRCU with a new program stored on a memory card](#srcu-how-to-start-the-srcu-with-a-new-program-stored-on-a-memory-card)
* [ssh](#ssh)
* [Synergy ; Install](#synergy-install)
* [Disk space ; extend a logical volume](#disk-space-extend-a-logical-volume)
  * [Decrypt the password.txt file](#decrypt-the-password-txt-file)
  * [Edit the password.txt file](#edit-the-password-txt-file)
  * [Set up gpg for editing the password.txt file](#set-up-gpg-for-editing-the-password-txt-file)
* [Archiving ; LUTs](#archiving-luts)
* [Disk space ; extend a logical volume](#disk-space-extend-a-logical-volume)
* [nfs ; set it up](#nfs-set-it-up)
* [RAID ; show status](#raid-show-status)
* [Sysadmin ; power cycle servers](#sysadmin-power-cycle-servers)
* [trxt12 ; Update sudo for Raspbian Jessie](#trxt12-update-sudo-for-raspbian-jessie)
* [Shutting down and restarting the infrastructure](#shutting-down-and-restarting-the-infrastructure)
* [Troubleshooting ; finding info](#troubleshooting-finding-info)
* [trxt12 ; raspberry pi](#trxt12-raspberry-pi)
* [nix](#nix)
* [Backup ; use rsync](#backup-use-rsync)
* [what is this?](#what-is-this)
* [datarec ; recdata](#datarec-recdata)
* [socks proxy](#socks-proxy)
* [Infrastructure ; network equipment](#infrastructure-network-equipment)
* [ssh ; key sync](#ssh-key-sync)
* [trxt12 ; raspberyy pi image](#trxt12-raspberyy-pi-image)
* [stop a raspberry pi going to sleep](#stop-a-raspberry-pi-going-to-sleep)
* [bug 110163 # VNC server](#bug-110163-vnc-server)
* [VNC client](#vnc-client)
* [vnc ; Providing password on stdin](#vnc-providing-password-on-stdin)
* [Caen pi for vnc (mcrxt1)](#caen-pi-for-vnc-mcrxt1)
* [vnc ; Miscellaneous](#vnc-miscellaneous)
* [vcenter ; Install vsphere client on laptop](#vcenter-install-vsphere-client-on-laptop)
* [Vcenter ; command line](#vcenter-command-line)
  * [Vcenter version 5:](#vcenter-version-5)
  * [Vcenter version 6.5](#vcenter-version-6-5)
  * [Vcenter version 6.7](#vcenter-version-6-7)
  * [vcenter certificates](#vcenter-certificates)
* [wifi ; in f09](#wifi-in-f09)
* [wifi ; in f10](#wifi-in-f10)
* [wifi ; To see which wireless access point one is connected to](#wifi-to-see-which-wireless-access-point-one-is-connected-to)
* [wifi ; in f15](#wifi-in-f15)
* [Personal ; How to backup and restore WSL2](#personal-how-to-backup-and-restore-wsl2)
* [pcvibration ; Viewing the pycpic app](#pcvibration-viewing-the-pycpic-app)
  * [Using x server](#using-x-server)
  * [Using vnc](#using-vnc)
  * [Run the picoscope app on pcvibration](#run-the-picoscope-app-on-pcvibration)
* [pcvibration ; troubleshooting](#pcvibration-troubleshooting)
* [security ; A local privilege escalation vulnerability](#security-a-local-privilege-escalation-vulnerability)
* [Personal ; svn stuff](#personal-svn-stuff)
  * [svn renaming a branch](#svn-renaming-a-branch)
* [To sort ; Random pictures](#to-sort-random-pictures)
* [passwords](#passwords)
  * [PTS ; r12.1 ;  People to help with the upgrade](#pts-r12-1-people-to-help-with-the-upgrade)
* [PTS ; r12.1 ; BDSIO ; updating firmware ; Questions](#pts-r12-1-bdsio-updating-firmware-questions)
* [Send to site before doing an intervention](#send-to-site-before-doing-an-intervention)
* [Network drives](#network-drives)

<!-- vim-markdown-toc -->

# Quick Notes

wap-gantry S16 MAC:D04DC6C2553A

wap-vault B25 SP5-5 MAC:F8369B37BB08

wap-mcr S60 MAC:D04DC6C228D2

wap-toolroom S43 MAC:D04DC6C230D0

wap-wcr B1 SP5-5  MAC:D04DC6C24C72

wap-stockroom S45 MAC:B0B867CA99E8

wap-psr SP6-6 MAC:D04DC6C23DE8


# Nagios ; deploy 

See the git repos:

git@github.com:cptfinch/nagios-windows-hosts.git
git@github.com:cptfinch/nagios-ansible.git
git@github.com:cptfinch/nagios-configs.git



	
# PTS ; r12.1 ; How to preserve the pts database when upgrading

How do we add the customer qa plans? 
for adding customer qa plans to the r12.1 clinical database , 
will need to copy the present clinical database to a new name , 
start up adapt prescribe in tcs pointing to a fresh clinical database pts_clinical, add the plans , and then save the database to a temporary name and then rename the r11 clinical db back to pts_clinical .


# DB ; create or upgrade DB

mcrs3:~ # dbUpgrade

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

psql -d pts_clinical -U trcsd -W -h mcrs3 -f createDB/createPTSDB.sql

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_default_role_manager_setup.ddl

mcrs3:~ # hostname -a

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.1_to_12.0.2.ddl

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0_to_test.ddl

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0_to_test.ddl > db-upgrade.txt

psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0.ddl

sudo -u postgres psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0.ddl

psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0.ddl

cd createDB/

tcsadmin@mcrs3:/root> cd

./install PTS 12.1.0 SBF.110 PTS-12.0b-RC5

createdb pts_test_12-0-2 -U trcsd -W -h mcrs3

createdb pts_test_12-0-2 -U trcsd -W -h mcrs3 -f createDB/createPTSDB.sql

As root:

createdb pts_clinical -U trcsd -W -h mcrs3

createdb pts_test_12-0-2 -U trcsd -W -h mcrs3





apply the sql scripts provided by the PTS to the database. 

does it need new database ?   or upgrade existing one? 

Stop the currently running software. 

cd  $INSTALL_PATH/runtime/renovated/pts-adminTools 

This folder above not exists? then do this following snip:

---

cd /$INSTALL_PATH/runtime/renovated/pts-adminTools/runtime

As the required UNIX user (so clinical or tcs), create a temporary location in the HOME directory. Checkout database scripts associated with the PTS you are installing.

cd ~

mkdir databaseScripts

svn co http://subversion.lln.iba/repos/tc/alcyone/tags/<ptsVersion>/tools/db_scripts/src/main/resources/runtime/ .

---

In the case of a new database, create a DB and apply the creation scripts.  This should be done when testing a new version of the software, or during a clinical upgrade if arrangements have been made with the customer to allow for a blank database. 

createdb <dbName> -U trcsd –W –h mcrs3

psql –d <dbName> -U trcsd –W –h mcrs3 –f createDB/createPTSDB.sql

If an existing database must be upgraded, first create a backup of the existing and then apply the upgrade scripts. The scripts themselves are created to manage PTS deltas, therefore more than 1 script may have to be applied in order to account for the full delta. 

pg_dump <dbName> > <dbName_bkup.sql>

psql –d <dbName> -U trcsd –W –h mcrs3 –f upgradeDB/dbUpgrade_<initialVersion>_to_targetVersion>.ddl



I ran this (as root)

mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime # createdb pts_12-2 -U trcsd -W -h mcrs3

then it asks for a password , I provided the trcsd jdbc password which is 12345

mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime # psql -d pts_12-2 trcsd -W -h mcrs3 -f createDB/createPTSDB.sql





tcsadmin@mcrs3:/root> cd

./install PTS 12.1.0 SBF.110 PTS-12.0b-RC5

createdb pts_test_12-0-2 -U trcsd -W -h mcrs3

createdb pts_test_12-0-2 -U trcsd -W -h mcrs3 -f createDB/createPTSDB.sql

As root:

createdb pts_clinical -U trcsd -W -h mcrs3

createdb pts_test_12-0-2 -U trcsd -W -h mcrs3

sudo -u postgres createdb pts_12-2 -U trcsd -W -h mcrs3


# PTS ; start stop processes 

./start_stop.sh 27 TR_NB=1 LOCAL_CLASSPATH=/TCS/RuntimeStore/tcs/workspace/localConfig

./start_stop.sh -o 27 TR_NB=1 LOCAL_CLASSPATH=/TCS/RuntimeStore/tcs/workspace/localConfig

the -o dumps loads of stuff ;  go to the top to see the print out of the process and container. 

how to proceed?
First ,  is my AH_NEWCGTR file ok ? actually it is pts-poss-positioning.sh file,   or is it still altered ?   was a backup made ? look in the folder /TCS/runtimeStore/tcs/runtime/renovated on mcrs3

here is a pic of the file that henri changed. 
files/2022-03-06-06-23-54.png

Then i opened mcrw , and the process monitor , saw it is still red.  but is it generating a log file now ?  have a look , in /TCS/runtimeStore/log/output

yes generating a log file ;  this is with leuven , in room ct ;  so maybe change this file , or put bomar in place ; 

vim /TCS/runtimeStore/log/output/pts-poss-positioning-proc-1-20220306_063253.log

Errors to deal with : 
2022-03-06T06:32:53.373 [ INFO] {container/063253:main} (tcs.poss.RecurrentActionDateStore) - Creating action store: weight check
2022-03-06T06:32:53.373 [ERROR] {container/063253:main} (tcs.poss.RecurrentActionDateStore) - Bad pointer to file /TCS/workspace/runtime/PMS/tcr 1/WeightCheck.txt to read

ok now try again with the start stop script
tcs@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated> ./start_stop.sh 27 TR_NB=1 LOCAL_CLASSPATH=/TCS/RuntimeStore/tcs/workspace/localConfig
Then check out the log file -- ok it is there still 

now put back the old file ;  just to see that indeed it brakes it ;  where is the old file ?   i have some in /tcs_usr/tcsadmin/temp1
sure enough after running the start stop script ,  there is no new log generated ;  it crashes before even starting.. 
look in the -o  output of the start stop script to view what henri added for the process name and container name.. 
he found they got swapped somehow .. 


ok , first add in the stuff from the file FFformat-corrected/config.properties  to  bomarsunds file..  first make a copy of bomarsunds file . and enter itinto 
this. go to /TCS/runtimeStore/tcs/workspace/runtime/..

First , see if can run just wiht an empty file created with touch .. 
no it didn't run ,  maybe cos nothing in the file ?   when i say didn't work i mean there is no log file generated. 

tcsadmin@mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig/runtime/SBF.115/TR1/positioning-process/resources> cat config.properties.BROKEN >> config.properties
hmm ,  still nothiing generated ,  now going back to the bomarsund version .. 

ok , bomarsund works . 
maybe it is the 3 lines at the end ...  
put them in the broken one. 
 :%s/\r$//

./start_stop.sh tcr -s TR_NB=1 LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig

First try putting bomar in place .. 
/TCS/runtimeStore/tcs/workspace/localConfig/runtime/SBF.115/TR1/positioning-process/resources

mark saw that it was altered  , maybe he tried running the room with the start_stop script and there was a warning about checksum because this file was changed?

ok , put back the original file somehow ,  from the backup maybe ,;  or do i need to reinstall the tcs ,  after first backing up this altered file ! ?

next, 
run the start_stop script with an empty config.properties file ; 

then ,  use the file from svn , copy the stuff in , line by line ?  and then see if works. 

also , if it is going wrong , can i use the altered version of the pts-poss-positioning.sh file from henri , which gave extra info , but not the one 
where it alters the actual code by hardcoding the name ;  comment /uncomment that part..    if i can use that then i can see extra info , showing
this problem of it mising up hte order of the names. 

finally ,  you may have the working file ; and then troubleshoot the remaining issues it mentions.. 


# PTS ; r12.1 ; Install a new PTS database

DB connection is defined in the site.properties file in the site configs.

Database installation instructions: mid51900 

If the PTS installation requires a database schema change, apply the sql scripts in the PTS checkout to the associated database. 

Generate a new database, or upgrade the existing one.  

Stop the currently running software.  

Check the folder at $INSTALL_PATH/runtime/renovated/pts-adminTools exist or not, if exist, go into this folder and skip step 3.  

cd /$INSTALL_PATH/runtime/renovated/pts-adminTools/runtime 

As the required UNIX user (so clinical or tcs), create a temporary location in the HOME directory. Checkout database scripts associated with the PTS you are installing. 

cd ~ 

mkdir databaseScripts 

svn co http://subversion.lln.iba/repos/tc/alcyone/tags/<ptsVersion>/tools/db_scripts/src/main/resources/runtime/ . 

sIn the case of a new database, create a DB and apply the creation scripts.  This should be done when testing a new version of the software, or during a clinical upgrade if arrangements have been made with the customer to allow for a blank database.  

createdb <dbName> -U trcsd –W –h mcrs3 

psql –d <dbName> -U trcsd –W –h mcrs3 –f createDB/createPTSDB.sql 

If an existing database must be upgraded, first create a backup of the existing and then apply the upgrade scripts. The scripts themselves are created to manage PTS deltas, therefore more than 1 script may have to be applied in order to account for the full delta.  

pg_dump <dbName> > <dbName_bkup.sql> 

psql –d <dbName> -U trcsd –W –h mcrs3 –f upgradeDB/dbUpgrade_<initialVersion>_to_targetVersion>.ddl 

Get install scripts: 

Export the installation scripts from subversion repository to home directory on mcrs3: 

http://subversion.lln.iba/repos/tc/alcyone/tags/PTS-11.0.3.2/tools/db_scripts/src/main/resources/runtime/   

If this folder exists, $INSTALL_PATH/runtime/renovated/pts-adminTools , then you already have the correct scripts from the PTS install.  Therefore no need to export from svn. 

Create database (as user cfinch - because need permissions for the script to change directory to <tcs env root>/runtime/createdb/ )  

createdb <dbName> -U trcsd –W –h mcrs3 

(password 12345 , or look in site.properties for the password )

Create schema 

psql –d <dbName> -U trcsd –W –h mcrs3 –f createDB/createPTSDB.sql  

in site.properties:-        jdbc.username = trcsd  

Same database user should be used for pts_test and pts_clinical so that same site.properties can be used on tcs and clinical environments 

How to change the clinical db from pts_clinical to a differently named db: 

set the environment variable PTS_CLINICAL_DB to the new database name 

install the new clinical environment - the installation script will set the new db name in the clinical start-up scripts  

these clinical start-up scripts will refer to this new db name for starting up the environment going forward.

pts_test 

pts_clinical 

are both on mcrs3 

Update Postgres db:

Create a dump of the current pts_test used in 11.0.4

Apply the update scripts in PTS-12.0.2\tools\db_scripts\src\main\resources\runtime\upgradeDB\     :

dbUpgrade_PTS10.0.0_to_12.0.0.ddl

dbUpgrade_PTS12.0.0_default_role_manager_setup.ddl

dbUpgrade_PTS12.0.0_to_12.0.1.ddl

dbUpgrade_PTS12.0.1_to_12.0.2.ddl

## more database stuff 

postgres=# DROP DATABASE testdb;
pay attention to the last ";"
or else, psql won't commit the command you input
the creation of database commands is done outside of psql prompt
so no need for  ;  
only need ";"  if running an sql query 

pts_test_12-0-2=# \d dbversions
I rerun the script of createPTSDB.sql

tcsadmin@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime/createDB> psql -d pts_test_12-0-2 -U trcsd -W -h mcrs3 -f createPTSDB.sql Password for user trcsd:
psql -d pts_test2 -U trcsd -W -h mcrs3 -f ./createPTSDB.sql 

# Java ; Install Java 11

on mcrs3

![](files/2022-02-19-07-38-10.png)

downloaded to root's home drive then 

mv ./amazon-corretto-11.0.8.10.1-linux-x64.tar.gz /opt

cd /opt

tar xvf amazon-corretto-11.0.8.10.1-linux-x64.tar.gz

mv ./amazon-corretto-11.0.8.10.1-linux-x64 /products/.

cd /products/

ln -sf amazon-corretto-11.0.8.10.1-linux-x64/ java11

ln -s amazon-corretto-11.0.8.10.1-linux-x64 java11

cd /usr/bin

update-alternatives --config java

update-alternatives --install /usr/bin/java java /opt/java11/bin/java 10

java -version

datarec:~ # which java

datarec:~ # java -version

ls -lahtr /usr/bin/java

ls /opt -lahtr

update-alternatives --config java

update-alternatives --install /usr/bin/java java /opt/java11/bin/java 10

java -version

update-alternatives --config java

java -version

Install Amazon Corretto 11 on Debian-Based Linux.

This section describes how to install and uninstall Amazon Corretto 11 on a host or container running a Debian-based operating system.

Using apt.

To use the Corretto Apt repositories on Debian-based systems, such as Ubuntu, import the Corretto public key and then add the repository to the system list by using the following commands:

wget -O- https://apt.corretto.aws/corretto.key | sudo apt-key add - 

sudo add-apt-repository 'deb https://apt.corretto.aws stable main'

After the repo has been added, you can install Corretto 11 by running this command:

sudo apt-get update; sudo apt-get install -y java-11-amazon-corretto-jdk

From <https://docs.aws.amazon.com/corretto/latest/corretto-11-ug/generic-linux-install.html> 

# Java ; Alternative install java

downloaded it to root's home folder
unzip with tar -xvf   ?  
later you can remove gz file after java is correctly installed
ok , actually command is 'tar xf'  ,  without the -
just link it to /opt/java11/
tcs@mcrs3:/opt> ll | grep java lrwxrwxrwx 1 root root  17 Mar  3  2014 java1.6 -> /products/java1.6 lrwxrwxrwx 1 root root  17 Mar  3  2014 java1.7 -> /products/java1.7 lrwxrwxrwx 1 root root  17 Oct 27  2015 java1.8 -> /products/java1.8
mv the unzipped folder to /products/java11

they are kept in  products 
/opt/java11
mcrs3:~ # ll /usr/bin/java lrwxrwxrwx 1 root root 31 Mar 22  2018 /usr/bin/java -> /usr/java/jdk1.8.0_161/bin/java

also link /usr/bin/java to /opt/java11

ln -sf           this command will change the existing link

/usr/bin/java -> /opt/java11/bin/java
mcrs3:/opt/java11/bin # java -version openjdk version "11.0.8" 2020-07-14 LTS OpenJDK Runtime Environment Corretto-11.0.8.10.1 (build 11.0.8+10-LTS) OpenJDK 64-Bit Server VM Corretto-11.0.8.10.1 (build 11.0.8+10-LTS, mixed mode)

tcsadmin@mcrs3:/TCS/runtimeStore/log/output> ll total 44 -rw-r--r-- 1 tcs tcs 36268 May 15 08:28 pts-notif-server--20210515_082844.log -rw-r--r-- 1 tcs tcs  4819 May 15 08:28 pts-startstop-0-20210515_082754.log

Pre-start. ./start_stop.sh not called by start_stop_TCS -> we still have to check the CRC checksums. Checking CRC integrity... CRC check Successful! Starting beamCommonProcess on gwserver with sh. Starting pts-beam-common-process Install/reboot ECUBTCU : No file /TCS/runtimeStore/tcs/runtime/vxWorks/vxworks.config found, skipping ECUBTCU reboot. WARNING: we add /TCS/runtimeStore/tcs/workspace/localConfig:../../workspace/localConfig to the standard classpath - You should know what you are doing ! Starting process without wrapper Launching pts-beam-common-process for site SBF.110    Command line:    exec /opt/java11/bin/java -Dsun.java2d.xrender=false -Xmx8192m -Xms512m -XX:+UseG1GC -XX:OnOutOfMemoryError='kill -9 %p'  -cp "/TCS/runtimeStore/tcs/workspace/localConfig:../../workspace/localConfig:sites-processConfig-SBF.110.jar:pts-beam-common-process.jar:pts-allIComP.jar:pts-allCOTS.jar" com.iba.icomp.core.launch.Launcher "config/pts/beamCommonProcess/container.xml" -Dconfig.siteId=SBF.110 -Dcontainer.processName=beamCommonProcess -Dlogback.appender.filelog.file=/TCS/runtimeStore/log/output/pts-beam-common-process--20210515_090047.log -Dcontainer.place=mcr -Dcomm.notif.port=18386 -Dbms.ecubtcu.programId=55555129 -Dicompx.ui.i18n.defaultLanguage=english -Ddebug-launch=true  ; ... sh: line 1: /opt/java11/bin/java: No such file or directory sh: line 1: exec: /opt/java11/bin/java: cannot execute: No such file or directory
Post-start. Done.


# Java ; java version is not correct ,  or it requires to be in that location

http://nexus.lln.iba/#browse/browse:assets

the latest java will be compatible with all previous PTS version

download the tar.gz 

wget http://nexus.lln.iba/repository/assets/com/iba/assets/amazon-corretto/11.0.8.10.1/amazon-corretto-11.0.8.10.1-linux-x64.tar.gz

then unzip it

directly wget it in mcrs3

How to update java on mcrs3, gwserver and datarec

downloaded it to root's home folder

unzip with tar -xvf  ;  or tar xf

later you can remove gz file after java is correctly installed

link it to /opt/java11/

tcs@mcrs3:/opt> ll | grep java 
lrwxrwxrwx 1 root root  17 Mar  3  2014 java1.6 -> /products/java1.6 
lrwxrwxrwx 1 root root  17 Mar  3  2014 java1.7 -> /products/java1.7 
lrwxrwxrwx 1 root root  17 Oct 27  2015 java1.8 -> /products/java1.8

mv the unzipped folder to /products/java11

mcrs3:~ # ll /usr/bin/java 

lrwxrwxrwx 1 root root 31 Mar 22  2018 /usr/bin/java -> /usr/java/jdk1.8.0_161/bin/java

also link /usr/bin/java to /opt/java11

delete this link

ln -sf           this command will change the existing link

mcrs3:~ # ll /usr/bin/java lrwxrwxrwx 1 root root 11 May 15 08:21 /usr/bin/java -> /opt/java11

not this one

no i made mistake

/usr/bin/java -> /opt/java11/bin/java

this one

ok

mcrs3:/opt/java11/bin # java -version 

start processes again

mcrs3:/TCS/runtimeStore/tcs/runtime/renovated # su tcs 

tcs@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated>  ./start_stop.sh -o 10 LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig 

postgres=# DROP DATABASE testdb;

pts_test_12-0-2=# \d dbversions

I re ran the script of createPTSDB.sql

tcsadmin@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime/createDB> psql -d pts_test_12-0-2 -U trcsd -W -h mcrs3 -f createPTSDB.sql 

Password for user trcsd:

# Java ; Updating java to 11 on gwserver in f09 , to be able to use dekimo configurator


Ln -s /products/java11  /opt/java11

Ln -s /opt/java11/bin/java  /usr/bin/java

Before changing java:

On gwserver


Mcrs3 root home folder

wget http://nexus.lln.iba/repository/assets/com/iba/assets/amazon-corretto/11.0.8.10.1/amazon-corretto-11.0.8.10.1-linux-x64.tar.gz

Unzip :
Tar xf amaz..

mv the unzipped folder to /products

Cd /products

ln -s amazon-corretto-11.0.8.10.1-linux-x64   java11

mcrs3:/opt # ln -s /products/java11 ./java11

Which java
/usr/bin/java

mcrs3:/opt # ls /usr/bin/java -lahtr
lrwxrwxrwx 1 root root 22 Mar  3  2014 /usr/bin/java -> /etc/alternatives/java

mcrs3:/opt # update-alternatives --install /usr/bin/java java /opt/java11/bin/java 1

mcrs3:/opt # update-alternatives --config java

There are 2 alternatives which provide `java'.

  Selection    Alternative
-----------------------------------------------
*+        1    /usr/lib64/jvm/jre-1.5.0-sun/bin/java
          2    /opt/java11/bin/java

Press enter to keep the default[*], or type selection number: 2
Using '/opt/java11/bin/java' to provide 'java'.

mcrs3:/opt # java -version
openjdk version "11.0.8" 2020-07-14 LTS
OpenJDK Runtime Environment Corretto-11.0.8.10.1 (build 11.0.8+10-LTS)
OpenJDK 64-Bit Server VM Corretto-11.0.8.10.1 (build 11.0.8+10-LTS, mixed mode)


mcrs3:/opt # update-alternatives --list java
/usr/lib64/jvm/jre-1.5.0-sun/bin/java
/opt/java11/bin/java


Then go to gwserver 

gwserver:/opt # ln -s /products/java11 ./java11

gwserver:/opt # which java
which: no java in (/sbin:/usr/sbin:/usr/local/sbin:/root/bin:/usr/local/bin:/usr/bin:/bin:/usr/bin/X11:/usr/X11R6/bin:/usr/games:/usr/lib/mit/bin:/usr/lib/mit/sbin)

Use other method of linking rather than mess with update-alternatives (since it is not even using that):

gwserver:/opt # ln -s /opt/java11/bin/java /usr/bin/java
gwserver:/opt # which java
/usr/bin/java
gwserver:/opt # java -version
openjdk version "11.0.8" 2020-07-14 LTS
OpenJDK Runtime Environment Corretto-11.0.8.10.1 (build 11.0.8+10-LTS)
OpenJDK 64-Bit Server VM Corretto-11.0.8.10.1 (build 11.0.8+10-LTS, mixed mode)

Now datarec:

datarec:~ # which java
/usr/bin/java
datarec:~ # ls -lahtr /usr/bin/java
lrwxrwxrwx 1 root root 22 Mar  6  2014 /usr/bin/java -> /etc/alternatives/java

So this is using alternatives thing ,  so go with that (follow what did for mcrs3 above) :

Now go to mcrw1:
Uses alternatives thing..

mcrw1:~ # which java
/usr/bin/java
mcrw1:~ # ls -lahtr /usr/bin/java
lrwxrwxrwx 1 root root 22 Sep 18  2018 /usr/bin/java -> /etc/alternatives/java
mcrw1:~ # cd /opt
mcrw1:/opt # ln -s /products/java11 ./java11
mcrw1:/opt # update-alternatives --install /usr/bin/java java /opt/java11/bin/java 1
mcrw1:/opt # update-alternatives --config java
There are 2 choices for the alternative java (providing /usr/bin/java).

  Selection    Path                                    Priority   Status
------------------------------------------------------------
* 0            /usr/lib64/jvm/jre-10-openjdk/bin/java   2005      auto mode
  1            /opt/java11/bin/java                     1         manual mode
  2            /usr/lib64/jvm/jre-10-openjdk/bin/java   2005      manual mode

Press <enter> to keep the current choice[*], or type selection number: 1
update-alternatives: using /opt/java11/bin/java to provide /usr/bin/java (java) in manual mode
mcrw1:/opt # which java
/usr/bin/java
mcrw1:/opt # java -version
openjdk version "11.0.8" 2020-07-14 LTS
OpenJDK Runtime Environment Corretto-11.0.8.10.1 (build 11.0.8+10-LTS)
OpenJDK 64-Bit Server VM Corretto-11.0.8.10.1 (build 11.0.8+10-LTS, mixed mode)

Now for tcrw1:

just for my record ,  when a new java version is needed , two changes are needed :

Firstly add java to /products/

Changing CGCU card ; after swapping and turning cab back on (cbct cab first)  ,  then be patient wait about 5 mins until amber light is flashing on FW ack on safety plc, the only light on the safety plc to be flashing should be that one .. 
Then press fw ack  (have the arrow pointing to it , then press the enter button under it.  Then hear a little clunk sound , then wait about another 5 mins until it comes back up all green .. 

# PTS database ; Renaming the old and new databases: 

log in to psql with the postgres user, then run this command: 

postgres=> ALTER DATABASE pts_test2 RENAME TO pts_test;

when you rename the database -> you must be the owner of the database to do so;  but you also must not be connected to the database that you are changing 

psql trcsd -h 127.0.0.1 -d pts_test2  

That command connects to pts_test2 db with user trcsd 

I had to add -h 127.0.0.1 ,  because it was giving error message about not able to do a 'peer connect' 

If you do that, you can connect as if from over network, and it works 

normally do not need the -h part 

you need logged in to the psql shell as the owner of the db to be renamed 

- i did not know the command to do that - how to log in to the psql shell with that owner 

so i used the command which connects to a db with the user - presumably i logged in using postgres user 

then can use pts_test2=> \connect postgres  

\connect postgres 

Bruce Wang 20:35:  

yes 

Bruce Wang 20:35:  

\c 

Bruce Wang 20:35:  

to connect exact database 

Christopher Finch 20:35:  

to connect to the postgres database - any other database , you just need to be disconnected from the one you are changing 

Christopher Finch 20:35:  

then you can run the ALTER command 

Christopher Finch 20:36:  

great, thankyou for your marvellous help, as always!! 

Bruce Wang 20:36:  

how do we disconnect the database? 

Christopher Finch 20:37:  

i do not know how to just be a user logged in to the psql shell WITHOUT being connected to a db 

Christopher Finch 20:37:  

we can do that with postgres -- only because 

Christopher Finch 20:38:  

postgres is a user in the mcrs3 

Christopher Finch 20:39:  

when typing psql , it will try to use the user that you are in mcrs3 

Bruce Wang 20:39:  

yes 

Christopher Finch 20:39:  

perhaps if you had a user set up in mcrs3 called trcsd, then you could also do psql and get a shell without a db connction 

Bruce Wang 20:40:  

OK 

Bruce Wang 20:40:  

I will try 

Christopher Finch 20:40:  

yes - it is a constant learning process :-)  

psql trcsd -h 127.0.0.1 -d pts_test 

Followed my note on installing a new database to create a new pts_test db - this time ran as the same user as the pts_clinical database, trcsd rather than pdct.  

Create and install a new pts database 

Opened tcs environment using workspace - changed jdbc.username in site.properties file to trcsd and tested that bcp opened. Passed  

Then renamed pts_test2 to pts_test and renamed the original pts_test database (the one with incorrect permissions) to pts_test_old.  

Then followed the last part of Updating site configs  (see snippet 1 below) so that installed the latest clinical tag to the tcs environment. 

Then tested tcs environemnt (without workspace) by opening bcp - passed!  

Now have ended up with tcs and clinical environments that can share the same version of the site configs. 

Finally, checked that we are ok to use the fresh database -> confirmation from ddoan on the intended use of tcs database:     

You can do whatever you want with the test DBs. You can create as many as you like and modify, alter, etc. You can delete them as necessary. The only DB that matters is clinical. 

Code Snippet 1 

Then log in to mcrs3 with cfinch 

Then  

su - tcsadmin 

(validation) 

Cd /TCS/runtimeStore/tcs/foundation/ 

./install-site   SBF.110    PTS-11.0d    tcs    christopher.finch@iba-group.com 

finally, install the latest clinical tag to the tcs environment, and then we are all set. maybe check with Drew Doan that we are using a fresh database for tcs, is this ok?  

perhaps do a pgdump first on pts_test_old database, so that can see exactly what is the difference between the two -> could do a diff against this dump and a dump of the pts_test (this is the new fresh db) database. 

pg_dump <dbName> > <dbName_bkup.sql> 

change to tcs user before changing site.properties (tcs is the owner and others do not have write priveledges) 

cfinch@mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig/config/SBF.110 $ vim site.properties 

this above didn't work as couldn't save changes in site.properties , so do the below first: 

cfinch@mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig/config/SBF.110 $ su tcs 

to drop a database, need to be the owner of the database, but cannot be connected to it , so connect to a different database as that user . 

psql trcsd -h 127.0.0.1 -d pts_test2 

then do the following command 

pts_test2=> DROP DATABASE pts_tcstest 

then to rename a database ( i want to do this because i want to change pts_test to pts_old and pts_test2 to pts_test 

need to be connected not to the database to be renamed, use the \connect command to change to e.g. postgres db: 

pts_test2=> \connect postgres 

You are now connected to database "postgres" as user "trcsd". 

postgres=> ALTER DATABASE pts_test2 RENAME TO pts_test3; 

If the DB was created with the pdct user, then that is the default user that can access it (besides root, postgres, admin, etc). 

Just changing the owner is not enough. 

You have to grant the trcsd user access to the tables, r/w permissions, etc. 

Try creating another test DB with the trcsd user and then use the workspace to point to that DB as a test.  

you su to postgres user 

then create a database 

createdb pts_tcstest -U trcsd -W -h mcrs3  

https://www.postgresql.org/docs/9.1/app-createdb.html  

there is createdb jar code 

is that in the install script?? 

\l 

to check if new database has been created 

tcsadmin@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime/createDB> ll 

total 68 

-rwxr-x--- 1 tcsadmin tcs 69605 Jan 7 17:19 createPTSDB.sql  

code is here 

I think 51900 would have  

clinical@mcrs3:/tcs_usr/clinical/db_scripts $ ll 

total 32 

-rw-rw-r-- 1 clinical hosp 2450 Aug 3 2017 DbScriptsConfig.py 

-rw-rw-r-- 1 clinical hosp 5823 Jun 18 2015 DbScriptsUtils.py 

-rwxrwxr-x 1 clinical hosp 3018 Feb 6 2017 genCreateDbSql.py 

-rwxrwxr-x 1 clinical hosp 660 Feb 6 2017 genDbScripts.py 

-rwxrwxr-x 1 clinical hosp 5862 Feb 26 2016 genUpgradeDbSql.py 

-rw-rw-r-- 1 clinical hosp 563 Oct 12 2015 pom.xml 

drwxrwxr-x 3 clinical hosp 72 Mar 20 22:13 src  

code is here 

I am still checking the python code 

postgres@mcrs3:~/runtime/createDB> ll 

total 68 

-rw-r--r-- 1 postgres postgres 69605 Aug 22 2018 createPTSDB.sql 

postgres@mcrs3:~/runtime/createDB> createdb pts_tcstest -U trcsd -W -h mcrs3 

Password: 

postgres@mcrs3:~/runtime/createDB> psql pts_tcstest < createPTSDB.sql  

above is the database creation command 

can you change the db to pts_tcstest and try to start with workspace? 

you can make this note. I think db creation is the same on all sites 

and also code, I recommend you to read it 

to better your understanding on how db creation performs 

yes, it is part of pts installaiton codes 

I export it from svn 

http://subversion.lln.iba/repos/tc/alcyone/tags/PTS-11.0.3.3/tools/db_scripts/src/main/resources/runtime/  

it is here 

then we can maybe copy all the data from the current pts_test to the new pts_test 

it is possible 

but you need to code 

there is a copyDB 

you can check, it is helpful 

su - 

su - postgres 

psql 

\du 

\l 


managed to changed pts_test database  owner name from pdct to trscd  - this should enable us to swap between tcs and clinical without problem. To test next week on late shift. 

Solve the problem with the username on the pts database.  usernames are different between the tcs version and the clinical version, there is confusion over whether need to swap between them when deploying to tcs and vice versa. 

can i follow where the script goes? a program to step through the lines? like a debugger? 

read and make notes on 51900, then understand the issue with the database user name - see email trail with Bruce. 

then follow the changes made during most recent site config release, to see what the confusions were. 

Then tidy up the software installation, PTS , the runtimeStore, the TCS folder on mcrs3, the runtime software, the PTS software. 

![](files/2021-11-18-13-31-50.png)

![](files/2021-11-18-13-31-59.png)

![](files/2021-11-18-13-32-06.png)

![](files/2021-11-18-13-32-11.png)

![](files/2021-11-18-13-32-20.png) 

mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime #

Createdb pts_test_12-0-2 -U trcsd -W -h mcrs3

Psql -d pts_test_12-0-2 -U trcsd -W -h mcrs3 -f createDB/createPTSDB.sql

Then change to postgres user ;  then to postgres home dir (cd) 

psql -d pts_test_12-0-2 -f pts_test-backup.sql

Or maybe the previous command can be run as a different user , such as root or tcsadmin , but wiht this format, including -U postgres :

pg_dump -U postgres -O dvdrental -f dvdrental.sql

From <https://www.postgresqltutorial.com/postgresql-copy-database/> 

psql -U postgres -d targetdb -f sourcedb.sql

From <https://www.postgresqltutorial.com/postgresql-copy-database/> 

Password is the one found in site configs ;    12345 

createdb pts_test_12-1 -U trcsd –W –h mcrs3

tcsadmin@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated/pts-adminTools/runtime>

createdb pts_test_12-1 -U trcsd –W –h mcrs3

psql –d pts_test_12-1 -U trcsd –W –h mcrs3 –f createDB/createPTSDB.sql

§ dbUpgrade_PTS_10.0.0_to_12.0.0.ddl (changes from 11.0.4 to 12.0.0)

§ dbUpgrade_PTS12.0.0_default_role_manager_setup.ddl (manual configuration may be needed, see hereafter)

§ dbUpgrade_PTS_12.0.0_to_12.0.1.ddl

dbUpgrade_PTS_12.0.1_to_12.0.2.ddl

mcrs3:~ # dbUpgrade

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

(reverse-i-search)`pts_clini': psql -d pts_clinical -U trcsd -W -h mcrs3 -f createDB/createPTSDB.sql

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_default_role_manager_setup.ddl

mcrs3:~ # hostname -a

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.1_to_12.0.2.ddl

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0_to_test.ddl

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0_to_test.ddl > db-upgrade.txt

(reverse-i-search)`dbUpgrade': psql -d pts_clinical_test -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0.ddl

(reverse-i-search)`dbUpgrade': sudo -u postgres psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

(reverse-i-search)`dbUpgrade': psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS12.0.0_to_12.0.1.ddl

(reverse-i-search)`dbUpgrade': psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0.ddl

(reverse-i-search)`dbUpgrade': psql -d pts_clinical -U trcsd -W -h mcrs3 -f dbUpgrade_PTS10.0.0_to_12.0.0.ddl

(reverse-i-search)`createDB': cd createDB/

# PTS ; How to preserve the pts database when upgrading

How do we add the customer qa plans? for adding customer qa plans to the r12.1 clinical database , will need to copy the present clinical database to a new name , start up adapt prescribe in tcs pointing to a fresh clinical database pts_clinical, add the plans , and then save the database to a temporary name and then rename the r11 clinical db back to pts_clinical .

# PTS ; using the test virtual machine 

https://wiki.iba-group.com/doku.php?id=pt:sites:lln:pelabo:factory_pts:factory_virtual_machine

ProDG Software Project User Guide

MID-59796

PTS test environment

Look at doing a whole installation of the PTS system using virtualbox containers and gns3, start with using linux containers perhaps. 

or with  

https://www.nsnam.org/releases/ns-allinone-3.29.tar.bz2 

PTS

all processes are stored here: 

/TCS/runtimeStore/tcs/runtime/renovated/ 
 
and here 

/TCS/runtimeStore/treatment/runtime/renovated 

# r12 upgrade in Reading

order 4mb siemens mmc for blcu  

order safekeys and sew cards

r157395 | cfinch | 2022-03-04 16:57:44 +0000 (Fri, 04 Mar 2022) | 1 line
Changed paths:
   M /alcyone/branches/SBF.115-PTS-12.1-VALIDATION/processConfigs/src/main/resources/config/SBF.115/TR1/scanalgo.csv
   M /alcyone/branches/SBF.115-PTS-12.1-VALIDATION/processConfigs/src/main/resources/config/SBF.115/beamCommonProcess/container.properties
   M /alcyone/branches/SBF.115-PTS-12.1-VALIDATION/processConfigs/src/main/resources/runtime/SBF.115/TR1/positioning-process/resources/config.properties

Edits during install

svn diff -c <revision> path/to/repo

157395    this is the changeset when this degraderfeedback was changed

this is the sbf.115 rc tag bug

'[PRS-103696]

Tests referred to in comments 4 and 5 were carried out using tag ER7 . 

However, strictly this should have been done using the naming of RC ,
representing a release candidate. 

This ER7 tag has been copied to tag RC1 and can confirm that ER7 and RC1 are
identical. There are no differences in their content - 

as confirmed by a diff analysis. 

Ongoing validations to be carried out using the RC naming.

# 3par

CZ2640037H 

CZ3737S8N9

ssh 3paradm@san-3par  ;   root password

san-3par

Open the VSP-3PAR Home Page https://f10-vsp.ppi-rccn.org 

Username: 3parcust  

Pwd: 3parInServ 

servicemag start -pdid <PDID>
  srvicemag status -d
showpd -failed -degraded

F10_3PAR cli% servicemag status -d
No servicemag operations logged.
F10_3PAR cli% showpd -failed -degraded
No PDs listedExamples:

Host server1
  HostName server1.cyberciti.biz
  User nixcraft
  Port 4242
  IdentityFile /nfs/shared/users/nixcraft/keys/server1/id_rsa

ssh gets its configuration in this order:

command-line options

~/.ssh/config

/etc/ssh/ssh_config

ssh uses the first parameter found.

sections separated by Host specifications, 

key - value pairs 

# PTS ; upgrade in Caen

Issue during the ACU upgrade: 

from Vincent

ACU memory card was swapped, 

Switch selector put to the RUN position.

the ACU was not able to go in STARTUP/RUN mode

The ACU stayed in STOP mode 
 
PLC was not able to evaluate the correct status of the switch selector. 

It was always seeing it at the STOP position.
 
A power cycling of the CPU recovered this issue.
 
Issue already seen in factory 

independent from the ACU version 

turn the PLC power off when swapping the ACU memory card.
 
Fabrice - The bug for Gantry homing is 107826

Fabrice - Quench appeared Sunday morning during ramp up, maybe due to exchange roll back and compressor N°2 turned in By pass during too much time.
 
SBF.107 Caen ; 

PTS-12.1.1 ACU-4.2 ; 

PR-125262
 
1, Verify that PR-125262 is resolved. 
 
2, Perform SRCU validation tests:
 
MID 40391 : TSS Verification tests for Beam Access ; site test number 123216
TSS-IVVP- 623
TSS-IVVP- 625 ; Previously TSS-IVVP-625.2 failed
 
MID 44806 ; P1 SRCU1 Motion & Treatment Validation Tests ; site test number 123218
TSS-IVVP- 629
TSS-IVVP- 631
TSS-IVVP- 632
TSS-IVVP- 633
 
3, Perform OPSC 
MID 21867          ; PTS operation scenario ; PR 98274
 
 
Note that clinical install was planned for 23/24 July making this the penultimate upgrade weekend. However, the date has been changed by customer request to September. 
 
Planned timeline to meet objectives:
 
Friday (15 July)
 
Ramp down, update PTS and ACU, start ramp up (overnight).  Starting at 2000 this would be a late shift.
 
Saturday (16 July)
 
Test PR-125262
 
Perform SRCU validations 
 
Perform OPSC 
 
Start ramp down at end of the shift.
 
Sunday (17 July)
 
Target of shift to rollback to R11, ramp up, and perform mock treatments in R11. 
 
Summary:
 
The mission started smoothly with the roll forward to r12 taking place as planned. 
 
However, we hit the following issues:
 
PCU died. A new PCU was delivered from Nice and replaced. (B&R industrial PC ; Automation PC 910).
 
Unable to start RF due to a 'crowbar' alarm. This is similar (the same? ) to what had caused a site down the previous week. 
 
Motion veto alarms on hand pendant. This was due to a loose connection inside the wmebcu unit. 
 
The weekend and Monday was spent finding and fixing these issues. A further mission to address the original objectives will have to be arranged. 
 
Mission report :
 
Preparation tasks: 
 
Update the site config to include the ACU 4.2 and SRCU 4.2 checksums -- done , RC10 created and validation tracking bug updated. Copied from tag rc7 the values for the acu and srcu checksums.
 
Prepare the ACU and SRCU cards -- done with thanks from site
 
Update Archestra for ACU change -- done with thanks from Ondrej
 
ramp down started ~ 8pm --done
 
check that gantry is at zero -- done
 
take pic of the archestra screens -- done
 
in archestra; take record of blcu code checksum, for easy restore -- done
 
in archestra; save parameters for acu and blcu -- done
 
power maintain -- done
 
Tcs shutdown  -- done
 
Update electrometers with the Dekimo configurator -- done
 
In archestra , turn smps and mpss hook ups off, to prevent them tripping when changing blcu card  -- done
 
make backup of the existing tcs runtime --done
 
Switch over pts from r11.0.4 to the r12.1.1 version in tcs. Used the previously backed up r12.1.1 runtime. --done 
 
Install the latest rc10 site config --done
 
Check out the validation branch to the workspace --done 
 
Log out of clinical on mcrw1, restart, then log in as tcs --done
 
Change the cards for cgcu, cbctcu and wmebcu --done. Waiting for ramp down to do the acu , blcu and srcu  
 
SEW drives updated , for cgcu and cbctcu ,  but not to update the parameters as that not required --  done
 
Swap over the PCU icomp version --done. This is where issue 1 was met. On restarting the pcu it would not come back up. There was no system start-up.
 
Coil ramped down --done 
 
Archestra VMs swapped over to r12 version --done. 
 
started archestra using the icon labeled 'RDP' on the desktop of mcrw1. it logs in wiht one of the control_station users --done
 
swapped over acu , blcu , srcu cards ; started the units --done
 
Re-enter the blcu checksum in to archestra --done
 
turn on hook ups  --done
 
start ramp up --done 
 
[end of Friday's shift]
 
Next morning, tried to troubleshoot the pcu. Since there was no output on the monitor screen, we tried changing cables, testing ethernet, changing monitors, using display port instead of dvi, testing voltage of power supply is 24V, took the unit out of the cab and opened the pc to see if anything noticeably wrong (there was not). 
 
No spare part on site so TSC and Fabrice arranged for a delivery of a new PCU (Automation PC) from Nice. 
 
First TSC enquired with 'Rush for Parts' but we found out that they do not arrange site to site deliveries , only from factory. 
 
Vivien did a clean up of cables which were damaged during an incident during the week. --  u wanna add something here @Vivien ? 
 
Rotco drive updated using the Starter software on controltools --done
 
Spin up rotco --done
 
[Saturday afternoon]
 
Started SRCU validation bug, mid 40391. However here we met issue 2, RF would not start due to an error in archestra alarms called CRBAR. After troubleshooting to try and resolve this, at 1930 we decided to start the roll back to r11. Then would attempt to resolve in the clinical version , to have site ready for Monday.  
 
Saturday night, started the ramp down  --done
 
[Sunday morning 8am]
 
Fully ramped down -- done
 
Swapped controlserver and historian to r11 archestra version  --done
 
Swapped cards over to r11 versions, ACU , SRCU , BLCU  --done
 
Cooling was restarted with remote assistance from Vincent to reset the errors on the Altivars  --done
On altivar, press escape until you get to the main menu, then press f4 to change from remote (REM) mode to local (LOC) mode. Then press the esc/reset button. Then you put it back from local to remote mode. Then emerency cooling was started. Cryo compressors powered on. 
 
Start ramp up  --done
 
Put a note on the front gate to let the delivery guy have our number.  
 
Delivery guy arrived about 1130am with the new PCU ; received at the gate. 
 
PCU switched over -- done. Now when we turn on the pcu pc the system startup appears on screen as per normal. So the replacement of the pcu pc has fixed the issue. 
 
However, issue 3 was encountered here, ambiguous instruction.  
 
A misleading instruction step mixed with a coinciding separate fault caused significant delay, which resulted in a site down day on the Monday.   
 
Once the PCU was up and running, the site tested the movements of devices. Here issue 4 was encountered, gantry out of position and unable to home. This issue was resolved when Fabrice followed a bug to recover the gantry and allow it to home. 
 
Then we started to perform MID 40391, which would include a test of the previous mission's bug regarding the status lights. However, at this point we were unable to turn RF on due to a crowbar error; issue 4. 
 
Decision made to roll back to r11 , to try and resolve this issue and recover the site for Monday. 
 
Site was ramped down and the pts rolled back r11. 
 
Sunday morning site rolled back to r11 and ramp up started.  
 
Crowbar issue resolved. 
 
Issue with unable to move gantry (issue 4)
 
Some 1 hour after ramp up started, the site had a quench, approx 11am (Issue 5) 
 
On Monday morning the site was having motion veto errors on the hand pendant (issue 6). Because the PCU had been swapped on the weekend, it was suspected that it could be something to do with that. Went to site on Monday. Much of the troubleshooting was focused on trying to recreate the one cable setup on pcu , but seems was not possible without installing a new bios version. Original installers of the pcu were contacted but they were not able to recall why changed from 2 to 1 and how it was done. However, during the day it became clear that the set up with the two cables was indeed ok and that it was probably not the cause of the motion vetos. On the Monday evening Fabrice found the fix !  By reseating cables in the wmebcu , this cleared motion veto errors ! 
 
mock treatments carried out succesfully.  Site recovered for Tuesday !
 
Issue 1 ; PCU insdustrial b&r pc died:
 
No system start up. New part delivered from Nice and replaced. 

Issue 2. crowbar issue:
 
Error CRB1 when attempting to turn RF on. 
 
Notes from this happening the previous week:
Problem when the treatment room is secured. Triode Power supply in error. Have to wait until acknowledgment of error. Problem coming from the Crowbar driver inside the Anode PS. 
find the 'RF oscillator power supply'  --> part 2002543 "S2C2 - RF oscillator power supply"
Replace the crowbar driver --> part P4000664 "PCBA C0606V01-D Crowbar Driver" 
Crowbar driver in Anode Power supply exchanged (P4000664), problem solved.
 
Last week this driver/circuit was exchanged. This appears to be the same issue.
 
Bug 125555 was previously opened to describe the problem. 
 
After reseating cables of the crowbar card this error was fixed ( Vivien and Fabrice please add more info )
 
## Issue 3 ; Delay from ambiguous instruction  
 
To set the pc up, chapter 55 of 5951 (version A0) was followed. This section is titled 'B&R Industrial PCs'
 
The pc has two ethernet ports, ETH1 and ETH2 
ETH1 mac address , from bios and from sticker on pc ; 00:13:95:1A:B3:1E
ETH2 mac address , from bios and from sticker on pc ; 00:60:65:2D:4E:43
 
The previous pc was set up with one cable in ETH2. In the cabinet can be seen the second eth cable which is unplugged. And two ports in patch panel in the pcu cabinet labelled 'for pcu pc'. One is used by the cable from ETH2 , and the second is used for something unrelated. The cable originally installed for ETH1 is again present but unplugged/unused. 
So during installation, the pcu was initially set up with a 2 cable solution but then got changed to a 1 cable solution. 
 
The instruction implies that there is a problem if 2 cables are used. 
 
"
When both NICs are enabled, the PXE boot works, but the linux kernel somehow tries to use the 2nd (unconnected) NIC as its primary one.
 
From the main Setup screen, select Advanced, then Baseboard / Panel Features, then Legacy Devices.
Set the \2nd LAN Controller" to Disabled
"
 
However, this option of 'Baseboard .. '  is not present in the bios menu. Perhaps these instructions were from a previous bios version. 
 
The only way we could get the pc to boot and function properly was by having the 2 cable setup .  
 
We found that when the pc first boots up, it uses ETH1 port for the pxeboot, to communicate with the dhcp server , and to receive its ip and the location of the kernel. 
 
Once the pxe boots then it switches to using ETH2. ETH2 is given the correct ip address ending 61. 
 
Once ETH2 is up then ETH1 goes in to a down state. 
 
Any other configuration of using 1 cable , either in ETH1 or ETH2 results in either the pxe boot not initiating , or if it the cable is only in ETH1 then a kernel panic occurs in the last step of boot up as it tries to mount the virtual file system. 
 
Note that some other sites also use 2 cables.
 
## Issue 4 ; Gantry unable to home
 
The gantry was out of position , stuck at 80 degrees and unable to home. 
Fabrice was able to resolve this by following a fix made in a bug  -- see bug 107826
 
## Issue 5 .  Quench!
 
Quench appeared Sunday morning during ramp up, maybe due to exchange roll back and compressor N°2 turned in By pass during too much time.
 
 
## Issue 6. issue with motion vetos appearing 
 
Motion vetos appear on hand pendant for PPS , gantry and snout. Although the newly installed pcu was suspected as the issue, the cause was due to some loose connections in the wmebcu cabinet.  
 
Note:
checking the steps of roll back --  
check the wbebcu ; check the archestra is switched back ; check the cards are all back correct ; what is installed in clinical ; blcu checksum / card is back ; saved parameters for acu and blcu; 
anything to do with pcu ? 
dekimo configurator?
anything wrong in service screens of cgcu ?  look in the vnc ? 
logged out of clinical on mcrw1  
sew drives ?  for cgcu it is ok ? redo the sew update 
pcu ,  set up correct ? 
rotco drive ?
something to do with crowbar ? 
 
 
## Dose received 
 
Passive dosimeter worn throughout ; no excursion in the cyclo vault.



# PTS ; blocking safety parameters  

./processConfigs/src/main/resources/config/SBF.115/beamCommonProcess/bdcuSetup/setup.properties:#bms.blockingSafetyParametersChecking=false

movitools ;  connection parameters ;  

# PTS ; updating SEW parameters

for cgcu-drv1 it is 10.3.51.93
for cbct-drv1  it is  10.3.51.102

# Errors ; Relay check in BSS initialization

IC Cyclo Beam Enable Relay Check :   Warning (failed but non-critical)

 when try to do a lookup 
BdcuController state goes to error ;  
Boards status :  
    sgcu : error ; 
    rfcu1 : error ; 

logs: bcp log
com.iba.pts.bms.devices.dekimo.exception.BoardCommandException: sgcu-BE-PROXY: enables beam on sgcu-BE-PROXY returned ERR_FAIL_IN_DATA - Data fields contains NOT OK. Check error code published in syslog for additional information (cfr. Mantis 9792). Command return value: 13

# PTS ; r12.1 ; random errors  ; may need to change the electrometer versions ?

Beamline vacuum NOK - can't move gantry due to "Value out of range" error on Maintenance HP --> workaround found by Fred.

BSS initialisation still not passing due to BPM electrometere firmware

IC cyclo/BS threshold has been changed

Added the following lines to BCP container.properties, to see if this would allow the Initialisation to pass, but no luck

bms.electrometer.fwVersion=A.5.4.59,A.4.4.46

bms.electrometer.swVersion=A.5.4.59,A.4.4.46

Edited bssConfig,ini to delete all the devices which were "not connected", and the BSS initialisation is passing. However, we still can't prepare, so it seems like an issue with the beam enabled signal

The firmware and software versions are not the same for the BPM electrometers, so added the following to container.properties:

JLI 17/08/2021, expected FW and SW versions added for R12.1 testing

ms.electrometer.fwVersion=A.5.4.59,A.4.4.47

ms.electrometer.swVersion=A.5.4.59,A.4.4.46

 Now the initialisation works, but still no luck with the prepare

 Took a video of the SRCU I/O table, possibility is that the beam enabled to electrometers is a bit slow to drop

SRCU timeout increased from 500 to 1000ms, and had the same error, but from BCP logs, the timeout didn't actually change, so it may be hardcoded. However, looking at the logs for Kansas City, they seem to have a timeout of 1000ms, so we are looking for the correct property to change, however it is likely that it is hardcoded

Unplugged the TSS cable from IC cyclo, and relay check gives "Warning (failed but non-critical)", so it seems to be working correctly

 Plugging the cable back in, the relay check passes as before

 Steps BMS-ITC-050.1, BMS-ITC-049.1 and BMS-ITC-052.1 of MID 75412 played. The relay checks for IC cyclo, RFCU and SGCU seem to work, but for SGCU and RFCU, the IC cyclo relay check also fails, not sure if this is normal or not.

 Fred did a diff between Leuven and here, and found a few parameters in Leuven that are not present here:

ogback.appender.filelog.appenderAccessMode=ASYNC_NON_BLOCKING

bms.srcu0.enableSrcu0TreatmentOk=true

 These were added to BCP container.properties and site.properties, respectively, but no change

 Connected SC_enable to the picoscope to check that it is actually getting to the termination check, we see that it is, and the pulses look as they should during the prepare

 As a sanity check, unplugged the IC cyclo TSS cable and tried to Prepare --> BDCU gets stuck in EnablingBeam state, as expected.

 At this point, I am stuck for ideas as to what to try, so email sent to deployment team to ask for BMS ID support, or maybe Software ID

## 18th Aug shift report 

- Cathy Clerc monitored SRCU during prepare, and it seems the IC cyclo signal is dropping as it should

- With help from Xavier Lerot, checked the change of status code on RTCBs, IC1Y, IC2Y. When burst is prepared, we get "MB_STATUS_BEAM_ENABLED", and not when the burst is unprepared --> normal behaviour

- For the RTCBs, we have "SW_BEAM_ENABLE" and "BEAM ENABLED" after burst prepared, but not when burst is unprepared --> normal behaviour

- After doing a prepare, IC cyclo still has status "MB_STATUS_BEAM_ENABLED" --> this is why the prepare is failing

- Checked the SRCU wiring, all seems correct.

- We see that the beam enable is not being sent to the electrometers on simatic, wowever, for IC cyclo, we still have beam enabled (but not for IC1-Y or IC2-Y). It seems there is a constant 24V being sent, and we think it is likely from the pin A to BLCU, via A2-103-33 in the SRCU cabinet, as this is what gives the beam enable to the IC cyclo electrometer.

- Measured voltage on A2-102-33, 0 V. With the cable disconnected, we still have beam enabled on IC cyclo, which indicates we are getting a constant 24V from somewhere else, and this is not the culprit

- Measured pin 1 of DB9 TSS cable, and have 24V even with the bridge disocnnected, and have 0V on pin 4 when there should be 24V.

- Used a burndy box to measure the voltage at the SRCU end, and it is okay, so there is an issue with the terminations. As a quick test, swapped pins A and D in the SRCU cabinet on J19, and now we can prepare.

- Checked DB9 end of WB456, but looks wired correctly.

- Took apart the burndy termination of WB456, and the wires went 3-2-4, so looks like a "4" was seen as a "1". We re-made the connector, and we can now prepare.

- Cleaned up the connectors (burndy and DB9), so all ready to start the beam work

- Workspace cleaned up as a lot of things were added during the debugging.

- OB1 and OB2 panels turned off before the beam work was started

- Started ESS efficiency cal at 15:34

Had to increase the timeout for the Init() chain due to the offset compensation being different in R12 compared to R11

Whenever there is a pause due to RF drop, need to manually insert the beam stop in order to recover the BDCU

Had some intermittent connection issues between BLAK and BCP which made the script take longer than usual

Had a strange issue where the script wouldn't work because of the following error in the logs:

2021-08-18T17:22:04,954 [ERROR] {JLI/172153:SnoutCtrlProxyNotifReceiver} (com.iba.icomp.core.util.handler.LogExceptionHandler) - Unhandled exception by NotifChannelReceiver: NotifChannelReceiver SnoutCtrlProxyNotifReceiver was unable to receive event.

Restarting the TCR allowed the script to run again

Script finished at 18:30, results look very good, a lot better than when the beam stop was used for higher charges.

Scanalgo parameters generated, workspace to be updated first thing tomorrow.

# PTS ; r12.1 ; List of tasks 

Change CU cards over  ---   done 

Electrometer firmware upgrades

Swap to r12.1 in tcs env

VMs for historian and controlserver ,  install new archestra version . 

Do adapt insight configs -- asked Fred , which one to start ? 

Iec procedures

Bms procedure

Shoot beam 

install EIDEU in Reading.

Swap pcu kernel over   - done

Blcu modules install - bdsio 

Added the collision avoidance parameters from Leuven

Java updates done

Install new hand pendant apks

BLCU checksum in archestra ,  it is the db one i think .. 
# PTS ; r12.1 ; user-db.csv

processConfigs/src/main/resources/config/SBF.110/user-db.csv

Here need to provide hash passwords for the default users. 

Add the following line in to the site.properties file to indicate where the user-db.csv file is located; icompx.useraccess.local.db=classpath:config/SBF.110/user-db.csv
 
# PTS ; r12.1 ; PPSCU ; logs

Logs coming from the B&R PLC (accessible with the M-Eth port on the Leoni cabinet) can be very useful. 

Knowing the root cause of the problem, the use of the control unit in the gantry pit can be useful as well. 

It can allow us to acknowledge PLC errors that can’t be through the maintenance hand pendant.

# PTS ; r12.1 ; Phase 1 ; Release 5; PTS 12.1  

## Upgrade kits 

PR-106051, WMEBCU wiring changes 

PR-108471, SRCU wiring change

MID 91046, Collision Avoidance Calibration

## Prepare site configuration

D12.1_1, Stopping distance with RPD,
D12.1_1,
D12.1_2, 
D12.1_3, 
D12.1_4, 
D12.1_5, 
D12.1_6,
D12.1_7,
D12.1_8,
D12.1_9,
D12.1_10,
D12.1_11,
D12.1_12,
D12.1_13,
D12.1_14,
D12.1_15,
D12.1_16,
D12.1_17, 
D12.1_19, 
D12.1_20, 
D12.1_21, 
D12.1_22, 
D12.1_23, 
D12.1_25, 

## AI config update

D12.1_26		 

## usersdb.csv

## Prepare new PCU kernel

## Prepare CUs and safety keys 

## Update hand pendant apk from HPv3b to HPv3c

## Deploy PTS-12.1.0 clinically  

Update Postgres DB

MID 18829.  

## Install the HPv3c apk 

D12.1_34	

D12.1_35	Hand-Pendant Registration procedure	15 min	PTS SW R12.1 deployed and tested.

## BDSIO upgrade - Needed for new temperature and pressure sensors 

D12.1_76,	Bug 93812 

## CU Cards

D12.1_80, CGCU-B2.0,

CBCTCNSHCU-A8.0	

D12.1_81,	WMEBCU-A6.0

D12.1_82, 	

D12.1_83,	SRCU-A4.1a

D12.1_86, BLCU 7.0

## Install new r12 to tcs and install an ER tag

D12.1_87, PTS SW R12.1

## How to roll forward 

## Update SEW drives

C:\VDog\PT_Sites\SBF.110 - Newcastle\CGCU\BR\Physical\CGCU_SL8001\Hardware.hw (Module: SEW_Controller) : Error 6854: Version 4.0 of frozen hardware module SEW_Controller not found.

## Validations

D12.1_88, Partials continuation

D12.1_89, Range verification

## Perform a mock treatment

## Perform the operational scenario, OPSC PTC-VTC-213

## Enter blcu checksum in to archestra after updating Archestra

Look in versiondog tracking bug for blcu to get the checksum ( the checksum has db in its name)

## Collision avoidance calibration

D12.1_30	 

## Update cogent bridge 

D12.1_31, IT 

D12.1_32, IT 

D12.1_33, PRS-112036, CSV data in PRIDEx
			 
# PTS ; r12.1 ; Phase 2, Release 6, PTS 12.1 with ACU 4.0, Site config changes	

D12.1_19, 

D12.1_20,

D12.1_21, 

D12.1_22, 

D12.1_72,

## SCC PS V1 and V2, delay required on the water interlock, ramp down necessary

D12.1_79, ACU C4.0

D12.1_84, SRCU-A4.2

# PTS ; r12.1 ; Phase 3?, Release 7, ACU 4.0, SRSEU 4.0

D12.1_71, SRSEU upgrade

## PTS ; r12.1 ; Caen ; Creation of site config RC instead of ER tag ,  check this is alread done for Caen ? 

svn cp -m 'Creation of the SBF.110 pts12.1 stable branch ; a copy of the SBF.110-PTS-12.1-TEST branch' http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-12.1-TEST http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-12.1-STABLE

## Get the CU checksums from vdog or from the tracking bug and enter them in the site configs

## Update the bdcu electrometers using dekimo configurator, and comment out the versions in the site config

(base) ➜  SBF.110-PTS-12.1-TEST svn diff -x -U0 http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-12.1-RC4 http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-12.1-RC5

Index: processConfigs/src/main/resources/config/SBF.110/beamCommonProcess/container.properties

--- processConfigs/src/main/resources/config/SBF.110/beamCommonProcess/container.properties     (.../SBF.110-PTS-12.1-RC4)      (revision 152990)
+++ processConfigs/src/main/resources/config/SBF.110/beamCommonProcess/container.properties     (.../SBF.110-PTS-12.1-RC5)      (revision 152990)
@@ -16 +16 @@
-bms.bds.bdc.ioSrseu.hwVersion=1.3
+#bms.bds.bdc.ioSrseu.hwVersion=1.3
@@ -49 +49 @@
-bms.electrometer.fwVersion=A.5.4.59,A.4.4.47
+#bms.electrometer.fwVersion=A.5.4.59,A.4.4.47
@@ -51 +51 @@
-bms.electrometer.swVersion=A.5.4.59,A.4.4.46
+#bms.electrometer.swVersion=A.5.4.59,A.4.4.46
@@ -53 +53 @@
-bms.mcrServiceScreens.screenId=:0.0
\ No newline at end of file
+bms.mcrServiceScreens.screenId=:0.0

Taking each difference :

-bms.bds.bdc.ioSrseu.hwVersion=1.3
+#bms.bds.bdc.ioSrseu.hwVersion=1.3

This parameter is commented out because it is a duplicate parameter ;  it is already stated in file beamCommonProcess/bdcuSetup/setup.properties
Therefore has no impact

These following overrides are commented out according to the requirement in bug 89373;  
The removal of them is made possible by the  firmware updates to the electrometers. 

Although the operational scenario was played with these overrides present , the removal of them does not invalidate the operation scenario played as it has no clinical impact.

-bms.electrometer.fwVersion=A.5.4.59,A.4.4.47
+#bms.electrometer.fwVersion=A.5.4.59,A.4.4.47
@@ -51 +51 @@
-bms.electrometer.swVersion=A.5.4.59,A.4.4.46
+#bms.electrometer.swVersion=A.5.4.59,A.4.4.46

-bms.electrometer.fwVersion=A.5.4.59,A.4.4.47
+#bms.electrometer.fwVersion=A.5.4.59,A.4.4.47
@@ -51 +51 @@

-bms.electrometer.swVersion=A.5.4.59,A.4.4.46
+#bms.electrometer.swVersion=A.5.4.59,A.4.4.46


# PTS ; r12.1 ; random Issues encountered

BLCU not starting ; Fixed by restarting in controltools

Not able to acknowledge temperature and pressure in dosimetry manager; check the permissions of the user, is userdb.csv updated in the site config 

## Beam stuck in EnablingBeam state

When? Attempt to shoot a LUT

What? BDCU stuck in “EnablingBeam” state 

Why? noise on IC cyclo 

--Abnormal beam of low intensity detected on IC cyclo--

Fixed how?  Increased the tolerances in BDCU setup.properties by adding the following lines:

bms.blockingSafetyParametersChecking=false

bms.bds.bdc.emTr1IcCyclo.intThresholdAValue=5e-7

bms.bds.bdc.emTr1IcCyclo.noBeamThresholdAbnormalBeamSideA=2.5e-7

bms.bds.bdc.emTr1IcCyclo.noBeamThresholdAbnormalBeamSideB=1.5e-7

MID 61719 was followed to define a sideB factor

Add to BDCU setup.properties 

bms.bds.bdc.emTr1IcCyclo.SideBAdditionalOffsetCompensationFactor=359

Then remove the increased tolerances in the previous step

After defining the sideB factor, able to successfully shoot an LUT without any abnormal beam errors.

## Run a noise map

A noise map was also ran as a baseline, and it is generally quite okay, but we see the “signature” spike at around 230Hz which is inherent to the 1kV electrometers.

## Firmware of BPMs and bcms1

When trying to do the initialisation, 

all the BPMs and bcms1 are “DISCONNECTED”, 

and looking from the logs 

BCP not liking the firmware installed on them, 

but is fine when rolling back to R11.

## try to shoot a map, 

why?  to see if we had any abnormal beam pauses, 

## T&P correction factor showing NaN 

Check the site config; 

Check the hardware upgrade task for the sensors; bug

however we still couldn’t load irradiation settings on BMS standalone. 

This was due to the tolerances on the CF also being “NaN”. Changing them to actual numbers allowed us to load the irradiation.

Unable to Prepare on BMS standalone due to the error  "Error during beam enabled check activity. Error beam enabled still present after un-prepare burst. Timeout", 

same with manually using BCP, 

why?  RTCBs aren’t getting the beam enable signal from the TSS

beam enable signal to the RFCU and SGCU that we are missing. 

## 2kV EMIO 

Even though we were able to shoot beam with the current EMIO, we can’t be sure it will be okay during irradiations, so the EMIO was swapped with the 2kV EMIO in stock 

stock picked under WO-00157540 which I created for the swap

and the CCI completed 

## Error during beam enabled check activity. Error beam enabled still present after un-prepare burst. Timeout", 

it is a failure of a check during the prepare which is done by preparing a map 

‘Enable beam” is sent to TSS and returns the “Beam Enabled” than un-prepapring the map. 

With the unprepared, the “Beam Enabled” goes into “Not OK” state and the TSS expects to see it through the electrometers / RTCBs relays. 

If it doesn’t see the difference between the relays when the map is prepared and unprepared, it fails the checks and the prepare is aborted. The details can be found under http://bugzilla.lln.iba/show_bug.cgi?id=91431

As this check during the prepare was added during the PTS 11.0.3 and Newcastle (running on PTS 11.0.4) doesn’t face any clinical issue with the check, we can safely assume that something is wrong with the IC Cyclo electrometer relay check as this is the only one different. 

Did you do the “BSS initialization” before trying the prepare ? 

It does the same relay check which is mandatory before being allowed to prepare on BCP. Here is what I have found about it in MID69836 : 

“Make sure that the 2 relays of the electrometer, used to send the “No Beam” and “Enable Beam” signals are not stuck. This will be done by stopping the acquisition on this electrometer during the BSS initialize activity and checking that the signal transition by questioning the SRCU. If the “No Beam” signals is not changing the activity will be considered as failed and it will not be possible to perform a beam preparation. If the “Enable Beam” signal is not changing a warning will be displayed to the operator and the user will have to enter its credentials when preparing a beam to acknowledge the fact that a check is bypassed.”

# PTS ; r12.1 ; Site team preliminaries 

## Site team run MID 18829 

## Collision Avoidance Calibration (MID 91046) 

## Upgrade kits (UKs)

It was mentioned to check wiht Oliver about these -- who is Oliver ? 

PR-108471   

PR-106051

Site team or flying engineers to upgrade the hardware

## Weekend 1

CU's 

Normally already completed. 

## Weekend 2

Initial PTS-12.1 startup

Prepare site config  

MID 91046 Collision Calibration 

New CSV file for User.csv

Java previously updated.  

Cogent Bridge should stil be updated.  

PCU Kernal. 

hpv3b to HPv3c 

## Weekend 3

ACU-4.0 install

Install PTS-12.1.0 in clincal

Two SRCU versions were needed in f10
 
## Install Cogent Bridge 

Install cogent license 
 
CU Upgrade 

All CU's impacted besides ACU and XCU 

Cathy confirms MID 49095 not required.  
 
## Weekend of 7/8 Aug 

Need general resource to help with any wiring work still remaining.  

No PMS or Cyclo resources available.  
 
## Site config updates

WHEN UPGRADING A PTS ALWAYS CHECK THE ICOMP VERSION IN THE POM.XML FILE !!!!!!!

## Updating the userdb.csv file in the site configs

used an exe from Ben R to generate the password and then paste it to the userdb.csv file

## Installation of bdcu 

## Roll back archestra and historian 

## Cards srcu and blcu back  

## safekey

shut off CGCU 

swap CF card 

Wait to be online  -  ping ? 

Open safe desinger 

follow 48462 

flash new safe code 

Perform ACK with screw driver or remotely 

Repeat the same for CBCT 

power both cabinet off 

power both on a the "same time" 

After upgrading to pts12, no communication with pcu
So can't get proximity process and positioning p to work
Can ping it fine

tcs@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated> ./start_stop.sh -o 27 TR_NB=1

tcs@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated> ./start_stop.sh -o 30 TR_NB=1 

The flag workspace/runtime/USE_WORKSPACE_TR1 is set. Adding the local config on classpath

# PTS ; PCU

Add the following /linuxemb/stretch32 entry in the mcrs3:/etc/exports file:

` /linuxemb/stretch32 *.<domain>(rw,no_root_squash,sync,no_subtree_check)  `

where <domain> is your domain name, catpc.org for example. 

You must then ask the NFS server to reread its configuration with the command exportfs -r -a.

![](files/2022-02-18-18-16-06.png)

Caen , before changing anything

![](files/2022-02-18-18-19-13.png)

![](files/2022-02-18-18-19-54.png)

![](files/2022-02-18-18-20-16.png)

mcrs3:/linuxemb/tftpboot # ln -s /linuxemb/stretch32/boot/vmlinuz-4.9.0-8-rt-686-pae vmlinuz-pcu1-stretch

mcrs3:/linuxemb/tftpboot # mv initrd-pcu1 initrd-pcu1-backup18feb22

mcrs3:/linuxemb/tftpboot # ln -s /linuxemb/stretch32/boot/initrd.img-4.9.0-8-rt-686-pae initrd-pcu1

mcrs3:/linuxemb/tftpboot # mkdir backups

 mv initrd-pcu1-backup18feb22 backups/

![](files/2022-02-18-18-29-45.png)

![](files/2022-02-18-18-34-12.png)

![](files/2022-02-18-18-41-15.png)

![](files/2022-02-18-18-47-54.png)

mcrs3:/linuxemb/tftpboot/pxelinux.cfg # mv pcu1 pcu1-wheezy

mcrs3:/linuxemb/tftpboot/pxelinux.cfg # mv pcu1-r12 pcu1

![](files/2022-02-18-18-49-22.png)

![](files/2022-02-18-18-50-08.png)

mcrs3:/linuxemb/tftpboot/pxelinux.cfg # vim /etc/dhcpd.conf

comment / uncomment 

service dhcpd restart

Log in to mcrs3 on cyclhad.org with root user 

Obtained the latest zipped runtime from dropzone ,  
and put it in root user's home dir: 
wget http://victor.lln.iba/dropzone/icomp-linux-runtime/icomp-linux-runtime-2.0.tar.bz2

cd /linuxemb

There was already a stretch32 folder here so renamed this to stretch32_backup_15feb22 

unpacked the zipped folder

tar xjf icomp-linux-runtime-2.0.tar.bz2

ran setup script on the new runtime

LC_ALL=C chroot /linuxemb/stretch32 setup-runtime-post cyclhad.org 10.2.6 renovated

copied over the current ssh keys from current to new

cp -var /linuxemb/wheezy32/etc/ssh/ssh_host* /linuxemb/stretch32/etc/ssh/.

Opened /etc/dhcpd.conf and entered in the comment (to be activated on the upgrade weekend, and run service dhcpd restart)
vim /etc/dhcpd.conf
option root-path "10.2.60.13:/linuxemb/stretch32";

Also, I had to modify the following file to solve a problem of hostname and symbolic link:

jvanhec@mcrs3:/linuxemb/stretch32 $ cat /linuxemb/stretch32/usr/sbin/identifymorph

```
#!/bin/bash

if [ -n "${HOSTNAME}" ]; then
 mkdir -p /run/me
 ln -s /etc/morphs/`hostname -s` /run/me/etc
 ln -s /var/morphs/`hostname -s` /run/me/var
be
```

Use FRITES to find out versions of icomp you need when you update other sw. 

MID 45239 

Icomp runtime installation & maintenance guide 

vme@mcrs3 

Linux Terminal Server  

MID 45239 

How to roll back : 

Links to kernels in /linuxemb/tftpboot. See Section 1.2, “Kernels Configuration”.

/etc/dhcpd.conf contains the root-path, which depends on the runtime you run. 

It must be adapted accordingly. See Section 1.3, “DHCP Server Configuration”.

/linuxemb/tftpboot/pxelinux.cfg/<name> content. SeeChapter 2, CPU Board or PC Installation &
Configuration.

PCU deployment

(training with Mark) 

MID 45239 

Icomp runtime installation & maintenance guide 

Refers to -> 

PCU deployment 

ICOMP is software library containing functions for IBA software (jar c++ ?) 

Use FRITES to find out versions of icomp you need when you update other sw. 

ssh root@mcrs3 

ssh cfinch@mcrs3 
 
vme@mcrs3 
 
# Linux Terminal Server

MID48462
#BDCU ; get log messages

BDCU log messages -> can be obtained by clicking Save log on Workflow section of Bdcu on BCP. then choosing a place for it , then using filezilla to download the csv, then open with excel. 

# Template ; mission report

[template](G:\My Drive\Vault\Mission Report Template.doc)Friday June 17th

# Control units ; Example session - update ACU code 

- Receive email. e.g. from Julie Rassart "ACU clinical tag – today" 

- Prepare a new site config with the correct checksums 

- Obtain card and card reader. The card is marked as “ACU clinical” and placed with semitic card reader in the server room or tool room 

- Plug in the SEH UTN to port 51 or 50, plug in card to card reader which should be plugged in to one of the ports 

- on controltools open the seh utn monitor app, right click activate.. 

- then in TIA , browse and open the project , 

- then with it selected go to project then copy to card -- then select the card and it should copy fine.  

- ramp down -  SCC to 0 amps  --  so you can do the ACU upgrade anytime? no risks for the system? ramp down is not mandatory , we've started ramping down, we don't want to take any risk  

- ramp up 

- Shutdown the power of the ACU (SIEMENS – SIMATIC S7_1500) 

- Remove the memory card 

- Insert the memory card 

- Power on the ACU 

- Check the switch positon on the ACU, switch on RUN position  

![](files/2021-11-18-13-20-55.png)

![](files/2021-11-18-13-21-05.png)

![](files/2021-11-18-13-21-12.png)

![](files/2021-11-18-13-21-23.png)

![](files/2021-11-18-13-21-29.png)

Get the document that the instructor Andrew Ray sent to the teams chat

![](files/2022-01-19-14-06-58.png)
# PTS ; may need ; Run the software manually:

tcs@mcrs3:/TCS/runtimeStore/tcs/runtime/renovated> ./start_stop.sh -o 19

./start_stop.sh -o 10 LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig

./start_stop.sh -o 29 LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig

./start_stop.sh -sss

./start_stop.sh -sss mcr LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig

./start_stop.sh -sss tcr LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig  TR_NB=1

./start_stop.sh -sss tcr -o LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig  TR_NB=1 DISPLAY=:0
:0.0   this is the display of mcrw1 with tcs user 
:0   this is the display of tcrw1 with tcs user

./start_stop.sh -sss -o 30 LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig  TR_NB=1 

./start_stop.sh -sss tcr LOCAL_CLASSPATH=/TCS/runtimeStore/tcs/workspace/localConfig  TR_NB=1 DISPLAY=:0 TARGET=tcrw1

Exec=/TCS/runtimeStore/tcs/runtime/renovated/pts-accesspoint/runtime/pseudo-home/TCSaccesspoint/CLINICAL_stopstart_tcs --start

# PTS ; r12.1 ; Caen 15 July 

Operational scenario

# PTS ; r12.1 ; Connect laptop with hand pendant phone

Long press the green hand 

Swipe slider to put in to installation mode

Get out to phone settings

Turn bluetooth on and pair with laptop 

On laptop , right click on apk and then send-to , pick bluetooth device. 

# PTS ; r12.1 ; Troubleshoot HP problems: 

mid51395

mid52665

mid53817

mid54605

mid55362

mid59373

mid63102

mid73211

![](files/2021-11-18-13-43-54.png)

# PTS ; r12.1 ; Possible issues that may help

bug 102907

SRCU version 4.1 or 4.2  
Module IM155 6PN is missing ;  
but SRCU code expects it to be there !
Use Simatic software on control tools VM
open project, 
connect to the machine, 
then hw diagnostics (maybe)

## PTS ;  SRCU 4.2 ; srcu 4.1 ; 'no entry' light is permanently on 

"light Beam" and "no Access" are always on. 

Open this: 

bug 106051, comment 0  :

new 'ACCESS ALLOWED/FORBIDDEN' sign 

BEAM ON/OFF sign is installed |  'ACCESS ALLOWED/FORBIDDEN' sign is installed ; customer interface does not exist:

Bridge the signal permanently to 24V

In the BTB (board to board ? ): 

add a jumper on terminals X2.24a and X2.24b

open this: bug 106043 - warning should be on when doing lookup.

There's no Q110.0 in SRCU 4.x code.

Refs 

Ticket : 

https://prodg.jira.goiba.net/browse/PSD-2811

Bug: http://bugzilla.lln.iba/show_bug.cgi?id=125002 

take photo of CU units


s2c2 realtime and sequencing electronic unit web admin is on 10.2.60.48

# PTS ; r12.1 ; install dekimo configurator tool

First install java11 ,  use the how to update java...  Onenote note in this notebook

http://ogma.lln.iba:8080/dekimo-boards-configurator-continuous-SNAPSHOT/index.html

gwserver:/opt # wget http://ogma.lln.iba:8080/dekimo-boards-configurator-continuous-SNAPSHOT/dekimo-boards-configurator-continuous-SNAPSHOT-deploy.jar

Installation instructions:

Quit the BCP.

Open a terminal on the gwserver.

Download the tool using the link above and save the file in a directory accessible from the gwserver.

From the opened terminal and in the directory where you downloaded the jar file, execute the following commands:

export DISPLAY=mcrw1:0.0

java -jar dekimo-boards-configurator-continuous-SNAPSHOT-deploy.jar

Java 11 or higher is required. Usually, Java is installed in the /opt directory. To know the java version, use the command java --version from the terminal.

From <http://ogma.lln.iba:8080/dekimo-boards-configurator-continuous-SNAPSHOT/index.html> 

On mcrw ;  can open a terminal and run 

```
ssh clinical@gwserver
export DISPLAY=mcrw1:0.0
cd ~ 
java -jar dekimo-boards-configurator-continuous-SNAPSHOT-deploy.jar
```

# PTS ; r12.1 ; set up the eideu

## Example in f10

add mac address to /etc/dhcpd.conf ;

Look in wiring list in shared folder ; 

e.g. found WB322/WG97 ; 

not connected on the PSR switch side ;  

connected it to port F11 ;  

renamed the port ;  

assigned port to vlan 2 (TR1) ; 

Changed the config.bms.dedSnout to true  ; 

play MID 42599 after this ?

## Example in f15

Followed 85400 mid eideu setup procedure . 

Wb322   

Plugged in to psr cab port

B15

Assigned the port to VLAN2 ,  the vlan for TR1

Added ip entry to the hosts file. 

Have not done this yet , therefore it is not activated , and can leave the eideu connected until r12...  Changed the config.bms.dedSnout to true

Unplug this cable at end of weekend. 

EIDEU is not answering, might be the culprit

Added mac address in the /etc/dhcpd.conf

Following MID 85400 (ty smartsheet Mumbai) to set the IP

Found WB322/WG97 (ty wiring list) not connected on the PSR switch side, connected it to port F11, renamed the port and assigned it to vlan 2 (TR1)

Changed the config.bms.dedSnout to true

??? Should MID 42599 be played now ???

# PTS ; r12.1 ; random issues

## Room light command seems inverted when interacting with the HPv3

Is the iso-center light connected to the system ?

## update dekimo firmwares 

## is temperature and pressure working? 

## use AdaptPrescribe

Add the same tolerances and snout than in clinical

## Collision avoidance issue 

Gantry limited to +-18°

# PTS ; r12.1 ; preparing site config 

Updating site config following MID 100311 :

Tag SBF.110-PTS12.1-ER1 generated and installed

BMS send currently "NON_SNOUT" instead of "NONE" as snout type

EIDEU is not answering, might be the culprit

Added mac address in the /etc/dhcpd.conf

Following MID 85400 (ty smartsheet Mumbai) to set the IP

Found WB322/WG97 (ty wiring list) not connected on the PSR switch side, connected it to port F11, renamed the port and assigned it to vlan 2 (TR1)

Changed the config.bms.dedSnout to true

??? Should MID 42599 be played now ???

Automatic weight check - Leoni not moving

Thanks to Henri again for the support

Required paths are missing in the config, added them in 

SBF.110-PTS-12.1-TEST\processConfigs\src\main\resources\config\SBF.110\TR1\pms-controller\paths.txt

Gantry pit gong 

When securing the gantry pit, after only the first search button, the gong is doing a weird noise not regulard at all in frequency nor intensity

Pridex ACL 

Removed all ACL from mcrouter then added them all back as per MID5951

# 3PAR ; set to maintenance mode: 

Why? 

When the infrastructure is down, the VSP-3PAR stops sending monitoring data to HP.  

HP customer support interpret this as a failure of the 3PAR, create a support ticket and then call to inquire.  

This can be avoided by putting 3PAR to maintenance mode before the shut down. 

How? 

Open the VSP-3PAR Home Page https://f10-vsp.ppi-rccn.org 

Username: 3parcust  

Pwd: 3parInServ 

Select Support in the left-side menu. The current status of the maintenance mode is displayed there. It should be \OFF" 

Select SPmaint in the left-side menu. 

Select 3. InServ Conguration Management in the right-side menu (or 3. StoreServ Conguration Management, depending on the version of the SPOCC) 

Click the Modify button 

Set maintenance mode radio button to \ON"  

Click Update button to apply 

When prompted, set (select) the planned duration for the downtime (there is no way to set the 3PAR in maintenance mode forever) and apply 

Select Support in the left-side menu again. The current status of the maintenance mode should now be \ON" 

Notes: Maintenance mode does not hinder the regular operation of the SAN. Also, when the set duration for maintenance mode expires, the device should leave maintenance mode automatically. 

HP may call even after doing this but will be able to say that have done the correct procedure if they call.  

Who?  

SMI virtual machines (only if have smi-phy server (Proxmox server ?)) 

How?  

Open web page: smi-phy.ppi-rccn.org 

Login: 

Username: root 

Pwd: old Newcastle password 

Shutdown virtual machines: 

smis 

splunk 

Shutdown what? 

smi-p 

Shutdown how?  

ssh to smi-phy iLO board: 

ssh root@spsmi-phy 

old password 

Type 'VSP' to enter the virtual serial console 

login as 'root' 

type "shutdown -h now" 

wait for the server to turn off 

type 'Esc-(' to leave the console and return to the iLO prompt 

type 'exit' to close the iLO session 


# 3par ; Troubleshoot the 3par

Get event logs from vsp-3par

https://vsp-3par.domain.org

See this ticket:

https://prodg.jira.goiba.net/browse/PSD-1735

# 3par ; Upgrade the vsp-3par firmware

Pre-upgrade: 

check VM distribution on the cnodes

disable ATS

In vcenter:

Check paths

Latency

F09_3PAR cli% showhost -pathsum

Id Name    WWNs Ports Nodes
0 cnode01    2     4   0,1
1 cnode02    2     4   0,1
2 cnode03    2     4   0,1

3parInServ 

F09_3PAR cli% showversion

Refs:

https://prodg.jira.goiba.net/browse/PSD-838

MID_96870_0_3PAR_upgrade_documentation (2).docx

hpe 3par os upgrade procedure.pdf  

Check vsp :

https://iba2016-my.sharepoint.com/personal/ahfjf_goiba_net/Documents/Microsoft Teams Chat Files/MID_96870_0_3PAR_upgrade_documentation (2).docx

vsp VM should have at least 4gb memory , 4 cores

move storage location for vsp to be on the local cnode rather than on the 3par (datastore migration) ; 

Ask site for firewall opening

Clean space on the WS

Enable the admin account

Set it in the production network

Download the HPE' Code'

Has to be powered ON

VMWare vmotion VSP + hw upg.VSP:	

Need 4GB RAM, 4vCPU Storage to migrate local datastore of cnode

Check VMWare FCoE driver

3PAR Health check:

Run commands listed in HPE upgrade doc and email

Verify status on VSP

Reply to HPE mail with health check results

Verify backups of VMs are up to date

Acquire Baseline latency to cnodes

Disable ATS	

Start the HPE myRoom connection, 

follow HPE engineer operation	

Windows WS preparation and code download

Ask site for firewall opening

Clean space on the WS

Enable the admin account

Set it in the production network

Download the HPE' Code'

Has to be powered ON

These items are done:

Ask site for firewall opening

Clean space on the WS

Enable the admin account

Set it in the production network

where to get this code  ? 

https://hpe-my.sharepoint.com/:f:/p/manish_bisht/Egz0ghMXHn5LowAJJGPccVoBjljMfZmZCT6cggUem_F08w?e=TGnEGi

I ran the healthcheck on 3par and seems fine, to check the peer motion license warning

meanwhile I went through the 3par checks, all seems right concerning 3par health

only thing is the version of vmware's `lpfc` driver which in fact seems impacted by the PSOD customer advisory

https://support.hpe.com/hpesc/public/docDisplay?docId=emr_na-a00020440en_us

to be checked if we do need to upgrade drivers before wednesday

SVmax workorder WO-00149700

https://hpe-my.sharepoint.com/:f:/p/manish_bisht/Egz0ghMXHn5LowAJJGPccVoBjljMfZmZCT6cggUem_F08w?e=TGnEGi

now asks for credentials , and so I am unable to open the one drive folder to download files.. 

ignore that ;  I see they sent a new link :


3PAR-VSP machine has been migrated to local datastore of cnode02, vCPUs=4, RAM=4GB

cnode3 Datastore latency 

cnode01 datastore latency

cnode02 datastore latency

ok, when they open firewall, can do the pre-upgrade: 

check VM distribution on the cnodes

disable ATS

https://www.myroom.hpe.com/attend/MRH7NDNEK77YL

open it from the physics workstation so that they can access files

then a second session can be opened from your laptop

VM distribution before upgrade/reboot 

share the path to the .iso files in the myroom?

all storage paths for each cnode active after node0 restart, will do the 1 

upgrade completed by hpe, starting now the post-upgrade steps

Mock

schedule a 1h downtime for 3par-vsp in nagios.

health checks done, all good on f15

.iso download 

install putty on the local ws

backup is fine, at least from boring

vsp has been upgraded to 4gb 4cores earlier

Health checks on array and nodes done 30-mar-2021

upgraded VSP to 4GB RAM + 4vCPUs

Health checks on 3par array

Backup status checked on boring, ok

From <https://prodg.jira.goiba.net/browse/PSD-939> 

f10-3par logged in as 3paradm

Move VMs off cnode01 to cnode02 or 3  ,  

then put in maintenance mode, 

Then reboot cnode 01 ;

Same for 1 and 2

On vsp the password has been changed to the root password

Check out Mid 96870

win7 box on site 

there is a folder on the desktop called '3par upgrade' with the several iso files inside 

OS upgrade from 3.2.2 MU6 to 3.3.1 MU5

SP upgrade to 5.0.8.0 

Please launch the SPOCC 

Is the VSP configured to 4 Core CPU and 4 GB RAM? 

yes, it has been upgraded recently 

also its storage is outside of 3par 

Do you have 5.0.8.0 downloaded? 

Could you please increase the size of the putty session 
 
Windows will prompt you to overwrite the current file (unless it is the first configuration). Note: you must cut the file, not copy. If you leave the hashconfig in the config folder it will not work.

# AI

Site requests a new AI site configuration: MID-107094

site generates a new zip file of the config. 

Download the attached config zip file from the bug. 

git clone http://cfinch@brigit.lln.iba:5000/adaptinsight-config

Prepare a clean repo git status, git pull

Prepare a list of differences in the files attached to their request
write a list of modifications present in the config files. 
Check their differences against their request comments.
compare these modifications to the request 

merge these changes in to the repo -- how to do this ?   be careful of the fileformat, it may require to run dos2unix on the files

Update config_version.xml and other dependent files (config_application.xml, config_notification.xml).

commit the changes

git push 

Check the commit for accuracy

git tag <tag name>

git push --tag 

starts build job on TeamCity -- this builds the AI configuration package and uploads it to http://nexus.rnd.goiba.net/#browse/browse:adaptinsight. 
The build merges 3 dirs to make the zip file
default local, go inside the default base of the local folder of the AI config
site local ; files in here copy over the files in default local 
files in local directory come from the default local with site local files overwritten on them 

Pdg-release.sh & MID-56441

comment in the tracking bug. 

adaptinsight-config repo: 

## global file has changed?

compare the files in the root of the zip file to the files for the target version of AI -- where? in the default global directory in Git.
at the root level == below the config folder in AI; 

Site wants to change a global file?

check-in a copy of this file into the site local repository

## site wants to change something in local ? 

file is in the site local Git repo? and in the default local ? , 

diff against local git repo not the one in default local. 

file is in the site local Git repo? and not in the default local ?   

diff against the default local version of this file. 

the file in the default local is different? it has changed ?  

add this file to the site local Git repo  


open the zip file:

global default files are not modified ? 
all the timestamps should be the same ,  if one is different then it was added at that time from the nexus release .. 
compare the timestamp of the global files in the AI configuration zip file 
look at the date and time from the last release on Nexus. 
zip file will have the same timestamp given to each file that was added to the zip archive. 

file is in site local repo?, check the difference against this location. 

the file does not exist in the site local repository? check against the default local repository, 

changes don't match ? 

Assign bug to site CCB 

comment with what did not match. 

ask them to update the request in the tracking bug.

update config_version.xml 

it should be the targeted tag version  

config_application.xml:

AI target version is below 2.2.x.x ? - 

<clinical> tag is correctly set as either true or false?, 

correct path is given for the DICOM cache of the intended version? (d:\imagx_validation vs d:\imagx_clinical)

AI target version is equal or above 2.2.x.x ?  

config_application.xml -->  <installationMode> tag is correctly set as either clinical, validation, calibration or development. 

Check whether the correct path is given for the DICOM cache of the intended version (d:\imagex_validation vs d:\imagx_clinical).

config_notification.xml

AI target version is below 2.2.x.x ? 

Check config_notification.xml and verify that the correct notification port is selected. 

if they request a tag without mentioning this value, they do not want it changed. 

if a clinical version ,  then check the notification port is clinical.

AI target version is equal or above 2.2.x.x ?

notification port is no longer specified as a single value, 

it is split into <clinicalPort> and <notClinicalPort> tags. 

The port which is used is linked to the <installationMode> tag we discussed directly above (see MID-73752, adaPTinsight configuration guide). 

installation mode is set to clinical, then AI will use the port specified in the <clinicalPort> tag. 

If the installation mode is set to validation, calibration, or development, then AI will use the port specified in the <notClinicalPort> tag. 





git commit –a –m “[SCOPE #####] - some description of your changes here.”

git push

git diff 

git tag <tagname>

git push --tag

AI tag name <tagname> : 
Site name	= pat109-upenn
Room type = CGTR, CGTR_CBCT, FBTR, GTR, GTR_CBCT, IBTR
Room number	= 1
adapt insight version (see the display in AI app) : 2.1.0c 
Config version:	A, A1, 1.0_RC1, 1.1
Examples:
pat109-upenn-GTR_CBCT-4-2.1.0c-A 
sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0_RC5



view tags:  

git tag | grep “pat109”




run script anywhere inside of the room specific dir to get a list of tags created for that room. 

pdg-release.sh coretag v1 v2 

concatenation of the coretag and the v makes up the full tag name. 

tag has been built and is available on Nexus?

Open http://nexus.rnd.goiba.net/#browse/browse:adaptinsight 

package is available? 

make a list of mids for them to play: MID-56441,

http://nexus.rnd.goiba.net/#browse/browse:adaptinsight

A full summary of differences between this version and the previous version has been attached to this bug.

The following verification TPOs are necessary to validate this configuration:

assign the configuration request back to the site CCB. 

check config_application.xml, config_notification.xml, and config_verison.xml


the script:

cd ~

mkdir bin (only if the bin directory does not exist)

```
cp <adaPTinsight-config repository path>/prodg-service/*.sh ~/bin/
```

compares two tags and generates a diff file for you, which will be stored by default in ~/AI/diffs. 

produces some text that can be copied to the tracking bug to announce the release.




The pdg-tags.sh script gives you a list of the tags for the site-specific or room-specific section of the repository  


 
contact TeamCityAdmin@iba-group.com and inform them that you need read access to the AI config build projects. 

AI_ICT (Install Configuration Tool) 

downloads the AI configuration zip file from http://nexus.rnd.goiba.net/#browse/browse:adaptinsight 

installs it on the selected computer system. 

see MID-66385 and MID-57795. 

manual instructions for when the AI ICT cannot be used on site to MID-107094 (AI Configuration Request Process) 


more scripts: 

pdg-release-config.sh -p pat109-upenn-GTR_CBCT-5-2.1.0d-G -t pat109-upenn-GTR_CBCT-5-2.1.0d-H -b PRS123456 -p G




LOCAL DIFF

git diff $TAG_1 $TAG_2 -- $WORKING_DIRECTORY 

GLOBAL DIFF

git diff $TAG_1 $TAG_2 -- $REPOSITORY_ROOT"default/local/" 

git diff $TAG_1 $TAG_2 -- $REPOSITORY_ROOT"default/global/" 

git diff $TAG_1 $TAG_2 -- $REPOSITORY_ROOT"hardware/" 






Clone the repo; git clone http://username@brigit.lln.iba:5000/adaptinsight-config

Download the config files that the config requester uploaded to the tracking bug. 

What files are changed in the request?   (do a diff -r ?) 

Check global files are not modified

Check modified file with existing file in site local section/repo .  

If it doesn’t exist in site local section , then check it in the default local section/repo 

Do the differences found from the diff command tally with the changes stated by the requester? 

No? -- assign request back to the site CCB . write in the comment what does not tally .  (maybe first check with more experienced guys such as Peter W) 

Merge the directories (apply the changes to the local repo)

Commit changes

git commit –a –m “[SCOPE <tracking bug number here>] - some description of your changes here.”

git push

Find out the tag name to use:

git tag | grep “pat109”

Tag name:

<site name>-<room type>-<room number>-<AI version>-<config version>

e.g.

pat109-upenn-GTR_CBCT-4-2.1.0c-A

sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0_RC5
 
git tag tagname

git push --tag

git push –tag

To http://brigit.lln.iba:5000/adaptinsight-config
 * [new tag]           pat109-upenn-GTR_CBCT-4-2.1.0c-A -> pat109-upenn-GTR_CBCT-4-2.1.0c-A
 
 
teamcity builds the config zip file

Run the script

Package now available on Nexus? http://nexus.rnd.goiba.net/#browse/browse:adaptinsight

Attach the build notification to the tracking bug
 
Maybe don’t have to do the following when using the git script ? 

Modify config_version.xml file; update the configuration version (and date?)

In config_application.xml check that the <clinical> tag is correct (either true or false)

In config_application.xml check DICOM cache path (either d:\imagx_validation or d:\imagx_clinical). 

In Check config_notification.xml verify that the correct notification port is selected. 

What PTS they will use to validate the config ?  If not mentioned , means do not want it changed. 

If the tag is clinical, check that notification port is clinical.

Use PDG-Release script. Identify the differences in the AI configuration.

Commit the changes and push them

Create the tag and push it (git push –tag)

Pdg-release.sh & MID-56441
 
Create diff:

Use pdg-release.sh for config requests.

pdg-release.sh coretag v1 v2, 

in the image above, the two tags being compared are tst500-alpha-GTR_CBCT-5-2.1.1.0-1.0 and tst500-alpha-GTR_CBCT-5-2.1.1.0-1.1. 

Attach diff of the changes (new tag to old tag) to the tracking bug.

Open http://nexus.rnd.goiba.net/#browse/browse:adaptinsight and confirm the package is available. 

pdg-release.sh gives a template ; copy and paste it to the tracking bug, use mid56441 to add the metadoc TPOs needed.

 assign the config request back to the site CCB. 
 
Get pdg-release.sh from prodg-service folder in the root directory of the adaptinsight-config repository. 

To install this file for your use in Git repository, simply copy the file to your local user’s bin directory. You can do this with the following command:

cp /prodg-service/pdg-release.sh ~/bin/

pdg-tags script gives a list of the tags for the site-specific section of the repo

found in the prodg-service folder in the root directory of the adaptinsight-config repository. 

Example :

Index of /dropzone/adaPTinsight/AI_ICT (lln.iba)

https://metadoc.goiba.net/metapro/meta-doc.php?i_InternalRef=66385&AutoOpen=1

but you don't need to follow the full MID

as in your case you will only update the config

[PPVS-I2C-IVVP-052.4]

never delete the "clinical" folder

The AI_ICT tool :

AI_ICT (Install Configuration Tool): 

downloads the config zip file from http://nexus.rnd.goiba.net/#browse/browse:adaptinsight and 

installs it on site. 

see MID-57795. 

manual steps:

Download the configuration zip from Nexus @ http://nexus.rnd.goiba.net/#browse/browse:adaptinsight and place this file next to the config folder (when you decompress it, it will be your new config folder).

In the adaPT insight installation you want to install your new config in, delete the old config folder. (For now, you can rename it if this is more comfortable for you, but don’t forget to remove it after).

Right-click on the zipped adaPT insight configuration and click “Extract all…”. Extract the files to the current directory.

Rename the folder with your new tag name to “config”.

In the config folder, there is a file called hashconfig, 

cut (CTRL + X) this file from the config folder and paste it in the bin folder. 

Windows will prompt you to overwrite the current file (unless it is the first configuration). 

You must cut the file, not copy  --  do not leave the hashconfig in the config folder

The diff file has 4 sections:

Section 1 --->  changes to the local repository. 
 
e.g.

diff between tags sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0_RC5 and sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0

diff --git a/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_application.xml b/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_application.xml
 
```
index 80a78491..3e003be5 100644
--- a/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_application.xml
+++ b/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_application.xml
@@ -3,7 +3,7 @@
 <application>
     <!-- 8GB -->
     <memory>8589934592</memory>
-    <clinical>false</clinical>
+    <clinical>true</clinical>
     <!-- Enable CUDA for DRR projection and CBCT reconstruction-->
     <gpuActivated>true</gpuActivated>
     <minimalApplicationSpace>100</minimalApplicationSpace> <!-- GB (default 10, minimum 10) -->
diff --git a/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_notification.xml b/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_notification.xml
index 910e47b5..c53d7fda 100644
--- a/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_notification.xml
+++ b/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_notification.xml
@@ -2,8 +2,8 @@
 <!-- IBA notification service config -->
 <notification>
     <host>mcrs3.broptc.org</host>
-    <!-- port>18385</port -->
-    <port>18386</port>
+    <port>18385</port>
+    <!-- port>18386</port -->
     <reconnection>6000</reconnection>
     <container>imagx</container>
     <origin>imagxCtrl</origin>
```

diff --git a/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_version.xml b/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_version.xml

```
index 92e6f199..132e7f79 100644
--- a/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_version.xml
+++ b/sbf105-beaumont/1-CGTR_CBCT/2.1.1.0/config/config_version.xml
@@ -5,6 +5,6 @@
     <room_type>CGTR_CBCT</room_type>
     <room_number>1</room_number>
     <adapt_insight_version>2.1.1.0</adapt_insight_version>
-    <configuration_version>1.0_RC5</configuration_version>
-    <date>01/02/2020</date>
+    <configuration_version>1.0</configuration_version>
+    <date>02/02/2020</date>
 </version>
``` 

global local changes 

between tags sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0_RC5 and sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0
 
The build notification contains:

the name of the generated tag, 

where to find the generated configuration files, 

what verifications are required to be played based on an evaluation of your changes. From MID-56441 .
 
Naming:

Clinical versions are named as ‘A’, ‘B’ etc.  

Non-clinical versions are like 0, B1 etc. 
 
New names since AI 2.1.1.0 

Major version will always be 1. Clinical tag would be created like 1.0 

e.g 

sat126-dallas-GTR_CBCT-3-2.1.1.0-1.0
 
Non-clinical (for verification) versions:

1.0_RC1 or 1.1_RC8 

e.g. 

sat126-dallas-GTR_CBCT-3-2.1.1.0-1.0_RC1 

Unfinished configuration has a trailing WIP

e.g. 

sat126-dallas-GTR_CBCT-3-2.1.1.0-1.0_WIP
 
refs:

MID-53375.
 
Config zip file is a merge of the following folders in the git repo:

default global folder, 

default local folder, 

site local folder. 
 
Role of each file within the AI configuration, read MID-56441.
 
Files in the default local repository are overridable by files in the site local section of the Git repository. 

This happens when the default behavior must be modified in a room specific way. 

Files in the config zip “local” directory will come from the default local or site local Git repositories. 

If the file exists in the site local Git repository, the diff must be performed against this file. 

If the file does not exist in the site local Git repository, then you must perform a diff against the default local version of this file. 

If the file is different, then you will have to add this file to the site local Git repository as it represents a site local edit. 

Below is a graphical representation of how the AI configuration zip file is composed:

e.g. 

config_smi.xml, 

the version of this file in the default local repository enables PRIDEx with default parameters. 

Now let’s say the site has a site local copy of this file that disables PRIDEx. 

If we delete the site local copy of config_smi.xml, the build process will then use the version from the default local repository, and PRIDEx will be re-enabled. 

In fact, this is typically how we turn PRIDEx on for most sites, by removing their local copy of config_smi.xml.
 
Check timestamps: 

Get the date and time from the last release on Nexus. 

The generated AI configuration zip file will have the same timestamp given to each file that was added to the zip archive. 

Compare the timestamp of the global files in the AI configuration zip file given by the site to make sure there were no edits to these files. 

112296  -- this is the test bug 

se-release.sh 

refs:

AI Configuration Request Process

Install and Update AI configuration

64187: AI Checklist Clinical Configuration
 
\\llnfs03\Departments\ISO\IBTM\Trainings\AI config\AI Configuration Release Training - 11 jan 2019
 
Prepare a list of differences in the files attached to their request
 
Make a list of files that are changed in this request

Download the config files that the config requester uploaded to the tracking bug: 

Confirm that the global default files are not modified:

Look at the date and time from the last release on Nexus. 

The generated AI configuration zip file will have the same timestamp given to each file that was added to the zip archive. 

Compare the timestamp of the global files in the AI configuration zip file given by the site to make sure there were no edits to these files. 

Site local section:

If a site wishes to change one of these files, then a copy of this file must be checked into the site local section of the repository. 

refer to the AI 2.1.0d config of Prague, where the customer needed to override HU2DensityPresets.xml in the global files. 

They inserted a copy of this file in their site local section of the repository.
 
Local defaults and site local files 

check diff against the changes listed by the requester. 

Update the config_version.xml file to the new version.

In config_application.xml check that the <clinical> tag is correct (either true or false)

In config_application.xml check DICOM cache path 

either d:\imagx_validation or d:\imagx_clinical

In Check config_notification.xml verify that the correct notification port is selected. 

You need to know what PTS they will use to validate the config. 

If the tag is clinical, ensure the notification port is clinical.
 
Use PDG-Release script. 

Identify the differences in the AI configuration.
 
Check their differences against their request comments.

Update config_version.xml and other dependent files (config_application.xml, config_notification.xml).

Commit the changes and push them

Check the commit for accuracy

Create the tag and push it (git push –tag)

Pdg-release.sh & MID-56441

Once package is available on Nexus, the configuration creator attaches the build notification to the tracking bug. 

e.g. Engineer on site makes changes and tests
 
Site starts with a fresh copy of the current configuration , downloaded from Nexus.
 
Site updates the geocal
 
Engineer performs validation and mock workflow
 
Engineer attaches ‘about TCS’ to any AI TPO. 

(Log in to AI as "therapist". Click on the gear icon. select "About", Take screenshot)
  
Engineer on Site makes request
 
Engineer requests a new config to be generated in tracking bug
 
Engineer attaches config to the request in tracking bug
 
Engineer assigns bug to AIConfigUpgrade@cernunnos. 
 
Prodg Receive request, 

Prodg lists the modifications in the attached configuration files. 

Prodg compares modifications to the request 

Check that the changes found are the same as the changes in the request’s Changes section. 

Prodg Commits the changes to the site’s repo. 

Prodg Creates a new git tag 

TeamCity then builds the config package.

TeamCity uploads it to http://nexus.rnd.goiba.net/#browse/browse:adaptinsight. 

Prodg adds the comment to the bug
 
Commit the changes to the local repository.

Write down the number of the tracking bug. 

commit changes to your local repository

git commit –a –m “[SCOPE <tracking bug number here>] - some description of your changes here.”

git push

Find out the tag name to use:

git tag | grep “pat109”

Tag name:

<site name>-<room type>-<room number>-<AI version>-<config version>

e.g.

pat109-upenn-GTR_CBCT-4-2.1.0c-A

sbf105-beaumont-CGTR_CBCT-1-2.1.1.0-1.0_RC5
 
git tag tagname

git push --tag

git push –tag

To http://brigit.lln.iba:5000/adaptinsight-config

pat109-upenn-GTR_CBCT-4-2.1.0c-A -> pat109-upenn-GTR_CBCT-4-2.1.0c-A
 
teamcity builds the config zip file
 
Create diff:

Use pdg-release.sh for config requests.

Open http://nexus.rnd.goiba.net/#browse/browse:adaptinsight 

package is available?

pdg-release.sh gives a template ; 

copy and paste it to the tracking bug, 

use mid56441 to add the metadoc TPOs needed.

assign the config request back to the site CCB. 
 
Get pdg-release.sh from prodg-service folder in the root directory of the adaptinsight-config repository. 

copy the file to your local bin dir 

cp /prodg-service/pdg-release.sh ~/bin/

The AI_ICT (Install Configuration Tool) downloads the config zip file 

from http://nexus.rnd.goiba.net/#browse/browse:adaptinsight 

and installs it on site. 

see MID-57795. 

manual:

Download the configuration zip from Nexus @ http://nexus.rnd.goiba.net/#browse/browse:adaptinsight and place this file next to the config folder (when you decompress it, it will be your new config folder).

In the adaPT insight installation you want to install your new config in, delete the old config folder. (For now, you can rename it if this is more comfortable for you, but don’t forget to remove it after).

Right-click on the zipped adaPT insight configuration and click “Extract all…”. Extract the files to the current directory.

Rename the folder with your new tag name to “config”.

In the config folder, there is a file called hashconfig, cut (CTRL + X) this file from the config folder and paste it in the bin folder. 

# Archestra - set up a new user 

Add a new windows user ; 

Have added the windows user to the windows groups of 

'Advanced Operator' and 

'Remote Desktop User' 

After logging out and back in  , the user is able to use Archestra now .

Example:

New user for uzl2 archestra 

UZL_User01

From <https://prodg.jira.goiba.net/browse/PSD-905> 

User : UZL_User01

Password : User_UZL_01

Group : Advanced operator

# Backups ; Set up backups

Configure backup/DR tasks using /etc/ibatab

Schedule backups and disaster recovery using root’s crontab

To receive emails:

add yourself to the /etc/alias list

run `newaliases`

# Backups ; Restoring from backup

When restoring a file from mcbackup:/FS_bkup/tcs_usrb/cfinch/test_file for example, can use rsync 

Why use rsync? because you can use archive mode to copy it back without changing the modified date or owner etc. 

Could also use rdiff, but perhaps if just restoring a file it is much easier to just use rsync to copy to file back  

# Backups ; Using the tape autoloader

On the autoloader, the main menu should be showing (press Enter to display it if screen is off) 

Press Enter. The display should show: Status / Information

Press Next until you reach "Operations" and press Enter 

Press Next until you reach "Unlock Left Magazine" and press Enter 

This should show on the screen .. Unlock Mag .. Drive RDY

Wait until < - Left Magazine Unlocked shows on the screen.  

Left magazine tray should now be unlocked. Pull the left tray out until the two tapes are exposed (careful not to pull the tray completely out) 

Push from the back side of the tape to remove it 

After putting in the new tapes, it will scan the tapes. 

This might take a few minutes…  

Make sure the Autoloader screen goes back to the default with the green “Ready” light 

# Backups ; Changing the tape protection

./omnidb -session 2021/04/02-4 -change_protection none

# Backups ; checking backups

Check that all the CU on site have an up to date backup card ready on a dedicated shelf.

- ACU
- CBCTCNSHCU
- CGCU
- BLCU
- XCU
- SRCU
- SEW driver
- PPSCU (Hard drive +load cell for forte or MCU/ACU/Safety for Leoni)
- Adapt Insight Hard Drive

```csv
Site,CU,Type,Label,Location,version,Created on,Software used,Memory card reader used,Card size
F10	ACU,SD card,ACU1,Installed,ACU-C3.5a,-,TiA,Normal card reader,24MB
F10	ACU,SD card,ACU2,red pencil case; fire safe	ACU-C3.5a	03-Feb-21	TiA	Normal card reader	24MB
F10	SRCU,Siemens MMC,SRCU1,Installed,SRCU-A3.1,-,S7,Siemens prommer,2MB
F10	SRCU,Siemens MMC,SRCU2,red pencil case; fire safe,SRCU-A3.1,03-Feb-21,S7,Siemens prommer,2MB
F10	BLCU,Siemens MMC,BLCU1,Installed,BLCU-A4.0,-,S7	Siemens prommer,4MB
F10	BLCU,Siemens MMC,BLCU2,red pencil case; fire safe,BLCU-A4.0,03-Feb-21,S7,Siemens prommer,4MB
F10	XCU 	Compact flash 	XCU1 	Installed 	XCU-A3.1	-	Automation Studio 4.2	Normal card reader,512MB
F10	XCU 	Compact flash 	XCU2 	red pencil case; fire safe	XCU-A3.1	03-Feb-21	Automation Studio 4.2	Normal card reader,512MB
F10	Leoni MCU 	CFast	L MCU1 	Installed 	To find out	05-Dec-20	G4L 	Normal card reader	
F10	Leoni MCU 	CFast	L MCU2 	red pencil case; fire safe	To find out	05-Dec-20	G4L	Normal card reader	
F10	Leoni ACU 	CFast	L ACU1 	Installed 	To find out	05-Dec-20	G4L	Normal card reader	
F10	Leoni ACU 	CFast	L ACU2 	red pencil case; fire safe	To find out	05-Dec-20	G4L	Normal card reader	
F10	CGCU	Compact flash 	CGCU 1	Installed		-	Automation Studio 4.2	Normal card reader,512MB
F10	CGCU	Compact flash 	CGCU 2	red pencil case; fire safe		05-Feb-21	Automation Studio 4.2	Normal card reader,512MB
F10	CBCTCNSHCU	Compact flash 	CNSH 1	Installed	CNSHCU5.0	-	Automation Studio 4.2	Normal card reader,512MB
F10	CBCTCNSHCU	Compact flash 	CNSH 2	red pencil case; fire safe	CNSHCU5.0	05-Feb-21	Automation Studio 4.2	Normal card reader,512MB
F10	WMEBCU	Compact flash 	WMEBCU 1	Installed		-	Automation Studio 4.2	Normal card reader,512MB
F10	WMEBCU	Compact flash 	WMEBCU 2	red pencil case; fire safe		05-Feb-21	Automation Studio 4.2	Normal card reader,512MB
F09	ACU 	SD card 	ACU1 	Installed 			TiA	Normal card reader	
F09	ACU 	SD card 	ACU2 	red pencil case; fire safe			TiA	Normal card reader	
F09	SRCU 	Siemens MMC 	SRCU1 	Installed 			S7	Siemens prommer	
F09	SRCU 	Siemens MMC 	SRCU2 	red pencil case; fire safe			S7	Siemens prommer	
F09	BLCU 	Siemens MMC	BLCU1 	Installed 			S7	Siemens prommer	
F09	BLCU 	Siemens MMC	BLCU2 	red pencil case; fire safe			S7	Siemens prommer	
F09	XCU 	Compact flash 	XCU1 	Installed 			Automation Studio 4.2	Normal card reader	
F09	XCU 	Compact flash 	XCU2 	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F09	Leoni MCU 	CFast	L MCU1 	Installed 			G4L 	Normal card reader	
F09	Leoni MCU 	CFast	L MCU2 	red pencil case; fire safe			G4L	Normal card reader	
F09	Leoni ACU 	CFast	L ACU1 	Installed 			G4L	Normal card reader	
F09	Leoni ACU 	CFast	L ACU2 	red pencil case; fire safe			G4L	Normal card reader	
F09	CGCU	Compact flash 	CGCU 1	Installed			Automation Studio 4.2	Normal card reader	
F09	CGCU	Compact flash 	CGCU 2	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F09	CBCTCNSHCU	Compact flash 	CNSH 1	Installed			Automation Studio 4.2	Normal card reader	
F09	CBCTCNSHCU	Compact flash 	CNSH 2	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F09	WMEBCU	Compact flash 	WMEBCU 1	Installed			Automation Studio 4.2	Normal card reader	
F09	WMEBCU	Compact flash 	WMEBCU 2	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F15	ACU 	SD card 	ACU1 	Installed 			TiA	Normal card reader	
F15	ACU 	SD card 	ACU2 	red pencil case; fire safe			TiA	Normal card reader	
F15	SRCU 	Siemens MMC 	SRCU1 	Installed 			S7	Siemens prommer	
F15	SRCU 	Siemens MMC 	SRCU2 	red pencil case; fire safe			S7	Siemens prommer	
F15	BLCU 	Siemens MMC	BLCU1 	Installed 			S7	Siemens prommer	
F15	BLCU 	Siemens MMC	BLCU2 	red pencil case; fire safe			S7	Siemens prommer	
F15	XCU 	Compact flash 	XCU1 	Installed 			Automation Studio 4.2	Normal card reader	
F15	XCU 	Compact flash 	XCU2 	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F15	Leoni MCU 	CFast	L MCU1 	Installed 			G4L 	Normal card reader	
F15	Leoni MCU 	CFast	L MCU2 	red pencil case; fire safe			G4L	Normal card reader	
F15	Leoni ACU 	CFast	L ACU1 	Installed 			G4L	Normal card reader	
F15	Leoni ACU 	CFast	L ACU2 	red pencil case; fire safe			G4L	Normal card reader	
F15	CGCU	Compact flash 	CGCU 1	Installed			Automation Studio 4.2	Normal card reader	
F15	CGCU	Compact flash 	CGCU 2	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F15	CBCTCNSHCU	Compact flash 	CNSH 1	Installed			Automation Studio 4.2	Normal card reader	
F15	CBCTCNSHCU	Compact flash 	CNSH 2	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
F15	WMEBCU	Compact flash 	WMEBCU 1	Installed			Automation Studio 4.2	Normal card reader	
F15	WMEBCU	Compact flash 	WMEBCU 2	red pencil case; fire safe			Automation Studio 4.2	Normal card reader	
```

# Backups ; Deal with a corrupted Leoni-acu or Leoni-mcu card 

As it was not possible to access the Leoni Webpage anymore, site team and remote support concluded to a possible corruption of the ACU card of the PPSCU cabinet. 

Indeed, the webpage was not accessible from the MCR through the site network IP 10.2.131.71:8081 

nor from the maintenance ethernet access in the front panel of the Leoni cabinet.

This issue has already been observed on another site: see bug # 94439

No ACU back-up cards were available on site, so we ended-up trying to flash a new one from zero. 

To that extent, we used an original image of the ACU available on the network and the G4L tool, following the Leoni procedure (see details in section below).

The ACU image used was a generic one, working for every site (to be confirmed). 

So, we had to edit configuration files at some point; mainly to deal with the network configuration of the site.

Finally, the new card being flashed  and the config files being edited, we were able to recover full communication and access to the Leoni webpage as well.
 
After having flashed the CFAST card with Leoni ACU image using G4L tool, the following folders/files were installed: 

Leoni ACU CFAST card content

1. Following the path /usr/local/lib/, you can find the “orion-app” directory containing some configuration files. 

Both “main.yml” and “user.yml” files contain configuration parameters. These parameters can be retrieved from the old card or Leoni. 

2. Following the path /etc/network/, you can find the “interfaces” file containing the IP configuration that needs to be edited according to the site’s network settings. 

3. Following the path /etc/udev/, you need to make sure that the folder “rules.d” is empty. This folder normally contains a file with MAC addresses of hardware parts. If the folder is empty, the file is automatically generated by the script with the right information. 

# Backups - Generate barcodes for tapes

(base) ➜  trunk pwd
/home/cfinch/svn/sysadmin/backupj/trunk
(base) ➜  trunk ./LTO_barcode_gen -s F09 -i 1  barcodes_for_f09.pdf


it requires "barcode" to be installed linux
​
you just need to > file.pdf  
​
Nice's backup schedule

# Backups ; Configure the backup schedule in cron 

## Example from Nice

datarec:

00 5 * * 2-6 /products/backupj/cmw_backup -t D -o /FS_bkup -s n -l > /var/log/backup/backup.log.`dow` 2>&1

mcrs3:

00 3 * * 0 /products/backupj/cmw_backup -t F -o /FS_bkup -l > /var/log/backup/backup.log.`dow` 2>&1

40 4 * * 2-6 /products/backupj/cmw_backup -t D -o /FS_bkup -s n -l > /var/log/backup/backup.log.`dow` 2>&1

nexus:

30 1 * * 1-5 /products/backupj/cmw_backup -t D -o /FS_bkup > /var/log/backup/backup.log.`dow` 2>&1

subversion:

00 1 * * 1-5 /products/backupj/cmw_backup -t D -o /FS_bkup > /var/log/backup/backup.log.`dow` 2>&1

gwserver:

00 5 * * 1-5 /products/backupj/cmw_backup -t D -o /FS_bkup -s n -l > /var/log/backup/backup.log.`dow` 2>&1

00 5 * * 7   /products/backupj/cmw_backup -t F -o /FS_bkup -l > /var/log/backup/backup.log.`dow` 2>&1

mcrs4:

30 21 * * 1-5 /products/backupj/cmw_backup -t D -o /FS_bkup -s n > /var/log/backup/backup.log.`dow` 2>&1

mcbackup:

00 20 * * 0 /products/backupj/cmw_backup -t F -f mcbackup_all_fs -l > /var/log/backup/backup.log.`dow` 2>&1

00 21 * * 1-5 /products/backupj/cmw_backup -t D -f mcbackup_no_vmbkup -s n -l > /var/log/backup/backup.log.`dow` 2>&1

mcrw1:
Full iso backup :  Monday at 1am 

tcrw1:
Full iso backup : Tuesday at 1am 

## Example from Bomarsund

datarec: 

00 5 * * 1-5 /products/backupj/cmw_backup -t D -o /FS_bkup -s n -l > /var/log/backup/backup.log.`dow` 2>&1

00 5 * * 7   /products/backupj/cmw_backup -t F -o /FS_bkup -l > /var/log/backup/backup.log.`dow` 2>&1

mcrs3:

00 3 * * 0 /products/backupj/cmw_backup -t F -o /FS_bkup -l > /var/log/backup/backup.log.`dow` 2>&1

40 4 * * 2-6 /products/backupj/cmw_backup -t D -o /FS_bkup -s n -l > /var/log/backup/backup.log.`dow` 2>&1


# Backups - Replace fair or poor tapes with new ones.

Create barcodes pdf -- done

Follow mid5951 § 23.7.10 *Enable automatic barcode scan* -- done

Send the pdf to the site. -- done

Site prints off the pdf on to sticker paper, and stick on new tapes. -- done?

Give credentials to site to be able to log in to nagios workstation and access the data protector program using the xomni command -- done , Cornel has an account on the nagios server now , username cbalan , password ibapass ; please change this using the command 'passwd'

In data protector, add the user as an operator (operator doesn't have permissions to access the slots , try the others , either user or admin), use same username as is set up in nagios server -- done

Site user; install mobaxterm on laptop -- did you install this already ?

Site user, log in to nagios using this command in mobaxterm:
`ssh cbalan@nagios.ppi-npcc.org -X`

on the command line of nagios server, give the command 'xomni'

The data protector software opens on laptop (via x display)

In data protector:
Devices & Media -> Devices -> LIBLTO5 -> Slots

If any of the tapes are fair , then remove them from circulation and replace with new ones.

Can enter in tapes one at a time and note the none good tapes to be changed.

A new tape needs to be formatted , and to be added to the Default_LTM tape pool. 

# Backups - How to access xomni in Reading f15

mcbackup:~ # /opt/omni/bin/xomni

TODO ; or create a link to this xomni inside /usr/local/bin

# Backups ; Using the screen command 

When starting an ad-hoc backup to tape , i.e. one that is not started via the crontab at the usual time, one way to do it is to use the screen command. 

screen -S {{session_name}} 

, e.g. screen -S backup to start a screen session with name backup 

then the command to start the backup;

crontab -l

then detach from the screen session with ctrl-A , D

and then can exit from the ssh session and the backup will continue

screen -ls , to list the screen sessions running. 

screen -r {{session_name}} , to reconnect to a session.

This is an alternative to editing the crontab file and changing the time.. 

# BDSIO ; r12.1 ; Updating BDSIO firmware

MID 100311  ; Deployment work instruction r11.0.4 - r12.1 for P1 ; 

Step D12.1_76 ;    refers to deployment guideline mid 75730 

MID 75730 ; 'Deployment guideline hardware cgtr v1E' ; 

Section 2.4 refers to MID 48156 ;   see section  below
			
MID 48156 ; 'Annex 2 :  BDSIO config and check' ; 

These instructions describe how to connect to the BDSIO with laptop and to upload the software configuration. 

However the instructions miss the crucial information that after setting these switches to FF , that the modules needs to be restarted to pick up this setting.  

The site had also tried to carry out this procedure but had got stuck at this point when testing ping to 192.168.100.1 as the doc instructs. 

If these instructions had mentioned the requirement for power cycle then the site would have been able to proceed.  

Additionally this guide (annex 2) does not mention the other crucial information which is how , after upload of the configuration , ow to restore the IP of the module back to original IP  (in this case 10.3.51.52)

The answer is to use the Modbus TCP toolbox , Tools --> Network configuration ; follow the wizard to set the IP back to 10.3.51.52 ,  set the gateway to 10.3.51.1 ; and then to move the switches on the module to 00 ,  and to power cycle . 

Bms control cabinet master pone .docx    ;   from 48156 , specification folder in the zip 

![](files/2021-11-18-12-10-06.png)

Does not match 

![](files/2021-11-18-12-10-16.png)

After restarting the bdsio with flags set to f f 

![](files/2021-11-18-12-10-32.png)

![](files/2021-11-18-12-10-43.png)

![](files/2021-11-18-12-10-55.png)

bdsio1              IN  A     10.3.51.52

Following mid 75730 : section 2.4 BDSIO upgrade ;

Upload the configuration file on the BDSIO (if it has not been done in factory). 

All details are provided in the BMS Master cabinet zip file (MID 48156 rev E or later). 

See folder “Specification”, “Annex 2 : BDSIO configuration and check”.

![](files/2021-11-18-12-11-12.png)

Connect a computer to the BDSIO

With Ethernet cable, plug a computer to the BDSIO, and use the windows consol to “ping” the IP address 192.168.100.1.

(Do not forget to change the local IP address of the computer to 192.168.100.3. See appendix for more details)

I have set 

![](files/2021-11-18-12-11-23.png)

Connected ethernet between laptop and bdsio 

But alas , the ping does not work .. 

![](files/2021-11-18-12-11-31.png)

When the guide says 'plug a computer to the BDSIO '   ,  there are 2 ethernet ports , which one should be used ?  Does it matter ? 

Refers to 48156 

![](files/2021-11-18-12-11-42.png)


 
# Control units ; MID references

MID 48462 - B&R Deployement

MID 60651 - PT CU Network

MID 81091 - R12 CU Plan

MID 66652 - Archestra upgrade

MID 31922 - C230 ACU upgrade

MID 57603 - S2C2 ACU upgrade

MID 51902 - BLCU upgrade

MID 16534 - SRCU upgrade

# Controlserver ; historian ; archestra ; Install a new Archestra (galaxy) version

mid 66652  -- install new galaxy

# datarec ; getting irradiation logs ; getting data recorder logs

/recdata/test/clinical/tr1/planid/beamid/fractionid 

data recorder logs are in /RECdata/test/clinical/Duumy/planId/beamId/fractionId/2019.. 

this path is mentioned in the pts_data_recorder logs that are in the usual /TCS logs place. 

# datarec ; archive script for datarec files

Where to get from ? 

I checked out folder 'pts' from svn; 
then in the tools folder you will find datarec_archiver

/home/cfinch/svn/pts/tools

/alcyone/trunk/dev/pts/tools/datarec_archiver/src/main/resource/runtime     (??)

```bash
#!/usr/bin/bash
./archive_datarec_files -A -s /RECdata/clinical -t /RECData/archive -m +60

./archive_datarec_files -E -s /RECData/clinical -m +60
```

# datarec ; archive datarec files using rsync

- Using rsync
https://unix.stackexchange.com/questions/59112/preserve-directory-structure-when-moving-files-using-find

[WO-00143286](https://iba2016.sharepoint.com/sites/TechnicalOperationsSiteReports/SitePages/June-2021---SBF.115---Reading.aspx?from=SendByEmail&e=Yrq-BU96s0CGj6kIFrfMUA&at=9)

# Maintenance ; clean servers and workstations 

mid 12836  

From <https://community.spiceworks.com/topic/442532-what-to-use-to-clean-a-nic-card-circuit-board> 

Air duster 

or 

compressor

Contact cleaner with a soft brush

Isopropyl alcohol with a soft brush.

Could use contact cleaner or alcohol and then use an air duster or compressor to blow off the liquid as well as brushing it off and drying it off with a lint free cloth
collision avoidance

![](files/2021-11-19-13-28-44.png)

![](files/2021-11-19-13-29-00.png)

# mcbackup ; set up Data protector

Install java version 1.6 on mcbackup

Install HP Dataprotector 7 on mcbackup

For the detailed installation procedure, please refer to section 22.7, p. 269.

mid 53489

# mcrw1 ; Archestra ; put archestra start up script on to desktop 

/tcs_usr/clinical/Desktop/Archestra

```
#!/bin/bash

#xfreerdp /multimon /monitors:1,2 /u:SITE_Field /p:SITE_Field /v:controlserver
xfreerdp /monitors:1,2 /u:ControlStation01 /p:control /v:controlserver /span /t:Archestra -decorations &

```

# Operating - How to troubleshoot pauses when using the pristine beam 

The system is failing each time ; Beam keeps pausing. 

Bug 73966 describes the problem. 

# Operating - Troubleshooting s1g

Restarted the slits on gantry --> did this by turning gantry to 180 , going in to gantry pit, back of cabinet attached to gantry , top device in cabinet, turn switch off then back on. 

Then go to manual on BCP  and do an initialization.  

Troubleshooting a beam pause

look at the messages under BSS feedback on BCP 

Get BDCU log messages -> can be obtained by clicking Save log on Workflow section of Bdcu on BCP. then choosing a place for it , then using filezilla to download the csv, then open with excel. 

Troubleshooting Ion source power supply dropping out 

Jake changed parameters on the srseu web page. 

mid64861 -->  what the offsets are for. 

iarc - varc feedback on srseu 

# Operating - Beamline Vacuum loss 

On opening the beamline on the vacuum page you will be confronted by this picture. Note that the pressure is at atmospheric pressure and the turbo pump is ready but not on, if the turbo pump is red there could be a failure with the pump, in this case it was a simple restart of the pump. 

Down in the Gantry near the ladder the vacuum pump module can be located in the cabinet below, the green circle is the ATM and VAC switch, if in VAC the beamline should be operating as normal under vacuum, if in ATM the beamline will vent. 

Never hold it on ATM for longer than 1 second if you don’t want to vent the system.  

The Blue circle is the vacuum pump controller, in this case it was on zero amps and zero Hz, pressing the on button allowed the pump to start again 

When the pump is fully up and running it will display like the picture below. The beamline will then quickly recover to its correct vacuum level 
 
![](files/2021-11-18-16-17-15.png)

![](files/2021-11-18-16-17-22.png)

![](files/2021-11-18-16-17-27.png)

# Operating ; Ion source power supply dropping out

Ion source power supply dropping out:

Jake changed parameters on the srseu web page

mid64861 -->  what the offsets are for. 

iarc - varc feedback on srseu.

# PTS ; site configs ; r12.1 ; generate the collision avoidance config files

Open a terminal 

Using WSL2 ;  this is ok ? 

Do an export of http://subversion.lln.iba/repos/tc/alcyone/tags/PMS-{PMS-VERSION}/tools/CollisionAvoidanceCalibrationTool/ 

-- with {PMS-VERSION} replaced by current PMS version.

svn export http://subversion.lln.iba/repos/tc/alcyone/tags/PMS-{PMS-VERSION}/tools/CollisionAvoidanceCalibrationTool/

python3 setup.py install --user

Python3 -m calibration -w 

Results.xlsx

Open a terminal
 
mkdir workingDir
 
cd workingDir
 
svn export http://subversion.lln.iba/repos/tc/alcyone/tags/PMS-{PMS-VERSION}/processTemplates/collision-avoidance/src/main/resources/urdf/

with {PMS-VERSION} replaced by current PMS version.
 
svn export http://subversion.lln.iba/repos/tc/alcyone/tags/PMS-2.10.0/processTemplates/collision-avoidance/src/main/resources/urdf/

Copy the full path leading to : processConfigs/src/main/resources/runtime/{SITE.ID}/TR{ROOM#}/collision-avoidance/resources/urdf

Copy results.xlsx into workingDir
 
Enter command: calibration 

Python3 -m calibration -w /home/cfinch/collissionstuff/ -i /home/cfinch/collisionstuff/results.xlsx -u /home/cfinch/cllisionsstuff/urdf
 
Wait for the executable to finish with following message: “Calibration done”
 
Open file CalibrationToolOutput.xlsx
 
Go to “Adjustements” tab and modify the urdf (Unified Robot Description Format) files with the new coordinates displayed in this tab as explained in the following step.

[18/08/2021 16:05] Ariane Liteanu
You can follow PMS-VTC-065 from M-ID 91648 up to step 25

[18/08/2021 16:06] Ariane Liteanu
then if it passed, you can play: PMS-VTC-074


[18/08/2021 10:03] Christopher Finch
I am stuck on step 45 of mid 91046

[18/08/2021 10:05] Christopher Finch
the previous step 44 is this : 44CGTRPPS Leoni-Copy results.xlsx into workingDir-Enter command: calibration-Wait for the executable to finish with following message: “Calibration done”-Open file CalibrationToolOutput.xlsx-Go to “Adjustements” tab and modify the urdf (Unified Robot Description Format) files with the new coordinates displayed in this tab as explained in the following step.

[18/08/2021 10:06] Christopher Finch
i did that and then the start of step 45 says this : 
-Modify the urdf files of the site configuration:  
For PPS base coordinates, 
open orion_light.urdf 
and modify the X, Y and Z values in the folowing section:    

```
<joint name="base" type="fixed"> 
  <parent link="isocenter"/> 
  <child link="base"/> 
  <dynamics damping="0.0" friction="0.0"/> 
  <origin xyz="X Y Z“ rpy="0 0 0" />  
</joint>  
```

Once the PPS base coordinates have been adjusted in the URDF file, 
relaunch the calibration tool with the same input file “results.xlsx” 
and continue to adjust the URDF files with the coordinates found in the new output file. !!

[18/08/2021 10:07] Christopher Finch
it seems to say rerun the program with the same input file 'results.xlsx'. 
I don't see the purpose of this ;  
relaunching the tool with the same input gives the same output ;   
what am i missing ? 

[18/08/2021 10:16] Ariane Liteanu
Hi,I understand why you think so. It is indeed confusing "relaunch the calibration tool with the same input file" but if I remember correctly, as you have modified the URDF file, the next output won't be the same. 

[18/08/2021 10:17] Ariane Liteanu
You need to do that this way because in order to have correct corrections for the next coordinates, the PPS needs to be adjusted first

[18/08/2021 10:20] Christopher Finch
ok thanks Ariane !   so i modify the urdf file which i previously checked out to the working dir  ?  i was also getting a bit confused by this line ,  wasn't sure where it meant to update the site configuration : "Modify the urdf files of the site configuration:"  

[18/08/2021 10:24] Christopher Finch
Thankou Ariane , its making sense now  

[18/08/2021 10:27] Ariane Liteanu
If you need more detail on the URDF itself (how to update it ect...), I highly recommend to have a chat with Alan. He should be back by friday 

[18/08/2021 10:28] Ariane Liteanu
The idea was to keep the model "customizable", this is why the URDF is in the site configuration files.

[18/08/2021 10:28] Christopher Finch
i had chat with Alan last night , but I didn't quite understand this point of where to update the site configs ;  but i see it is referring to  the previously checked out urdf folder 
 like 1

[18/08/2021 10:29] Ariane Liteanu
Can I ask on which site you are playing the procedure? 

[18/08/2021 10:29] Christopher Finch
Bomarsund SBF.110

[18/08/2021 10:30] Christopher Finch
we have upgraded to pts12.1 on the weekend ;  and trying to get beam-on

[18/08/2021 10:32] Ariane Liteanu
Ok, good to know. As it is one of the first times this procedure is played by someone else than the development team, don't hesitate to share your results and questions 

[18/08/2021 10:32] Christopher Finch
ok , will do    appreciate your clear advice !!  in the README it has the following: To start this collision avoidance tool: If you are a developer uploading the code from the subversion:

please install requested libraries (1 time) :

- pip install pybullet==2.8.6

- pip install numpy==1.19.1

- pip install scipy==1.5.2

- pip install openpyxl==3.0.4 On the root level of this directory, please execute following command to execute the code:

```sh
python3 -m calibration -w <workingDir (Default=pwd)> -i <inputFile (Default=result.xmlx)> -u <urdfDirectory (Default=workingDir/urdf)> 
```

For other people, you are not supposed to download the code from the subversion. You shall install the tool by using

pip' installer. 

```
pip install --index-url http://nexus.rnd.goiba.net/repository/pypi-all/simple CollisionAvoidanceCalibrationTool
```

[18/08/2021 10:33] Christopher Finch
i went the root of installing the various libraries ;   found that needed python 2.8 ;  but the final command mentioned there  pip install --index-url http://nexus.rnd.goiba.net/repository/pypi-all/simple CollisionAvoidanceCalibrationTool

[18/08/2021 10:33] Christopher Finch
that doesn't seem to work 

[18/08/2021 10:33] 
Henri Bourmorck left the chat.

[18/08/2021 10:35] Ariane Liteanu
Mmm, ok. But you were still able to run the calibration tool?

[18/08/2021 10:36] Ariane Liteanu
That would be a question for Henri 

[18/08/2021 10:37] Christopher Finch
Henri just left chat 

[18/08/2021 10:39] Christopher Finch
yes i was able to run the calibration tool only by installing various modules as if i was a developer ;  but for future use would be better to have it like in the final comand
 like 1


[18/08/2021 10:42] Ariane Liteanu
that was the point indeed

[18/08/2021 11:00] Christopher Finch
ok , so i updated the orion_light.urdf with the values from the first run of the tool ;   then i reran the command ;  the output of this 2nd run is here : 
[output_from_running_collisionTool_2ndrun]
(https://iba2016-my.sharepoint.com/personal/ahfjf_goiba_net/Documents/Microsoft Teams Chat Files/output_from_running_collisionTool_2ndrun)

[18/08/2021 11:00] Christopher Finch
when running the command the graphical display shows for  a couple of seconds and then shuts , is this expected / normal ?

[18/08/2021 11:04] Ariane Liteanu
Ah, that I don't remember. Alan, David, does it sound familiar?


[18/08/2021 11:33] Christopher Finch
is it expected that the 'base joint of pps'  can change between the first and second runs of the tool ?  (after updating the values in the orion_light.urdf file ) on first run of the tool , got these values for 'base joint of pps' :  modified the urdf file with those values from 'new coordinates' column , then ran the tool again ;  got these results :

[18/08/2021 11:35] Ariane Liteanu
I think you should ignore the new corrections (for the PPS base) but I suggest that we discuss that with Alan when he returns
 like 1

[18/08/2021 15:58] Christopher Finch
hi Ariane , is there a way to check that the collision avoidance parameters that have been added to the site config ,  whether to check that they are ok ?    There doesn't seem to be a validation test,  is that right ?  perhaps it is enough to simply move the devices in the TR and check that disabling of motion occurs  when devices get near to eachother ? 

![](files/2022-01-31-14-29-24.png)

[18/08/2021 16:02] Ariane Liteanu
Don't do it this way because if the model is not correctly set, it could result in a collision (which is what we are trying to avoid).There is a procedure with tests that you can play, I will find it for you.

[18/08/2021 16:05] Ariane Liteanu
You can follow PMS-VTC-065 from M-ID 91648 up to step 25

[18/08/2021 16:06] Ariane Liteanu
then if it passed, you can play: PMS-VTC-074

[18/08/2021 16:08] Christopher Finch
bit confused here;  it says if xcoord has been modified then also modify xcoord of nozzle top  ; but nozzle top only has a Z value generated in the output.xlsx  file ..  !! Important notice, if the x coordinate of the nozzle base has been modified, the x coordinate of the nozzle top must be modified accordingly. !! 

![](files/2022-01-31-14-30-05.png)

[18/08/2021 16:09] Ariane Liteanu
A correctly calibrated model should also not stop devices if there are no collision foreseen. So you can make several moves with the nozzle coming close to the table (but never touching it) and it should not interfere. 

[18/08/2021 16:10] Christopher Finch
i wonder if someone from development team would be able to also generate teh site configs , independently of me ; before we run the tests .. 

[18/08/2021 16:10] Ariane Liteanu
For the details of calibration procedure, it would be best to wait for Alan, I'm sorry 

[18/08/2021 16:11] Christopher Finch
hi Joshua Prim ;  heads up :  there may be some validations to play for the new collision avoidance parameters :  [16:05] Ariane LiteanuYou can follow PMS-VTC-065 from M-ID 91648 up to step 25[16:06] Ariane Liteanuthen if it passed, you can play: PMS-VTC-074

[18/08/2021 16:12] Christopher Finch
ok thanku , your help much appreciated Ariane !

[18/08/2021 16:12] Ariane Liteanu
you're welcome

[18/08/2021 16:15] Christopher Finch
step 45.4 ; it again asks to enter in X value of nozzle top coordinate. But the spreadhseet adjustments tab only gives a value for Z  .

 For the nozzle top x and z coordinates, modify the X and Z values in the folowing paragraph of both files:

[18/08/2021 16:16] Ariane Liteanu
It is indeed weird  it could be missing from the file

[18/08/2021 16:17] Christopher Finch
no worries ;  i just adding the ambiguities as i come across them , and then can ask Alan on Friday.. 

[18/08/2021 16:18] Ariane Liteanu
Thanks for your reviews. It will be valuable to improve the procedure.
 like 1

[18/08/2021 16:19] 
Christopher Finch added Jonathan Mckenzie to the chat and shared all chat history.

[18/08/2021 16:20] Christopher Finch
Hi Jonathan Mckenzie  ;  just adding you to the chat , since at some point there may be a validation procedure to do for the new collision avoidance parameters .. 

[18/08/2021 16:20] Jonathan Mckenzie
okay sure - just let me know what you need and when you need it 
 like 1

[19/08/2021 09:36] 
Christopher Finch added Frederic Moniquet to the chat and shared all chat history.

[19/08/2021 09:37] 
Christopher Finch changed the group name to Collision avoidance parameters.

[20/08/2021 11:15] Christopher Finch
in this zip folder , i havea) the results.xlsx file from the siteb) the calibrationToolOutput.xlsx file from the first run of the toolc) the calibrationToolOuput.xlsx file from the second run of the toold) the urdf folder with the values updated from the two runs of the tool 

[20/08/2021 11:17] Christopher Finch
This urdf folder has been added to the site configs ;  before I release the tag (and the site begins the operational scenario)  can I please check the steps and final values with someone familiar with the tool ? 

[20/08/2021 11:20] Christopher Finch
what I would like to check : the input file (results.xlsx)  is correct , the values input to the yellow boxes are correct ; the steps from step 45 onwards (in mid 91046)  have been done as intended 


```
(base) ➜  CollisionAvoidanceCalibrationTool python3 -m calibration -w /home/cfinch/collision_stuff -i results.xlsx -u /home/cfinch/collision_stuff/urdf

pybullet build time: Aug 11 2020 06:38:11

2021-08-14 11:45:08,329 [info] {mainthread/140596908189504} (calibration.py) - starting the calibration tool (version: 1.0.1)

What is you range shifter?

Range shifter 4 cm

Range shifter 7.5 cm

Select your range shifter (1 / 2)1
```

gives the following output:

```
2021-08-14 11:45:09,906 [INFO] {MainThread/140596908189504} (calibration.py) - Selected range shifter: 4 cm
2021-08-14 11:45:09,911 [INFO] {MainThread/140596908189504} (calibration.py) - Printing Collision Avoidance Calibration Tool package information :

Run command:     /home/cfinch/svn/CollisionAvoidanceCalibrationTool/calibration/__main__.py -w /home/cfinch/collision_stuff -i results.xlsx -u /home/cfinch/collision_stuff/urdf
Code path:       /home/cfinch/svn/CollisionAvoidanceCalibrationTool/calibration/calibration.py
Package version: 1.0.1
Dependencies version:
  PyBullet: 2.8.6
  Numpy:    1.19.1
  Scipy:    1.5.2
  OpenpyXl: 3.0.4
Author:       Clinical workflow software team
Author email: henri.bourmorck@iba-group.com

2021-08-14 11:45:09,912 [INFO] {MainThread/140596908189504} (utils.py) - Loading test results from xml file.
2021-08-14 11:45:09,956 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/orion_light to /tmp/tmpglx_s2rv/urdf/orion_light
2021-08-14 11:45:09,975 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/cnsh_small_range_shifter.urdf to /tmp/tmpglx_s2rv/urdf/cnsh_small_range_shifter.urdf
2021-08-14 11:45:09,975 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/oblique.urdf to /tmp/tmpglx_s2rv/urdf/oblique.urdf
2021-08-14 11:45:09,976 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/cnsh_large_range_shifter.urdf to /tmp/tmpglx_s2rv/urdf/cnsh_large_range_shifter.urdf
2021-08-14 11:45:09,977 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/oblique to /tmp/tmpglx_s2rv/urdf/oblique
2021-08-14 11:45:09,979 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/orion_light.urdf to /tmp/tmpglx_s2rv/urdf/orion_light.urdf
2021-08-14 11:45:09,980 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/utils to /tmp/tmpglx_s2rv/urdf/utils
2021-08-14 11:45:09,980 [INFO] {MainThread/140596908189504} (utils.py) - Copying from /home/cfinch/collision_stuff/urdf/nozzleImager to /tmp/tmpglx_s2rv/urdf/nozzleImager
2021-08-14 11:45:10,034 [INFO] {MainThread/140596908189504} (utils.py) - Cleaning urdf /tmp/tmpglx_s2rv/urdf/cnsh_small_range_shifter.urdf
2021-08-14 11:45:10,038 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_NONE
2021-08-14 11:45:10,039 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_ERROR
2021-08-14 11:45:10,039 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_UNKNOWN
2021-08-14 11:45:10,039 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S
2021-08-14 11:45:10,039 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S_SHAPE
2021-08-14 11:45:10,040 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M
2021-08-14 11:45:10,040 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M_SHAPE
2021-08-14 11:45:10,040 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_NONE_AXIS
2021-08-14 11:45:10,040 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_ERROR_AXIS
2021-08-14 11:45:10,040 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_UNKNOWN_AXIS
2021-08-14 11:45:10,041 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S_AXIS
2021-08-14 11:45:10,041 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S_SHAPE_AXIS
2021-08-14 11:45:10,041 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M_AXIS
2021-08-14 11:45:10,041 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M_SHAPE_AXIS
2021-08-14 11:45:10,044 [INFO] {MainThread/140596908189504} (utils.py) - Cleaning urdf /tmp/tmpglx_s2rv/urdf/oblique.urdf
2021-08-14 11:45:10,045 [INFO] {MainThread/140596908189504} (utils.py) - Cleaning urdf /tmp/tmpglx_s2rv/urdf/cnsh_large_range_shifter.urdf
2021-08-14 11:45:10,047 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_NONE
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_ERROR
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_UNKNOWN
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S_SHAPE
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M_SHAPE
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_NONE_AXIS
2021-08-14 11:45:10,048 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_ERROR_AXIS
2021-08-14 11:45:10,049 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_UNKNOWN_AXIS
2021-08-14 11:45:10,049 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S_AXIS
2021-08-14 11:45:10,049 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_S_SHAPE_AXIS
2021-08-14 11:45:10,049 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M_AXIS
2021-08-14 11:45:10,049 [INFO] {MainThread/140596908189504} (utils.py) - Removing child SNOUT_CN_SNOUT_M_SHAPE_AXIS
2021-08-14 11:45:10,051 [INFO] {MainThread/140596908189504} (utils.py) - Cleaning urdf /tmp/tmpglx_s2rv/urdf/orion_light.urdf
2021-08-14 11:45:10,058 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_NONE
2021-08-14 11:45:10,058 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_UNKNOWN
2021-08-14 11:45:10,058 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_CIVCO
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_KVUE_ONE
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_STD_SHORT_KVUE
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_QFIX_BOS_SHORT_KVUE
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_QFIX_BOS_LONG_KVUE
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_TOP_LONG_KVUE_ONE
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_STD_SHORT_KVUE_ONE
2021-08-14 11:45:10,059 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_NONE
2021-08-14 11:45:10,060 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_UNKNOWN
2021-08-14 11:45:10,060 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_KVUE
2021-08-14 11:45:10,060 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_KVUE_ONE
2021-08-14 11:45:10,060 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_CIVCO
2021-08-14 11:45:10,060 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_CIV_RECT_LONG_CIVCO
2021-08-14 11:45:10,060 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_CIV_HN_STANDARD_CIVCO
2021-08-14 11:45:10,061 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_NONE_AXIS
2021-08-14 11:45:10,061 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_UNKNOWN_AXIS
2021-08-14 11:45:10,061 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_KVUE_ONE_AXIS
2021-08-14 11:45:10,061 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_BASE_CIVCO_AXIS
2021-08-14 11:45:10,061 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_NONE_AXIS
2021-08-14 11:45:10,061 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_UNKNOWN_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_KVUE_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_KVUE_ONE_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_UNKNOWN_CIVCO_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_CIV_RECT_LONG_CIVCO_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_CIV_HN_STANDARD_CIVCO_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_STD_SHORT_KVUE_AXIS
2021-08-14 11:45:10,062 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_QFIX_BOS_LONG_KVUE_AXIS
2021-08-14 11:45:10,063 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_QFIX_BOS_SHORT_KVUE_AXIS
2021-08-14 11:45:10,063 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_TOP_LONG_KVUE_ONE_AXIS
2021-08-14 11:45:10,063 [INFO] {MainThread/140596908189504} (utils.py) - Removing child COUCH_INSERT_KV_STD_SHORT_KVUE_ONE_AXIS
startThreads creating 1 threads.
starting thread 0
started thread 0
argc=2
argv[0] = --unused
argv[1] = --start_demo_name=Physics Server
ExampleBrowserThreadFunc started
X11 functions dynamically loaded using dlopen/dlsym OK!
X11 functions dynamically loaded using dlopen/dlsym OK!
Creating context
Failed to create GL 3.3 context ... using old-style GLX context
Indirect GLX rendering context obtained
Making context current
GL_VENDOR=Mesa Project
GL_RENDERER=Software Rasterizer
GL_VERSION=1.4 (2.1 Mesa 10.5.4)
GL_SHADING_LANGUAGE_VERSION=(null)
pthread_getconcurrency()=0
Version = 1.4 (2.1 Mesa 10.5.4)
Vendor = Mesa Project
Renderer = Software Rasterizer
[1]    7045 segmentation fault  python3 -m calibration -w /home/cfinch/collision_stuff -i results.xlsx -u
```

# Controltools ; Install controltools VM

Connect to switch psr/mcrouter

show config

if VLAN_PNIO is present (ID 14), stop here

config

vlan 14

name "VLAN_PNIO"

For switch psr : tagged Trk20

For mcrouter with C7000 : tagged Trk20, Trk1-Trk2 (to adapt per site)

For mcrouter with pizzabox : tagged Trk20, Trk1-Trk3

show run

write mem

exit exit exit exit

VLAN propagation for C7000/exsi 5.5 :

connect to flexfabric1

In the left menu under "Connections" go to the "Ethernet Networks"

Verify presence of the following VLAN
- VLAN_PLC_L
- VLAN_PLC_R
- VLAN_PNIO_L
- VLAN_PNIO_R

If present, go to step 6

4) On the top right corner, click on "Add"

5) Name the connection, thick the "Use Shared Uplink Set", select the lef or right Uplinl_set, fill the external VLAN ID and thick the "smart link"

6) In the left menu under "Connections" go to the "Server profiles"

7) On blade 1, 2 & 9, edit the config

8) On Port 1 & 2, edit the config by clicking the "sheet" button next to the network name

9) Slide the missing L or R vlan in the "Networks in mapping"

10) Click on "Apply and close" at the bottom right of the window.

11) download the vsphere client and connect as root (ignore the certificate issue)

12) from the vsphere client, select a cnode and in the configuration tab, click on networking then  edit the vSwitch0 by clicking on "properties"

13) add a new virtual machine connection type with his name and id 

14) repeat steps 12 & 13 for all 3 cnodes and all missing vlans.
 
B: VLAN propagation for PizzaBox / ESXi 6.5 :
 
1) Connect on a cnode

2) Go on networking

3) Add the missing port groups

4) Repeat for each cnode
 
C: Virtual machine deployement
 
1) Via your GOIBA account, copy the .ovf and .vmdk files from the office server (\\f05.goiba.net\Source\Images\SW_ENGI_TOOLS_B1.1_PT-vm8x) to a share folder of controlserver (\\ControlServer\D\Data\Temp)

This step takes about 90 min, i would start by this before doing section A & B 

2) From the current controltools, verify you have access to that shared folder with the credentials ControlStation05/control for exemple

3) Still on the current controltools, install vsphere client then login

4) Go in the "file" menu then "deploy ovf template", browse to the shared folder to select the .ovf file.

5) Select the "SCADA" location of the vcenter

6) Choose PTS as cluster

7) Then cnode3 as host and say yes to the warning

9) Pick 3PAR-VMFS02 as storage destination

10) Keep the lazy zeored option

11) Keep the network configuration as this and ignore the warning

12) Untick power on after deployment, press finish and wait for 60 minutes.

13) Edit the VM settings to correct the network vlan assignment as this but untick connected and connected at power on for now

14) Start the VM and use the console to login as iba (will be changed back to Sw_Engi_Tools in next version B 1.2) /ibapass

15) Edit the "Site" file in C:\BGInfo\Site.txt to match the structure "F03 - Toyohashi - nmptc.org"

16) Edit the workgroup and description of the macine 

17) Edit the IP settings of the network cards 1, 2 & 3 to match the domain range (leave card 4_PNIO untouched for a P1)

18) For the default vlan, go in the advance settings of the ipv4 to add a domain suffix 

19) Edit the following registry key to add mcrs3 as NTP server 

20) Edit the time zone to match the the site time zone

21) Connect to vdog and do a checkout of the whole site folder

22) Enjoy

# mcrs3 ; Updating hosts file

Vim /var/lib/named/master/<hosts file> 

Change the serial number at the top of file ; use the date

Add the change made and a comment at the top , add the right date

In same folder change the reverse file ;  again put new serial number etc. 

Then in the same folder run 'make' 

Then service named restart 

Then check with host eideu1   for e.g.   ;   and for reverse with host <ip>


# DNS

Named 

var/lib/named 

This folder has zone files for named on mcrs3 

# Mcfirewall ; iba-firewall ; open a firewall 

Find and run this script:

/TCS/runtime/renovated/pts-startstop/runtime/start_stop_TCS open_iba_firewall 

or 
log in to the firewall from outside (the 'untrust' zone): 

Reading: http://10.30.50.253/  

Newcastle: http://10.30.20.253/ 

Temporarily change the security policy

or

ssh clinical@mcrw1.ppi-rcctv.org -X

clinical@mcrw1:~> /TCS/runtimeStore/treatment/runtime/renovated/pts-accesspoint/runtime/pseudo-home/TCSaccesspoint/FWcontrol -O


# Template ; please open your firewall  

Purpose (mission), if exists add a Jira ticket ID or a SvMax work order

Software Engineer name

Estimated time to finish the mission 

Request to the operator or local team. Is it only required to open FW? Mock treatment, morning walkthrough, …

Impact on the system and the software? Is there a risk for the clinical usage of the system?


# Network ; customer side 

Firewall IPs from untrust zone

Bomarsund firewall IP from untrust zone
10.207.120.185 

Reading firewall IP from untrust zone
10.208.120.185 

Liverpool firewall IP from untrust zone
10.210.120.185

Bomarsund sequencer ip 
10.207.111.62  

Newport seqquencer ip 
10.205.120.185

what are these?

10.207.111.185 

10.207.221.1 


MID 66904

# Fsecure ; install

Install F-secure on Windows workstations. 

Check what windows pcs are on site. 

vuemaster, 
mcrvue1, 
tcrvue1,
tcrvue2,
tcrvue3,
tcrvue4,
tcrvue5,
ppvsws1,
ppvsws2,
ppvsws3,
ppvsws4,
ppvsws5

find out all the windows boxes on site

log in to them , make sure have the correct username/passwords 

then install f-secure on them 

and import them to the f-secure management on mcbackup

on mcbackup where f-secure management is installed , the boot loader option file_caps=1  needed adding 

this is described in mid 5951 ; 

after doing that and resetting the admin password to the current site root password , was able to log in 

Download from http://www.f-secure.com/eu/web/business_global/support/downloads  :

PMS; Policy Manager Server; this is a service

PMC; Policy Manager Console; this is an admin gui

On mcbackup:

Install libcap-progs

Add file_caps=1 to the kernel boot options ,  in Yast ? 

Reboot the server

rpm -ihv aua

rpm -ihv pms

$ /opt/f-secure/fspms/bin/fspms-config

AUA reconfiguration:

update server address → leave empty → pulls from web

policy manage proxies → leave empty

HTTP proxy: → leave empty

unix notify socket path: /var/tmp/fsaua-notify

start AUA at boot: yes

PMS reconfiguration:

AV def. update: 3 check every 1/2 hour

host port used by PMS = 80

Admin module port = 8080

restrict access to admin module (localhost only): no

enable reporting: yes

port used by reposting = 8081

enter password for administrator account → same as root

$ /etc/init.d/fspms start

rpm -ihv pmc

Add users to group fspmc for access to pmc

# Fsecure ; upgrade

Receive the license document.

Download rpm files relating to the version mentioned in the license document

cd /etc/init.d/

./fspms stop

./fsaua stop

You are upgrading to version >= 13 ? 

then remove fsaua:

$ rpm -e fspmaua

Upgrade:

rpm -Uhv fspmaua-8.36.67-1.x86_64.rpm fspms-12.00.67239-1.x86_64.rpm fspmc-12.00.67239-1.x86_64.rpm

cd /etc/init.d/

./fspms start

./fsaua start

Add your unix user account to group fspmc

Log out and in with X display enabled (ssh -X )

/opt/f-secure/fspmc/fspmc

login with username admin and root password

Register the PMS using the F-Secure customer number (for exemple: 1-3TCVLN) as found on the license document.

Configure the mail server for virus alerts:

select Tools menu; server configuration

in the dialog box, select Mail server tab, and fill the Server address box with mcrs3.yourdomain.org, 

leave the Login and Password boxes empty, 

keep SMTP in the Mail protocol box

Sender e-mail box: fspms@mcbackup.yourdomain.org

still in the dialog box, select Server alerts tab, 

fill the Recipients e-mail box with root@mcrs3.yourdomain.org

Mail server tab, select Send test email button, 

fill in root@mcrs3.yourdomain.org in the popup, click Send, the Cancel and check the mail has been sent.

click OK in the Server configuration dialog box to apply and close it

Populate the Installation Package list:

create /opt/f-secure/store, give it the same mode as fspmc (drwxrws---)

download both client security and server security modules in .jar format,

place them in the store folder created above

use Tools | Installation packages to import both

export the installation packages:

fill the licence key

give policy manager URL: http://mcbackup.cal.org:804

Host ID = WINS (NetBIOS) name

for the rest, use default values

exported as /tmp/fsss-11.00.729-exported.jar

on target client (here, controlserver), download ilauncher.exe from /opt/f-secure/fspmc/bin and the exported .jar file from /tmp
then just type: ilauncher fsss ... .jar

Installation is fully automated. When done, the target should restart after a delay (this doesn’t seem to be the case, though)

Import new client in root domain

You can now update the global policy and it will be uploaded on all member machines.

# Fsecure ; recover from a lost admin password

Stop all running F-Secure services (fspms and fsaua)

Change dir. to /opt/f-secure/fspms/bin

Run fspms-reset-admin-account

Set and confirm new admin password

Restart F-Secure services (fspms and fsaua)

# F-secure ; update the license 

Obtain the license document -- attachement from an email ? or it is included in the Work order ? 
rpm files may be under : \\llnds03\ptsysadmin\F-Secure

Which version of f-secure is the license for? Find the versions of the f-secure service and client (pms and pmc) from the license document)

Log in to mcbackup.

Download the RPM packages from http://www.f-secure.com/eu/web/business_global/support/downloads: 
1. The Policy Manager Server (PMS)  (this will run as a service)
2. The Policy Manager Console (PMC) (this is the GUI that runs over X display)
3. If prior to version 13 then also download the Automatic Update Agent (AUA)

Stop the F-Secure services :
`cd /etc/init.d/`
`./fspms stop`
`./fsaua stop` (if version is < v13)

If upgrading to v13.x from v12 or earlier, remove the fsaua package first:
`rpm -e fspmaua-8.36.75-1`

Upgrade all 2 or 3 packages in one go (PMS and PMC only for v13.x and
above):
`rpm -Uhv fspmaua-8.36.67-1.x86_64.rpm fspms-12.00.67239-1.x86_64.rpm fspmc-12.00.67239-1.x86_64.rpm`

Restart all F-Secure services (PMS only for v13.x and above):
`cd /etc/init.d/`
`./fspms start`
`./fsaua start`

Add your unix user account to group fspmc
Log out and back in
Start `/opt/f-secure/fspmc/fspmc` (Java-based, needs an X DISPLAY
available)
Log in as admin + root password
Register the PMS using the F-Secure customer number (for exemple: 1-
3TCVLN) as found on the license document.
Configure the mail server for virus alerts the following way:
- from the menu bar, select Tools menu, Server configuration...
- in the dialog box, select Mail server tab, and fill the Server address box with mcrs3.yourdomain.org, leave the Login and Password boxes empty, keep SMTP in the Mail protocol box but fill the Sender e-mail box with fspms@mcbackup.yourdomain.org
- still in the dialog box, select Server alerts tab, and fill the Recipients e-mail box with root@mcrs3.yourdomain.org
- optionally, select again the Mail server tab, click the Send test email button, fill in root@mcrs3.yourdomain.org in the popup, click Send, the Cancel and check the mail has been sent.
- click OK in the Server configuration dialog box to apply and close it
 
Populate the Installation Package list
- create /opt/f-secure/store, give it the same mode as fspmc (drwxrws---)
- download both client security and server security modules in .jar format,place them in the store folder created above
- use Tools | Installation packages to import both
- export the installation packages:
- fill the licence key
- give policy manager URL: http://mcbackup.cal.org:804
- Host ID = WINS (NetBIOS) name
- for the rest, use default values
- exported as /tmp/fsss-11.00.729-exported.jar
- on target client (here, controlserver), download ilauncher.exe from /opt/f-secure/fspmc/bin and the exported .jar file from /tmp
• then just type: ilauncher fsss ... .jar

Installation is fully automated. When done, the target should restart after
a delay (this doesn’t seem to be the case, though). Import new client in root
domain. You can now update the global policy and it will be uploaded on all
member machines.

The F-Secure Certificates: confirm to Melanie Jacobs when these licences have been installed on your machines

Example: update the license in Nice

get the license document:

![b6249019e1f560c509e11132fc009811.png](../_resources/2bd7a468eb3442b4ad91ca74caf6c0cc.png)

![3575ad396874e60ad46be223a611f2e1.png](../_resources/184f8c4451f44d37a18025c7516b7776.png)

write down the license number for each windows device: 

```csv
site; device ; software ; version ; serial number ; customer number
f01; controlserver; fsss (F-Secure Server Security) ; 14.10 ; 1-712132777 ; 1-3TCVLW
f01; historian; fsss (F-Secure Server Security) ; 14.10 ; 1-712132777 ; 1-3TCVLW
f01; ppvs-ws1 ;fscs (F-Secure Client Security) ; 14.21 ; S/N F-877772D24 ; 4EEC94D2D
f01; controltools ;fscs (F-Secure Client Security) ; 14.21 ; S/N F-877772D24 ; 4EEC94D2D
f01; dynalog ;fscs (F-Secure Client Security) ; 14.21 ; S/N F-877772D24 ; 4EEC94D2D
```

F-Secure Licences Renewal 

Purchase order (PO) 4570013661 

MID 88127

F-Secure AntiVirus Support has been renewed from the 
12th of April 2020 
to the 
12th of April 2023.

MID5951-32.8.3

Which version of F-secure is the license for ? 

Log in to mcbackup.

Download the RPM packages from http://www.f-secure.com/eu/web/business_global/support/downloads: 

1. The Policy Manager Server (PMS)  (this will run as a service)

2. The Policy Manager Console (PMC)

3. If prior to version 13 then also download the Automatic Update Agent (AUA)
 
If not already installed, install libcap-progs:

`zypper install libcap-progs`

Add `file_caps=1` to the kernel boot options; reboot the server to activate the parameter.

Install the pms package:

`rpm -ihv \<pms.rpm>` 

Run `/opt/f-secure/fspms/bin/fspms-config`

Configure AUA:
- update server address: leave empty
- policy manage proxies: leave empty
- HTTP proxy: leave empty
- unix notify socket path: /var/tmp/fsaua-notify
- start AUA at boot: yes

Configure PMS 
- AV def. update: check every 1/2 hour
- host port used by PMS: 80
- admin module port: 8080
- restrict access to admin module (localhost only): no
- enable reporting: yes
- port used by reposting = 8081
- enter password for administrator account: same as root

Start the PMS module: `/etc/init.d/fspms start`

Install PMC: `rpm -ihv <pmc.rpm>` (may need to add the --replacefiles
option).
Add users of fspmc (the GUI client) to the fspmc group.  

On mcbackup:

Check that all F-Secure services are running (fspms, fsaus and fsaua)

Start F-Secure Policy Manager Console as yourself, login as ’admin’

with Timothee: 

get f-secure installation jar files and windows server updates

\\llnds03\ptsysadmin\F-Secure\

\\controlserver\Data\Temp

if installation fails , run the windows server updates 

on mcbackup

https://help.f-secure.com/product.html#business/releasenotes-business/latest/en/fspm_linux_15_11-latest-en
i'm following this , but there is no download link 

see PSD-821 in jira

but that's for the version 15.11

there's a new 15.20

Links in the jira ticket ;  ok they are downloading now .. 

so after you install it on mcbackup ,  

start it and check the status

if it is running fine, if it is malfunctionning, you'll have to install libcap progs

mcbackup:~/fsecure-stuff # rpm -i fspms-15.11.94088-1.x86_64.rpm

could have used -U  , to upgrade rataher than install:

i.e.

rpm -U fspms-15.11.<build_number>-1.x86_64.rpm

run the db maintenance tool

This is where can set the admin password. (for some reason the script in /opt/f-secure/change-admin-pass  did not work)

get this when running 

mcbackup:~ # /opt/f-secure/fspmc/fspmc  


then used username Admin and password <site root password>

do you use a f secure client on your laptop to connect ot it instead  ? 

Check status of fsecure   (does this refer to the Policy manager (aka  f-secure policy server) ?  Which is checked using f-secure policy console.

You may have to install libcap progs

And add kernel boot option file_caps=1

Then reboot mcbackup

but if it was working before with fsecure 13 ,  would it lose the file_cpas stuff  ?

The file_caps is needed from version 15 I think  Or 14

It's in mid5951 but not in upgrade part, in installation one

i was going to try with console on my laptop ;  have installed it but how to connect to the server on mcbackup with it ?  it is asking for a url .. have u used this ? 

then if this doesn't work , i can install libcap

Mcbackup.domainname.org

user name is admin, not root

And then root password

Oh actually you tried running the policy manager

i might keep going , see how far i can go 

Have you upgraded it to version 15?

running the policay manager ? 

Yeah the error you got

I thought it was the server

You can install the policy manager on controltools and work from there.

my pictures have gone frm the chat ;    the policy manager is the thing i'm running now on my laptop ? 

can i not just work from laptop ?  there is benefit to doing it from controltools ? 

If you feel it's reacting fast enough yes

does this seem right ?  

one is 15.01

It's ok, They don't have same version number

ok thanku , i'm a little confused by the export part ,  i don't see how can export to \\controlserver\Data\Temp ;  maybe only can do that if running the console from controltools ? 
In installation tab

First you import the fsss and fscs jar files

Then you export them

ok 

Import fscs and fsss using Policy Manager Console ; Installation tab ;  install

Export fscs and fsss using Policay Manger Console; Tools -> Installation Packages -> highlight and export to somewhere shared and accessible by the windows boxes ;  e.g.  \\controlserver\Data\Temp


Historian 	Windows Server 2012  	Export from mcbackup policy manager server fspms (accessed using policy manager console fspmc), the fsss file ;  then upload that to server and run it;  Export to \\controlserver\Data\Temp ; then upload it from here		When running the msi file , ​If you get crt error, you have to apply windows patch
Controlserver	Windows Server 2012	Export from mcbackup policy manager server fspms (accessed using policy manager console fspmc), the fsss file ;  then upload that to this server and run it; Export to \\controlserver\Data\Temp ; then upload it from here		When running the msi file , ​If you get crt error, you have to apply windows patch
Ppvs-ws	Win10	Export from mcbackup policy manager server fspms (accessed using policy manager console fspmc), the fscs file ;  then upload that to this server and run; Export to \\controlserver\Data\Temp ; then upload it from here		
Dynalog (if present on site)	Win10	Export from mcbackup policy manager server fspms (accessed using policy manager console fspmc), the fscs file ;  then upload that to this server and run; Export to \\controlserver\Data\Temp ; then upload it from here	Na	
Controltools	Win10	Export from mcbackup policy manager server fspms (accessed using policy manager console fspmc), the fscs file ;  then upload that to this server and run; Export to \\controlserver\Data\Temp ; then upload it from here; acutally can just run the msi file from here (see pic below)	updating	

\\controlserver\Data\Temp  is a shared folder you can access from everywhere.
Also put the windows patches here in case needed.

From controltools , using fspmc ,  the console ;  then export fscs and fsss to desktop ;  then move them to the \\controlserver\Data\Temp folder ; when export need to enter in the license code ; 


Exporting 

Asks for license ; get this from the jira ticket 

Client Security :
F-Secure Client Security 15.11 - CT3M-FX3H-2MF4-Y4PE-NG1T
Server Security :
F-Secure Server Security 15.01 - QA7D-TPMY-GZ70-UVK7-MRFY

From <https://prodg.jira.goiba.net/browse/PSD-821> 

Leave this as default ? 



 Here , change the host identification to winbios (Wins, netbios)

 

Tick both


Exports the msi file to the controltools desktop. ​

So yes, indeed, if it has to transit in Belgium...
Export on your laptop then

i have just installed it on control tools so will use that now
Import from controltools to controltools and export to controltools too
What OS are controlserver and historian on?
not sure , windows server 2012 i think
So you probably have to apply windows patches...
It is an annoying task as there are 9 of them and you have to reboot the vm after some updates...
And this on both VM
ok they have exported fine on controltools 
but i don't see this \\controlserver\Data\Temp
Open file explorer on controltools and try accessing this path
It will ask for credentials and you can use A2Admin_User
Was it what you mean?
yes , i can't get access :

Have you already installed fscs on controltools?
not yet
trying to get the windows updates from that folder u gave me , 
but can't access \\llnds03\ptsysadmin\F-Secure\ from controltools
It will take huge amount of time
Try from your laptop
what will take huge time ?  applying hte actual updates ? 
The transfer of those windows updates
 which one ? 

F-secure windows update seems the right one, no? 😉

25 min download and then would have to upload it 
Would be faster if you were on production network for the upload
​

have installed fscs on controltools ;  how do i know it installed properly ?  
it had an install dialogue , and that has gone but no message saying success or not
​
now will try ppvs-ws
i can't get in to ppvs , vnc is asking for a password and i don't know it 
Try the administrator password for the ppvs
MagiX-siteNumber-trX (X the room number, let's say 1)
MagiX-SBF109-tr1
MagiX-109-tr1
no that magix password doesn't work 
ibapass
Root password
If nothing work, ask the site for the pw
have tried those 
It is different
will have to ask the site tomorrow


was there some issue you had with firewall ? did the firewall turn on when doing this work ? 
i mean previously , is it somethign i need to be aware of ? 
​
updated fsss on historian ;    again it appeared to work but no success message ;  also historian is this edition 


​
On controltools, click on the arrow in bottom right part of screen and double click on f secure logo
​
this is controltools:

Good
It worked then
​
on historian :


Install .net framework 4.7.2 then
is this the windows updates that i downloaded ?  or just install .net 4.7.2 from features ? 
​
Apparently you don't need the windows updates
how do u know that / 
​
But let's check with controlserver first
​
Because it worked on historian
no it worked on controltools fscs 
And historian too
on historian i get that .net error
You just can't see the interface
oh ok 
installing 4.7.2 framework on historian now
You can proceed to controlserver meanwhile
​
historian :  


Good
​
Is there a dynalog vm?
no 
Ok
​
updating .net framewaork on controlserver 
​

Disabling firewall
Oooh
You need to create a policy to totally disable windows firewall too
how to create a policy in windows ?  open windows firewall ,  defender  ? 
i need to do that on all the windows ?  controlserver , controltools, historian, ppvs-ws1 ?
Just on controlserver and historian
has the install activated the fw ? 
Press Windows key, type policy and click on the first one. Something like edit group policy
The upgrade does activate windows firewall somehow
It breaks communication between the 2 VMs
Once in the group or local policy editor, go to windows firewall and disable it on every network: public, domain etc
Once done, check that you can use trends on controlserver and connect to historian server

Software maybe?
Or Windows...
In computer configuration
THIS ONE ?

YES, THAT PARTICULAR ONE!!!
So in public private and domain you disable the firewall

The last tab is ipsec but we don't care
seems nothing is enabled already :

Nonono
It is not configured
Which is way different
It is enabled by default
ha ok 
i clicked on the little link and got this :

Firewall state off
select off here ? 
And apply
And repeat

change anything here on inbound and outbound ? 

No that's fine if you just put it off
Perfect
Do that on the other vm
And then check trends on controlserver
It should work. Then you'll have to do the ppvs-ws when you can and that will be it
I'm glad I could help you. I will board in few minutes
ok done on both VMs now


Excluding files thing

So only the ppvs ws remaining and then files/folders exlusions
files/folders exlusions   ?
what is that part ? 
​
In mid5951
​
WHAT DO WE NEED TO EXCLUDE ?
Some archestra stuff
​i don't see anything extra about excluding in 5951 fsecure chaper


what was the exclude files thing ? 
Oh yes forgot that
Check in mid5951

i think u must have dreamt it cos there's nothing about it in 5951
Edited
​
Maybe not in the version you have
ah 
​
Check in metadoc for the last non approved one
ok i thnk A0
Yep
ok i see it now 
define exclusions
is this step crucial ? 
how long it takes ? 
30 minutes max
It depends on your ability to copy and paste each line
If it is in the mid, it is probably because f-secure blocked what's in the files/folders listed
ah there might be dynalog here 
No just controlserver and historian I think
so quite crucial then  ;  it will cause site down if not sorted tonight ? 
From the Policy Management Console select the correct client and in the right panel, then select Settings → Advanced view.
It is actually not that
it means pick one here ? 

You can define the exclusion in ppi-npcc
ok so click on ppi-npcc , and proceed from there ? 
And then apply to all hosts or just the one you want
But they have many common files and folders exclusions so it's better to define them in PPI npcc



a bit different , says it has been replaced 
then clicking that link takes me here :  


does that look familiar ? 
Yes because I didn't try the settings 😅
I went directly here
Time to fly now, I wish you good success
Have a good night after that
so this is the riht place to put the stuff i n? 
Yes
if this doens't work then i will have to roll back ? 

No no it's ok
ok 
hi Timothee , for logging in to ppvs-ws1.ppi-npcc.org  ,  there is no vnc password  ,  i just had the wrong port ,  use the standard port of 5900 and it should work 
Hello Chris. It worked indeed but the Administrator is not what it should be and IBAadmin user doesn't have privileges to install apps...
Ah ok. Thanks for info

Hi Timothee , the next step with this is ?  when you say the Administrator is not what it should be , you mean the password is not correct ? 
Hi Chris. The jira ticket has been updated. I got an answer from Mark Magness. The password was MagiX-f09-tr1 instead of MagiX-109-tr1 to avoid having the same as T09. They changed it and I upgraded f-secure on the ppvs-ws.
ah marvellous , thankyou ,  i should have checked the ticket ; many thanks

Hi Timothee ,  I will be in F15 , Reading , next week ..    Have you done the f-secure update there ?  does it need doing ?  if so I'm happy to do when down there ... 
Hello Chris. I haven't started yet in Reading. I am doing Leuven tomorrow and Jacksonville next week. I'll be pleased to support you when you'll do it. Would you please let me know when you plan to perform the upgrade or maybe I can even do it while you're working on something else.
If you know what time the system is available usually or if there is some night work going on, please inform me. Otherwise, I'm ready to deal with it when I'm done with Jacksonville.
Ok thanks, will be in touch during the week.. 
hi Timothee ,  will you be updating f-secure on the Upen site ?   I have a ticket about it , the database has not been updated in a long time  PSD-581  
if f-secure was to be updated there then it would probably resolve this issue at the same time .. 
Edited
"Would you please let me know when you plan to perform the upgrade"  -- -  it is pencilled in for Thursday afternoon / evening .  which is think is about midnight to 2am in Japan ... 
I could see if i can do it then , and if not can connect with you later when it is your morning .. 




For Policy Manager on Linux, use the following script to reset the user account:
/opt/f-secure/fspms/bin/fspms-reset-admin-account

From <https://help.f-secure.com/product.html?business/policy-manager/13.10/en/concept_453676D8D3A344618405CD1BCA4B2B26-13.10-en> 





Choose whether to restrict access to the administration module (only accessible from the local machine) [no]:

Enable Web Reporting [yes]:

Web Reporting port [8081]:


Creating administrator account.

Enter password:
The password must be at least 6 characters long.

Enter password:

Confirm password:
Cannot start F-Secure Policy Manager Server. The database requires maintenance.
To continue, run /opt/f-secure/fspms/bin/fspms-db-maintenance-tool.

Configuration is complete. You can manage the F-Secure Policy Manager Server
manually by typing '/etc/init.d/fspms {start|stop|restart|status}'.
Thank you for using F-Secure product.

mcbackup:~ # /etc/init.d/fspms start
Cannot start F-Secure Policy Manager Server. The database requires maintenance.
To continue, run /opt/f-secure/fspms/bin/fspms-db-maintenance-tool.
mcbackup:~ # /etc/init.d/fspms status
F-Secure Policy Manager Server is stopped.
mcbackup:~ # /opt/f-secure/fspms/bin/fspms-db-maintenance-tool



Configure emails

When connected to policy manager server using the policy manager console (which usually from my windows laptop) do:


congure the mail server for virus alerts the following way:
{ from the menu bar, select Tools menu, Server conguration...
{ in the dialog box, select Mail server tab, and fill the Server address box with mcrs3.yourdomain.org, leave the Login and Password boxes empty, keep SMTP in the Mail protocol box but fill the Sender e-mail box with fspms@mcbackup.yourdomain.org
{ still in the dialog box, select Server alerts tab, and  fill the Recipients e-mail box with root@mcrs3.yourdomain.org
{ optionally, select again the Mail server tab, click the Send test e-mail button, fill in root@mcrs3.yourdomain.org in the popup, click Send, the Cancel and check the mail has been sent.
{ click OK in the Server conguration dialog box to apply and close it


Create a domain tree like this?



BTW, if you can resolve the issue this way in Newcastle, could you then
also have a look at T09/UPenn where they faced a similar issue (and were
still facing it on Apr. 5). To make matters worse, they installed the
fspms and fspmc components on their mcrs3 (no idea why), so they should
also be moved to mcbackup.



If it struggles to open, I suggest to update it first 😊
You can find the rpm files under : \\llnds03\ptsysadmin\F-Secure

Procedure is under MID5951-34.9.3


Then after installing windows updates, run the fsss again , then get this :

Go here:
https://community.f-secure.com/common-home-en/kb/articles/5446-how-do-i-install-net-framework-4-7-2

To install .NET Framework 4.7.2, do as follows:
1. Go to page https://dotnet.microsoft.com/download/dotnet-framework-runtime/net472.
2. Click the Download .NET Framework 4.7.2 link, and save the executable file.
3. Find the file in your Downloads folder, right-click it and select Run as administrator.
4. Tick the box to accept the license terms and click Install. The installation starts.
5. Once the installation is complete, click Finish.
Note: You must restart your computer to complete the installation.
Note: If the manual installation fails, check the error message. If you cannot solve the issue based on the error message, contact F-Secure support.

From <https://community.f-secure.com/common-home-en/kb/articles/5446-how-do-i-install-net-framework-4-7-2>

Then after installing the windows patches , and the .net framework, run the fsss again , it should work

![](2021-11-18-14-48-08.png)

![](2021-11-18-14-48-41.png)

![](2021-11-18-14-49-00.png)

![](2021-11-18-14-49-12.png)

![](2021-11-18-14-49-22.png)

![](2021-11-18-14-49-31.png)

![](2021-11-18-14-49-41.png)

![](2021-11-18-14-49-48.png)

![](2021-11-18-14-49-58.png)

![](2021-11-18-14-50-07.png)

![](2021-11-18-14-50-18.png)

![](2021-11-18-14-50-27.png)

![](2021-11-18-14-50-33.png)

![](2021-11-18-14-50-38.png)

![](2021-11-18-14-50-44.png)

![](2021-11-18-14-50-50.png)

![](2021-11-18-14-50-58.png)
![](2021-11-18-14-51-04.png)
![](2021-11-18-14-51-10.png)
![](2021-11-18-14-51-16.png)
![](2021-11-18-14-51-22.png)

![](2021-11-18-14-51-28.png)

![](2021-11-18-14-51-36.png)

![](2021-11-18-14-51-42.png)

![](2021-11-18-14-51-49.png)


![](2021-11-18-14-51-57.png)


![](2021-11-18-14-52-03.png)

![](2021-11-18-14-52-22.png)



The install of f-secure may activate windows firewall 

Press Windows key, type policy and click on the first one. Something like edit group policy
Once in the group or local policy editor, go to windows firewall and disable it on every network: public, domain etc
Once done, check that you can use trends on controlserver and connect to historian server


[15:07] Christopher Finch

The install of f-secure may activate windows firewall
 
Press Windows key, type policy and click on the first one. Something like edit group policy
Once in the group or local policy editor, go to windows firewall and disable it on every network: public, domain etc
Once done, check that you can use trends on controlserver and connect to historian server


[15:10] Christopher Finch

after installing f-secure , i shouldv'e followed that note to check fw was off.. .. gwserver


Var/log/udp/syslog 



 fix gwserver's disk full from large number of syslogs

gwserver

Var/log/udp/syslog 

log rotation of syslog file on gwserver 

logrotate 

/etc/logrotate.d/syslog 

This is the config for logrotate 

/var/log/udp/syslog 

This is where the log lies 

/etc/cron.daily/logrotate     command to run it daily is here 

/etc/logrotate.conf 

another conf file 

/etc/init.d/syslog reload 

/usr/sbin/logrotate 

rotate weekly , keeps 4 weeks of backlogs 

mid58469 





log rotation of syslog file on gwserver 

logrotate 

/etc/logrotate.d/syslog 

This is the config for logrotate 

/var/log/udp/syslog 

This is where the log lies 

/etc/cron.daily/logrotate     command to run it daily is here 

/etc/logrotate.conf 

another conf file 

/etc/init.d/syslog reload 

/usr/sbin/logrotate 

rotate weekly , keeps 4 weeks of backlogs 

mid58469 ---


# mcrouter ; switch-psr ; watchdog reset

N.B.: The form below is applicable for the Bug type 'Problem Report' (PR) only.
Please answer each question below in Section 1 and 2. If Not Applicable simply put N/A. Any Problem Report not populated correctly will be rejected. Section 3 is optional, to assist in proper prioritization of Bugs.

1 Problem Description
1.1 Describe what happened compared to what was normally expected:

This watchdog reset occurred in both f10 (March 2021) and f15 (December 2021).
When switch-psr resets it seems to cause a quench ;  it coincides with a quench occurring.  

1.2 Is the problem reproducible: 

 No , the cause of the watchdog reset is unknown ; the watchdog 'feature' occurs after a switch routine self test, if something is detected with the hardware that is serious then the switch watchdog initiates a reboot.  

Is there a way to prevent this reboot since the consequences may be a quench !   

1.2.1 If yes, indicate how many times: 
    
Twice
    
1.2.2 If yes, explain how to reproduce (exact steps): 
    
it is automatically initiated by a process on the mcrouter and switch-psr , known as watchdog. 

1.3 Related part number (ref IBA) if applicable and if it exists: 

Procurve; Serial numbers of the switches to come...  

1.4 PTS/AI version: 

f10 was running r11 at the time ;  Reading also r11;  PTS version probably not related since it is an issue with the Procurve operating system .

1.5 If it is a software related bug, indicate the software version and on which screen you were working when the problem occurred: 

Previously when this occurred in f10 , the firmware of the switch was at version KB.16.05.0004.

This time occurring in f15 ,  the firmware of the switch was at KB.16.05.0007

 
The recommendation from HPE last time in f10 was to follow the following upgrade path: 

KB.16.05.0004  to  KB.16.08.0001  to  KB.16.10.0012

This time in f15 , the same upgrade path was following 

KB.16.05.0007  to  KB.16.08.0001  to  KB.16.10.0012

which is the same except for the different starting point.

 
Upgrade method was using the web UI to upload the firmware , followed by a reboot.

1.6 When did the problem happen (Day, hour, minute, second. This will help to locate the related events in the logs): 

f15;  13 Dec 2021 at 1120
f10;  30 March 2021 at 1113 

1.7 When was IBA made aware of the problem: 

Troubleshooting and start of quench recovery , and investigation of cause was immediate. 

1.8 Where did the problem happen: 
    1.8.1 On which Customer Site: 
    
f15 ; f10
    
    1.8.2 In which room: 
    
TR1 
    
    1.8.3 If applicable, in which cabinet: 
    
switch-psr

1.9 Who was present when the problem happened: 

James Mascheranas  ;  site team 

1.10 What are the apparent causes of the problem: 

Switch-psr rebooting itself after a self test ; initiated by 'watchdog'

1.11 Please attach any pictures, drawings, screenshots or extract of log files that help describe the problem. 

I 12/13/21 12:21:24 03802 chassis: xM1: System Self test started on Master
W 12/13/21 12:21:24 03443 system: xM1: The event log buffer is 80% full.
I 12/13/21 12:21:24 03803 chassis: xM1: System Self test completed on Master
I 12/13/21 12:21:26 00061 system: AM1: -----------------------------------------
I 12/13/21 12:21:26 00062 system: AM1: System went down without saving crash information
I 12/13/21 12:21:26 03006 system: AM1: Reason for system reboot: Watchdog reset


2 Actual Impact (Real consequences)
  ---------------------------------
2.1 Was there an impact for a patient: 

Yes , patient fraction had to be cancelled ; and subsequent quench recovery days , patients needing to be cancelled. Therefore major disruption to patient and customer.  

    2.1.1 If Yes, select the impact:  
    
 Patient cancelled 
    
    2.1.2 Add further details if available: 
    

2.2 Was there a safety impact for an IBA operator: 

 No

    2.2.1 If Yes, describe the impact: 
    


2.3 Is there an impact for Service: 

Yes , reduction in confidence for site team and customer ; we would like to find out why this is occuring , if it is really necessary for this watchdog reset to initiate , if it can be disabled, if there are other sites where this could happen ,  is it due to the specific version of firmware that the sites were running ?  

If Yes, describe:
    2.3.1 Hours spent outside clinical SOH: 
    
2 days
    
    2.3.2 Hours of downtime: 
    
48 hours
    
    2.3.3 Mission required (# eng., # days): 
    
currently support is remote from TSC , beam helpdesk and sw helpdesk 
    
    2.3.4 Mission impacted (# eng., # days): 
    

    
    2.3.5 Other: 
    
    [Answer]

2.4 Is there an impact for Installation: 

 Unknown

    If Yes, describe:
    2.4.1 Lost time (# shifts, during rigging or on critical path): 
    

    
    2.4.2 Additional subcontractor required (cost): 
    

    
    2.4.3 Other: 
    

2.5 Is there an impact for Manufacturing: 

 Unknown

    If Yes, describe:
    2.5.1 Lost time (# hours): 
    
    
    2.5.2 Other: 
    


3 Potential Impact (Risk)
  -----------------------
3.1 Do you think the problem could have had a higher impact than what occurred? If yes, indicate the potential severity, using the same categories from section 2: 

A sudden unpredicatable shutdown of the switch-psr seemingly has caused a quench twice . 

3.2 Do you think the problem could reoccur? If yes, indicate the potential frequency of occurrence (# potential occurrences / year for one machine / room / site): 

yes ,  it has happened twice on POnes so far. 

4 Actions taken
  -------------
4.1 Have you put in place any immediate action, correction or workaround? If yes, describe: 

The firmware has been upgraded as recommended by HPE ; 



I 12/13/21 12:21:24 03802 chassis: xM1: System Self test started on  Master
W 12/13/21 12:21:24 03443 system: xM1: The event log buffer is 80% full.
I 12/13/21 12:21:24 03803 chassis: xM1: System Self test completed on  Master
I 12/13/21 12:21:26 00061 system: AM1: -----------------------------------------
I 12/13/21 12:21:26 00062 system: AM1: System went down without saving crash
            information
I 12/13/21 12:21:26 03006 system: AM1: Reason for system reboot: Watchdog reset




procurve 


https://h10145.www1.hpe.com/downloads/SoftwareReleases.aspx?ProductNumber=JL003A&lang=&cc=&prodSeriesId=


[13:05] Frederic Moniquet
Cross check occurence of F10- What was the error message?- What was the firmware version then?- What is the firmware version now?

[13:06] Frederic Moniquet
Check firmware version of F15 right now

[13:06] Frederic Moniquet
Check B9 - mcrouter 

[13:06] Frederic Moniquet
Check B13 - Switch-psr



As advised system went down without saving the crash file, in the logs history we found that watchdog reset for both switches.

A watchdog is something that checks the functioning of your system, and restart the system when components stop responding (properly). This is done in the hope that after a restart, things will be better.

Restarts due to watchdog timeout indicate a serious issue with your hardware/software.

I would advise you to upgrade the software code at KB.16.10.0012 

(https://h10145.www1.hpe.com/support/SupportLookUp.aspx)

Firmware path is to upgrade is like KB.16.05.0004 >>KB.16.08.0001>>  KB.16.10.0012

Please find the methods to upgrade the firmware on your switch below and use the one which suits you:
 
 Method 1: Via the WEB UI 

- Login to the WebUI with the manager credentials and click on System 
- If you have the improved WebUI, Click on System, then Firmware updates, then drag and drop or browse the firmware file and update it, then reboot the switch 
- If you have the traditional WebUI, if your switch is not already on 16.03.xxxx and later, then
- Select Updates/downloads
- Now under the Software image, select the update option
- Now Browse for the firmware file and then select the save option, This should write the file to the switch 
- Reboot the switch by selecting the reboot option 

 Method 2 : Via TFTP 

- Download the TFTP d32 or TFTPd64 application, which makes your PC act as a TFTP server
- Connect to the switch directly via an ethernet cable
- Open the TFTP application and browse for the file, ( ideally should be on desktop for ease of access)
- Select the correct IP address on the TFTP server (Make sure this IP is the same IP that the PC/Desktop has on it's ethernet adapter)
- Now from the CLI of the switch run the command: switch#copy tftp flash <ip.address of the tftp server> <file name> <primary/seconday>
- This should write the file to the primary or secondary flash memory as selected 
- Reboot the switch,  Switch#boot system 

 Method 3 : Via a USB/flash drive

- Format the USB/flash drive in Fat 32 format
- Copy the firmware in the USB . Note : Do not put the firmware file in any folder
- Insert the flash drive into the switch and then run the command : switch(config)# Dir, to confirm if the switch is recognising the files in the USB flash drive 
- switch(config)#copy usb flash <file-name/ name of the firmware file in the USB drive> <primary/secondary>
- Confirm that the flash primary memory has taken the firmware with the help of show flash command 
- After that reboot the switch to complete the firmware upgrade process. Command : switch(config)#reload
- Verify from the comamnd : switch#show version , that the switch is booted into the desired firmware version.

Note:Before upgrade make sure you need to take backup of running config for the switch & save the config before reboot the switch.


Its recommended best practise before upgrade you should have back up config for the switch & before reboot we always execute command "write memory" so that  in case something goes wrong we will have back up & revert back changes.

Please advise if you have rebooted the switches & see any issue further reported. 

Thats good news lets monitor today & weekends as well.

If no issue reports then we will close this case on Monday.



![](2021-12-13-14-30-18.png)

![](2021-12-13-14-03-42.png)

![](2021-12-13-14-01-47.png)

JL003A	SG83GPR055	HP ProCurve 5406zl	switch-psr.ppi-rcctv.org	24/24	22/06/2021

JL003A	SG83GPR00T	HP ProCurve 5406zl	mcrouter.ppi-rcctv.org	24/24	22/06/2021



As I understand it , the plan is for HPE engineers to first provide support and log analysis in to the issues we have had with our two routers over the past two days.  Our initial analysis from the logs seems to suggest that in both cases the routers were automatically reset by watchdog .

The routers are part of the infrastructure of medical equipment , and these resets have caused significant disruption.

If faulty hardware is detected then we may proceed to support with replacing.

Please find attached the logs for the two routers .

https://support.hpe.com 

Case Reference ID: 5354640936 

Status: Case is generated and in Progress 

Subject: Aruba 5406R 44GT PoE+ and 4-port SFP+ (No PSU) v3 zl2 Switch - Log analysis assistance reboot issue - Page 3 [Yes]

Product: Aruba 5406R 44GT PoE+ and 4 port SFP+ (No PSU) v3 zl2 Switch 

Product Number: JL003A 

Serial number: SG78GPR04M


As advised system went down without saving the crash file, in the logs history we found that watchdog reset for both switches.

A watchdog is something that checks the functioning of your system, and restart the system when components stop responding (properly). This is done in the hope that after a restart, things will be better.

Restarts due to watchdog timeout indicate a serious issue with your hardware/software.

I would advise you to upgrade the software code at KB.16.10.0012 (https://h10145.www1.hpe.com/support/SupportLookUp.aspx)Link to download firmware

Firmware path is to upgrade is like KB.16.05.0004 >>KB.16.08.0001>>  KB.16.10.0012

Please find the methods to upgrade the firmware on your switch below and use the one which suits you:
 
Method 1: Via the WEB UI 
•    Login to the WebUI with the manager credentials and click on System 
•    If you have the improved WebUI, Click on System, then Firmware updates, then drag and drop or browse the firmware file and update it, then reboot the switch 
•    If you have the traditional WebUI, if your switch is not already on 16.03.xxxx and later, then
•    Select Updates/downloads
•    Now under the Software image, select the update option
•    Now Browse for the firmware file and then select the save option, This should write the file to the switch 
•    Reboot the switch by selecting the reboot option 
Method 2 : Via TFTP 
•    Download the TFTP d32 or TFTPd64 application, which makes your PC act as a TFTP server
•    Connect to the switch directly via an ethernet cable
•    Open the TFTP application and browse for the file, ( ideally should be on desktop for ease of access)
•    Select the correct IP address on the TFTP server (Make sure this IP is the same IP that the PC/Desktop has on it's ethernet adapter)
•    Now from the CLI of the switch run the command: switch#copy tftp flash <ip.address of the tftp server> <file name> <primary/seconday>
•    This should write the file to the primary or secondary flash memory as selected 
•    Reboot the switch,  Switch#boot system 
Method 3 : Via a USB/flash drive
•    Format the USB/flash drive in Fat 32 format
•    Copy the firmware in the USB . Note : Do not put the firmware file in any folder
•    Insert the flash drive into the switch and then run the command : switch(config)# Dir, to confirm if the switch is recognising the files in the USB flash drive 
•    switch(config)#copy usb flash <file-name/ name of the firmware file in the USB drive> <primary/secondary>
•    Confirm that the flash primary memory has taken the firmware with the help of show flash command 
•    After that reboot the switch to complete the firmware upgrade process. Command : switch(config)#reload
•    Verify from the comamnd : switch#show version , that the switch is booted into the desired firmware version.

Note:Before upgrade make sure you need to take backup of running config for the switch & save the config before reboot the switch.


Its recommended best practise before upgrade you should have back up config for the switch & before reboot we always execute command "write memory" so that  in case something goes wrong we will have back up & revert back changes.

Please advise if you have rebooted the switches & see any issue further reported. 

Thats good news lets monitor today & weekends as well.

If no issue reports then we will close this case on Monday.

Please advise if we are good to close the case since we have already upgraded the switches & monitored as well.


# Support ; contact Technogroup

There is an issue with some piece of hardware of the infrastructure on a site. 

For example in f10 an email was received on 19 Oct 2021 about 3par disk warning

Look in mid53807 to find out what contracts the site has and to get further reference of who to contact.

From mid53807, for 3par it references mid84238 , which is an email from Melanie with further info. 

From the email mid84238: 

    Please have your Service Agreement ID and Product/Serial available

    To log a call please telephone our Customer Care Reception on: 0845 161 0050

Service agreement ID is obtained from the same mid84238 email: 

Service Agreement ID: 1085 1275 9746

The Product/serial can be obtained either from the automated warning email, or from the metadoc email. 

Product/serial: CZ3737S8N9  -- this is the serial number of the 3par in Newcastle . 

Other places you can look 
More info on the Technogroup contract ; search for 'technogroup' in metadoc 

Get the serial numbers of the various devices; Find and download the spreadsheet relating to the site ; where to get this? i think it is in an lln fileshare , but where? 


Technogroup
00 800 777 33 555

+49 (0) 6146 8388 200

tgsupport@technogroup.com

then they might refer you to Cantel.

TechnoGroup hardware service agreement 

PO 4570014497 

26th September 2020 to the 25th September 2022 

DMR included
	
Name of coverage: 
TA04 
Dates of coverage: 
26 Sept 2020 to 25 Sept 2022
Coverage includes:
7x24 Support;  4h engineer on site (after the fault is registered); Callback by our technician within 15 minutes

Technician on-site in up to 4 hours > IZ04: Resolution within 4h



See  P:\MVS\Third Party CS\PT\PT Sites\Newcastle UK\Suppliers\Newcastle 3rd Parties 25 09 20.xlsx
	 
purchase order 4570014497.
 
Donna and Jonathan , Mark are in contacts database. 



55258-B21	CZ3737S8M3	HP ProLiant DL360 G9	cnode03.ppi-rccn.org	25/09/2020	IZNBD



Sort out the broken hp tape in Bomarsund

First check if the hardware is in warranty by getting serial number of the hardware in the ilmn database 

Found out it was out of warranty ; so then opened email from melanie which had a quotation in it showing what is covered and for how long

Technogroup

support@cantel.uk.com

HP  DL360 G8/G9

If it is a HW failure, Technogroup needs to be informed (contract in MID 92986).

# Tools ; iba servers

![](2021-11-18-13-16-34.png)![](files/2021-11-18-16-21-57.png)iba servers

Hosted on cernunnos.lln.iba  172.30.1.178 : 

Site | Description

http://cernunnos.lln.iba:8081/scts/ | Site configuration tracing system 

http://cernunnos.lln.iba/ | 

http://bugzilla.lln.iba/ | Bugzilla 

http://warzone.lln.iba/ |Warzone (IBA LLN) 

http://cernunnos.lln.iba/wzus/ | Warzone (IBA Molecular) 

http://eshare.lln.iba/ | eShare: experience sharing 

http://irm.lln.iba/ | IRM 

http://sandwich.lln.iba/ |Sandwich 

masrnd.lln.iba |

http://cernunnos.lln.iba/IBA_Sites/ |

druantia.lln.iba (10.100.1.58) 

Subversion.lln.iba 

http://subversion.lln.iba/websvn/  | WebSVN (renovated TCS) 

Llnmetadoc.goiba.net 

nissyen.lln.iba (10.100.1.47) 

http://redmine.lln.iba/ 

gitlab.sw.goiba.net (10.170.100.4) 

damona.lln.iba (10.100.1.54) 

teamcity.lln.iba 

http://teamcity.lln.iba/login.html | Team City (continuous integration) 

http://teamcity.lln.iba/repository/download/Tools_Frites/.lastSuccessful/HTML/index.html?guest=1 | FRITES 

sonarqube.lln.iba (10.100.1.52) 

http://sonar.lln.iba/ | SonarQube 

ogma.lln.iba (10.100.1.40) 

http://ogma.lln.iba/catalog/?component=all&version=all&filter= | PTS Java Webstart catalogue

Linked from sucellos 172.30.1.160 

http://sucellos.lln.iba/projects/asterope/ | Asterope design documents 
http://sucellos.lln.iba/TCS/TCS_MGH/ | TCS V3 Raw Source Code 
http://sucellos.lln.iba/TCS/TCS_HTML/ | TCS V3 HTML Cross-ref 
http://sucellos.lln.iba/htdig/rawTCSsearch.html | TCS V3 Search Engine 
http://sucellos.lln.iba/TCS/autorelnotes/arn.main.html | Release Notes-O-Matic V3 
http://sucellos.lln.iba/projects/ | TCS-related projects 
http://sucellos.lln.iba/linksbase/ | Links Base 
http://sucellos.lln.iba/dropzone/ | Dropzone 

On Thor 10.100.18.45 
http://thor.lln.iba:2080/arn/ | Automatic release note tool 
http://thor.lln.iba/Mayo-web/ | Mayo- the parameter descriptor 

# MPSS ; swap an mpss controller 

MPSS controller swap and need to update DHCP table with new mac address

Toyohashi
10.2.80.150 00-00-13-00-95-23

[13/11/2021 01:43] PT Technical Support Center
on the controller in /etc/network/interfaces

The primary network interface:

auto eth0

iface eth0 inet dhcp

i'll try to add ip manually

You have updated DHCP config file on MCRS3, right?


![](2021-11-22-11-34-25.png)


[10:47] Yuya Toi
If I changed the IP from static to DHCP.  Could you change the MAC address? My understand is right?

[10:49] Yuya Toi
I found two files ("interface" and "interface_dhcp") in /etc/network/


# IBA wallpaper 

IBA wallpapers can be obtained from:

mcrs3:/products/ibanet/wallpapers  

- Clinical desktop should be green
- tcs desktop should be orange
- raspberry pi terminal used for vnc next to mcr screens should be blue.

# RAID ; Show the RAID status

On a system with RAID e.g. mcrw or tcrw:

during start up press ctrl-p 

# Travel ; how to book travel

From intranet site, go to travel;  then from the concursolutions website can book the hotel. 

If it is a flight , can also get it from there . 

If it is  a train , will have to book that separately and use CCC

How to fill in the stuff for concur when getting a hotel:

![](files/2021-11-18-13-08-41.png)

# Nagios ; Deploy nagios

nagios:~/nagios-standard # ./nagios_deploy

webhook to use:

https://iba2016.webhook.office.com/webhookb2/c8095c54-0740-4b3e-ab50-97c306e7112a@c2a8770b-ad33-4215-bbe7-ec4185e9587b/IncomingWebhook/3854a12959f8453ab46dc96abac95ddd/8f71b763-33ef-4884-a19a-35b9b9aaca77

# Nagios ; Restart nagios service 

On nagios workstation

rcnagios restart 

systemctl restart nagios

On remote linux host

`service nrpe restart`

`/etc/init.d/nagios-nrpe-service restart`   (?)

`root@pridex:/etc/init.d# ./nagios-nrpe-server restart`

`systemctl restart nagios`
	 
/etc/nagios/nrpe.cfg 

Add nagios server as allowed or only_from

# Nagios ; Dealing with this error 1

`CHECK_NRPE: Receive header underflow - only -1 bytes received (4 expected)`

Log in to the remote host 

Open the nrpe.cfg file:

`gwserver:/etc/nagios # vim nrpe.cfg`

Add nagios as an allowed host:

`allowed_hosts=127.0.0.1,10.3.20.17`

Then restart the nrpe daemon on the remote host. See 

Also look here:

/etc/xinetd.d/nrpe

# Nagios ; Is the communication between nagios and the remote host using SSL? 

1. Look on the remote Windows host

c:\Program Files\NSClient++\nsclient.ini 

Change use ssl to 0 from 1 

use ssl = 0 

Restart with 

`net stop nscp` 

then

`net start nscp` 

2. Look on the remote linux host

If not using ssl, in /etc/xinetd.d/nrpe add -n 

For example:

`server_args = -n -c /etc/nagios/nrpe.cfg --inetd`

Restart the xinetd service with `service xinetd restart`

Add -n added in nrpe.service to allow no ssl connection:

`egrep "\-n"  /usr/lib/systemd/system/nrpe.service`

returned `ExecStart=/usr/sbin/nrpe -n -c /etc/nagios/nrpe.cfg -f $NRPE_SSL_OPT`

3. Look on Nagios master : 

commands.cfg in /etc/nagios: 

`command_name check_nrpe`

`command_line $USER1$/check_nrpe -n -2 -H $HOSTADDRESS$ -c $ARG1$`

`check_nrpe!alias_cpu`

`$USER1$/check_nrpe -n -2 -H $HOSTADDRESS$ -c $ARG1$`

`./check_nrpe -n -2 -H controlserver -c alias_cpu`

`check_nrpe -H localhost -n`

returns: 

NRPE v3.2.1

# Nagios ; Nrpe running on the remote machine? 

`service status nrpe`

`service restart nrpe`

# Nagios ; Issue with users / contacts ?  

Edit /etc/aliases on mcrs3 

Edit /etc/aliases on nagios 

Run the command newaliases 

Edit /etc/nagios/contacts.cfg on nagios 

After configuration file change, [restart nagios](#how-to-restart-nagios-service)

# Nagios ; How to install Nagios NSClient++ 

https://www.tecmint.com/how-to-add-windows-host-to-nagios-monitoring-server/

How to Add Windows Host to Nagios Monitoring Server

On ppvs-ws1, controlserver, controltools

Install NSClient++ 

Set the service to automatic.

When set up the nsclient on the ppvsws it seemed to be missing a certificate. A file ending .PEM

# Nagios ; Idea: Use the Nagios Remote Data Sender (NRDS) 

Look at doing a whole installation of the PTS system using virtualbox containers and gns3, start with using linux containers perhaps. 

or with  

https://www.nsnam.org/releases/ns-allinone-3.29.tar.bz2 

NRDS is a way of monitoring remote clients 

the client is the one that contacts the nagios server, 

so they only need an outbound port open for it to work. 

NDRS also allows you to add configuration updates that the clients will get the next time they connect, so you don't need to connect to the site to make changes.

# Nagios ; zypper update breaks the nagios set-up

Remove the server-monitoring repo using 'zypper rr server-monitoring' 

# Nagios ; check_load plugin

Check the system's load average.

```
check_load [-r] -w WLOAD1,WLOAD5,WLOAD15 -c CLOAD1,CLOAD5,CLOAD15 [-n NUMBER_OF_PROCS]
```

WLOAD1: If the average load over 1 minute exceeds WLOAD1 then raise a warning;

WLOAD5: if the average load over 5 minutes exceeds WLOAD5, then raise a warning;

WLOAD15: if the average load over 15 minutes exceeds WLOAD15, then raise a warning;

CLOAD1: If the average load over 1 minute exceeds CLOAD1 then raise a critical warning;

CLOAD5: if the average load over 5 minutes exceeds CLOAD5, then raise a critical warning;

CLOAD15: if the average load over 15 minutes exceeds CLOAD15, then raise a critical warning;

`-r` : Divide the load averages by the number of CPUs (when possible)
`-n NUMBER_OF_PROCS` Number of processes to show when printing the top consuming processes. NUMBER_OF_PROCS=0 disables this feature; default value is 0

With a multicore cpu, the load average is the summation of all the cores: 

1 min load avg = 1_min_average_for_core_1 + 1_min_average_for_core_2 + ...

5 min load avg = 5_min_average_for_core_1 + 5_min_average_for_core_2 + ...

15 min load avg = 15_min_average_for_core_1 + 15_min_average_for_core_2 + ...

So if a load is 1 on a 4 core server, then it either means each core is used 25% or one core is 100% under load. A load of 4 means all 4 cores are under 100% load. 

-r, --percpu

Divide the load averages by the number of CPUs (when possible) 

When -r is used, you can think of your server as having just one core and hence write the percent fractions directly without thinking of number of cores. 

With -r the load is between 0 and 1 (0% and 100%) , whereas without the -r option then the load can be >1 

Example: 

A warning alert, if CPU is 70% for 5min, 60% for 10mins, 50% for 15mins. A critical alert, if CPU is 90% for 5min, 80% for 10mins, 70% for 15mins.

`command[check_load]=/usr/local/nagios/libexec/check_load -w 0.7,0.6,0.5 -c 0.9,0.8,0.7`

The load values can be viewed using the uptime command

$ uptime

14:34:03 up 10:43,  4 users,  load average: 0.06, 0.11, 0.09

From the above output load average: 0.06, 0.11, 0.09 means (on a single-CPU system):

during the last minute, the CPU was underloaded by 6%

during the last 5 minutes, the CPU was underloaded 11%

during the last 15 minutes, the CPU was underloaded 9%

$ uptime

14:34:03 up 10:43,  4 users,  load average: 1.73, 0.50, 7.98

The above load average of 1.73 0.50 7.98 on a single-CPU system as:

during the last minute, the CPU was overloaded by 73% (1 CPU with 1.73 runnable processes, so that 0.73 processes had to wait for a turn)

during the last 5 minutes, the CPU was underloaded 50% (no processes had to wait for a turn)

during the last 15 minutes, the CPU was overloaded 698% (1 CPU with 7.98 runnable processes, so that 6.98 processes had to wait for a turn)

Nagios threshold value calculation:

For Nagios CPU Load setup, which includes warning and critical:

y = c * p / 100

Where: y = nagios value c = number of cores p = wanted load procent

for a 4 core system:

time      5 min  10 min    15 min

warning:  90%    70%       50%

critical: 100%   80%       60%

command[check_load]=/usr/local/nagios/libexec/check_load -w 3.6,2.8,2.0 -c 4.0,3.2,2.4

For a single core system:

y = p / 10p

Where: y = nagios value p = wanted load procent

time       5 min  10 min    15 min

warning:   70%    60%       50%

critical:  90%    80%       70%

command[check_load]=/usr/local/nagios/libexec/check_load -w 0.7,0.6,0.5 -c 0.9,0.8,0.7

A great white paper about CPU Load analysis by Dr. Gunther http://www.teamquest.com/pdfs/whitepaper/ldavg1.pdf 

In this online article Dr. Gunther digs down into the UNIX kernel to find out how load averages (the “LA Triplets”) are calculated and how appropriate they are as capacity planning metrics.

Unless the servers in question have an asynchronous workload where queue depth is the important service metric to manage then its honestly not even worth monitoring load average. Its just a distraction from the metrics that matter like service time (service time, and service time).

A good complement too Nagios is a tool like Munin or Cacti, they will graph the different kinds of workload your server is experiencing. Be it load_average, cpu usage, disk io or something else.

Using this information it is easier to set good threshold values in Nagios.

Do you know at what load average your system's performance is affected? We had servers at my last job that would consistently sit at 35-40 load average, but were still responsive. It's a measurement you have to do a bit of detective work to get accurate numbers for.

You might want to instead measure some other metrics on the system, like average connect time for SSH or http; this might be a better indicator of how much load your system is under.


# Nagios ; configs v1 update

Firstly download the git project from gitlab: 

https://gitlab.sw.goiba.net/pdg/nagios-standard

SAT.131 - Zhuozhou

https://iba2016.webhook.office.com/webhookb2/1babd140-d5ad-4175-87e5-3b960ae09bbd@c2a8770b-ad33-4215-bbe7-ec4185e9587b/IncomingWebhook/b2c4804998374bff9d4813941189f199/86443bdf-3e95-4f49-b0ba-80ef2b2bb4b7

# Nagios ; Network ; xinetd  

Using xinetd or the service is running directly ? Network

so i have 1 connected to the defaut vlan and the other one in the scanning controller

i added some routes for the various sub segment of the vlan sc in mcrw1

can u remind me, how to add routes ?   that is in iptables  or something ? 
from yast in the network config smile

and in the pts config, override the target host in the runtime folder for the process bcp/bdcu

# Network ; control unites ; scalance ; profinet devices 

![469cfc9e668ccacd815d2ed54b0c88dd.png](../_resources/ab3cea4aec5b4acba875178c50ba591e.png)

ACU is the profinet master , the other devices here are the slaves; the scalance is a special switch from siemens for the profinet network..

# IBA office file shares

10.20.40.150   f09

10.30.20.150   f10

can also use f10.goiba.net  ? ?

# Network ;  troubleshoot

traceroute

If trying to see if can communicate through a firewall with a particular protocol on a certain port then, for e.g. :

traceroute --tcp --port 2049 mcrs3.ppi-rccn.org

Then I was able to see that from pridex i could actually communicate with mcrs3, the issue was that the firewall was dropping the packets. 

nmap

nmap -sP -PI -PT 192.168.1.1/24 

From <https://www.granneman.com/teaching/websteruniversity/infosecmanagement/auditor/nmap>

# Network ; Reading ; Port Patching

Please find in the mail here below my request about the cables to patch between, PPI and IBA.  

And the answer:  

IBA ports already patched as requested – 
PPI cable 1: internet GI 4/1 
PPI cable 2: internet Gi 4/3 
PPI cable 3: internet Gi 4/5 
PPI cable 4: internet Gi 4/6 
PPI cable 15: A/G/022 (IBA Customer Service 
Office) Gi1/39 
PPI cable 16: A/G/023 (IBA Customer Service 
Office) Gi1/42 
PPI cable 17: A/G/024 (IBA Customer Service 
Office) Gi1/41 
PPI cable 18: A/G/025 (IBA Customer Service 
Office) Gi1/12 
PPI cable 19: A/G/016 (Anaesthesia room)Gi1/18 
PPI cable 20: A/G/011 (Anaesthesia room)Gi1/07 


snag list
Available on shared drive \\F15\Common\01_Technical 

Details for Office server: 

Please find in attachment a mail exchange of the Office wap not working. Check to be done on each one to see if they are ok. (TCR, Office, Server Room.) 

Wiring: 

1 to 24: users 

37 => printer 

38 => srv iLo 

39 => srv eth1 

40 => srv eth2 

41 => srv eth3 

42 => srv eth4 

43 => WAP -- goes to s60 on patch panel 

44 => WAP -- goes to office aruba -- PPI 17 ; port A/G/024 in office 

45 => WAP -- goes to aruba in server room. 

46 => IBA-firewall (PTS firewall) 

47 => G0/0/2 (Office firewall) 

48 => G0/0/3 (office firewall) 

Please ensure there is no interruption for the customer. So, if you can wire first the new server and when the system is not used, switch the cables between the temporary server and the server on the rooter. (The main internet line for PTS is going through this router



# PCU 

The PCU PC inside the cabinet in the PSR, it boots from a linux installation that is on the mcrs3 server rather than from the local PC (reason? Perhaps no harddrive in the pcu cabinet PC) so the doc MID 45239 should be followed. 



# Network ; customer side

Sorry typo with last email IPs should read: 10.207.120.185 is the correct address for NE and Reading will be 10.208.120.185 

Liverpool will be 10.210.120.185 when it’s built! 

Hi Mike: 

I think so, if this IP is the system resided on one monitor in the TCR. 

I try to ping addresses showed in the IP list, all of which are available except 10.207.120.185 and 10.207.111.62 (sequencer). They both show “packet filtered”. 

bwang@tcrw1:/tcs_usr/bwang $ ping 10.207.120.185 

PING 10.207.120.185 (10.207.120.185) 56(84) bytes of data. 

From 10.207.221.1 icmp_seq=1 Packet filtered 

From 10.207.221.1 icmp_seq=2 Packet filtered 

Hi Bruce 

I would not expect an ICMP response from either 120.185 or 111.62 as both of those machines are not on the network. Note that in Newport there is a 111.62 available. 

The ACL applied to VLAN221 does not include either of these IPs in Northumbria, so will be dropped. 

Mike Sparrey 

Hi Mike: 

I think so, if this IP is the system resided on one monitor in the TCR. 

I try to ping addresses showed in the IP list, all of which are available except 10.207.120.185 and 10.207.111.62 (sequencer). They both show “packet filtered”. 

bwang@tcrw1:/tcs_usr/bwang $ ping 10.207.120.185 

PING 10.207.120.185 (10.207.120.185) 56(84) bytes of data. 

From 10.207.221.1 icmp_seq=1 Packet filtered 

From 10.207.221.1 icmp_seq=2 Packet filtered 

I check the firewall policy and confirm ICMP access is permitted by each side.  

I will be off site next week. As soon as I return I will continue the sequencer IP test.  

Thank you and have a good weekend! 

Thanks and best regards! 

Checking the Newport switch, I cannot find an ARP record for 10.205.120.185. Is this still an IP you need access to? 

Sorry typo with last email IPs should read: 10.207.120.185 is the correct address for NE and Reading will be 10.208.120.185 

Liverpool will be 10.210.120.185 when it’s built! 

Hi Bruce, 

I have spoken to James and it is in the right vlan so use 10.207.110.185 and James will reserve it. 

You guys can use 10.208.110.185 in Reading too. 

This keeps it all consistent for support purposes. 

MID 66904


# Network ; Accessing customer shared drive from adapt insight pc ; ppvs ws

got the password for ppiguest network from Donna, still unable to ping the ip that james gave us. 

Had a look at setting up the shared drive – is the ip that I’m pinging below correct?  

The firewall is open to allow the ppvs-ws1 pc to connect to that ip. 

10.207.111.185 

10.207.221.1 


# mcrouter ; commands

show arp vlan [id] 

show mac-address vlan [id]

# Network ; Dealing with a port loop protecction 

Check port B13 on switch-psr (disabled by loop protection) 

- Analysis of events on Wednesday around 1PM

- If issue remains: check potential network saturation that could explain multiple disconnections on SRCU

From <https://iba2016.sharepoint.com/sites/TechnicalOperationsSiteReports/SitePages/June-2021---SBF.115---Reading.aspx?from=SendByEmail&e=Yrq-BU96s0CGj6kIFrfMUA&at=9> 

Hostnames are called different in different sites:-

cnshcu-drv1 is called cnsh-drv1 in F10


# Office file share server ; how to find ip of network folder 

C:\Users\AHFJF>ping f10 
Pinging f10rccnsrv01.goiba.net [10.30.20.150] with 32 bytes of data: 
Reply from 10.30.20.150: bytes=32 time=2ms TTL=127 

# Network ; troubleshooting 

Try pinging from the switch. 

Take a packet capture

```
tcpdump -n -w test1.pcap 

rsync -avzhe ssh root@192.168.0.100:/root/install.log /tmp/ 
```

# mcrouter ; switch-psr ; dealing with the watchdog reset issue

Watchdog switch-psr  mcrouter

Phoned HPE on 02079490148

HPE Support Case 5354640936 for Aruba 5406R 


switch-psr:
Chassis: 5406Rzl2 J9850A
Serial Number:   SG78GPR04M

mcrouter:
Chassis: 5406Rzl2 J9850A
Serial Number:   SG78GPR029

# Leoni 

10.3.21.71:8081 is the Leoni webpag

# Network ; Reading ; Port Patching

Please find in the mail here below my request about the cables to patch between, PPI and IBA.  

And the answer:  

IBA ports already patched as requested – 

PPI cable 1: internet GI 4/1 

PPI cable 2: internet Gi 4/3 

PPI cable 3: internet Gi 4/5 

PPI cable 4: internet Gi 4/6 

PPI cable 15: A/G/022 (IBA Customer Service 

Office) Gi1/39 

 PPI cable 16: A/G/023 (IBA Customer Service 

Office) Gi1/42 

PPI cable 17: A/G/024 (IBA Customer Service 

Office) Gi1/41 

PPI cable 18: A/G/025 (IBA Customer Service 

Office) Gi1/12 

PPI cable 19: A/G/016 (Anaesthesia room)Gi1/18 

PPI cable 20: A/G/011 (Anaesthesia room)Gi1/07 

Details for Office server: 

Please find in attachment a mail exchange of the Office wap not working. Check to be done on each one to see if they are ok. (TCR, Office, Server Room.) 

Wiring: (cfr mail in attachment) 

1 to 24: users 

37 => printer 

38 => srv iLo 

39 => srv eth1 

40 => srv eth2 

41 => srv eth3 

42 => srv eth4 

43 => WAP -- goes to s60 on patch panel 

44 => WAP -- goes to office aruba -- PPI 17 ; port A/G/024 in office 

45 => WAP -- goes to aruba in server room. 

46 => IBA-firewall (PTS firewall) 

47 => G0/0/2 (Office firewall) 

48 => G0/0/3 (office firewall) 


# Operation scenario ; Generate plans for the operation scenario

1 Install Psycopg2

To install Psycopg2 on Ubuntu, make sure you have installed libpq-dev package:

1	$ sudo apt-get install libpq-dev

Then there are two ways to install Psycopg2 for Python3 on Ubuntu: by apt or by pip.
1.1 Install Psycopg2 by apt
1	$ sudo apt-get install python3-psycopg2
Make sure add 3 suffix to python, otherwise you will install Psycopg2 for Python2 by default.
1.2 Install Psycopg2 by Python pip
First of all you need Python3 version pip:
1	$ sudo apt-get install python3-pip
This will install the Python3 version of pip command: pip3. Then you can install Psycopg2 using pip3:
1	$ sudo pip3 install Psycopg2

From <https://supportuae.wordpress.com/2020/03/27/modulenotfounderror-no-module-named-psycopg2/> 

Install pip

Tested the script that generates the plan that is needed for performing hte operational scenario . The script appears to work , in the sense that it generates the required plan ;  however when this was uploaded to adapt deliver it did not work , we were unable to get past the first stage of verifying the positions.  Cristophe thought that it was due to something that was untested in the factory enironement , namely the inclusion of adapt insight . In short, he considered that the use of adapt insight might be impacting and he needed to test this in the factory envirnomnet .  When he has done that then I can test the script once again . 

Install java jdk    (do you ned jdk to just get the jar command line program ? 

export PYTHONPATH="${PYTHONPATH}:/home/cfinch/git/opsc/opsc"

export PYTHONPATH="${PYTHONPATH}:/home/cfinch/svn/dicomlib"

sites-processConfig-SBF.110.jar# Get the hand pendant HPv3 app apk file

Get apk file from mcrs3 pts install 

scp root@mcrs3.ppi-rcctv.org:/TCS/runtimeStore/tcs/runtime/renovated/pts-pms-whp-application/runtime/release/pms-whp-application-release.apk .

# Leoni webpage 

10.3.21.71:8081

# PTS ; Install components separately 

i'm not familiar with this installing BMS separate to PTS ; normally i just install PTS ; do you have to install BMS separately to r12.2 ?

# PTS ; How to recurse through site config .properties files

Use the following snippet to recurse through .properties files in the site config 

remove whitespace at beginning of lines 

discount lines beginning with anything other than alphabetical character (primary aim was to remove comments , i.e. beginnig with a hash) 

remove blank lines 

sort them alphabetically 

then save to csv file

```bash
find . -type f -name "*.properties" -print0 | xargs -0  awk '/^[a-zA-Z]/'  | awk 'NF' | sort
```

# PTS ; How to create the folder on the desktop to the PTS tools

Right-click on desktop, 

click "Add widget", 

select "Folder", 

go to "Folder setting" to give specified path "/TCS/.../renovated/.../pts-accesspoint/runtime/.../pseduo-home/Desktop"

are you guys having to type xhost + into the terminal sometimes?

it would point to an issue with the installation of the ASK

did you do something there to resolve having to type xhost +   ?

the admin install of the ASK installs a script containing xhost + that is run on boot

cool. also, are you guys having to type xhost + into the terminal sometimes?

ok, it would point to an issue with the installation of the ASK

did you do something there to resolve having to type xhost +   ?

the admin install of the ASK installs a script containing xhost + that is run on boot

# PTS ; How to install the Access-point Software Kit (ASK) 

ASK installation is included at the end of the PTS installation (by ccadmin or tcsadmin).  

Follow this README.txt 

<environment root>/runtime/renovated/pts-accesspoint/runtime/README.txt  

<environment root> = /TCS/runtimeStore/tcs  or /TCS/runtimeStore/treatment 

# PTS ; Backup the previous installation/runtime/environment: 

For TCS environment:- 

cd /TCS/runtimeStore 

mv tcs tcs-20190307 

(mv tcs tcs-<date>) 

For Clinical environment:- 

cd /TCS/runtimeStore 

mv treatment treatment-20190415 

(mv treatment treatment-<date>) 

# PTS ; site config 

## Get the installation script/files: 

```sh
cd ~/install 
```

either 

`svn checkout http://subversion.lln.iba/repos/tc/alcyone/trunk/dev/pts/install . `

or 

`svn update`

## Run the installation script: 

`cd ~/install `

for tcs environment:- 

./install 

<component> 

<pts-version> 

<site> 

<site-version> 

<runtime-group> 

./install 

PTS 

11.0.3.2 

SBF.110 

PTS-11.0d 

tcs 

./install 

PTS 

8.2.0 

PAT.115 

PTS-8.2a 

tcs 

for clinical environment:- 

sudo –u ccadmin 

[DISPLAY=<display>:0.0] 

./install 

PTS 

<pts-version> 

<site> 

<site-version>  

<runtime-group>  

sudo –u ccadmin   

[DISPLAY=mcrw1:0.0]  

./install  

PTS 

9.4.1    

PAT.126 

PTS-9.4a 

hosp 
Notes: 

The installation script will download and use the script from the tag - if it is not already using it. ((this is confusing at the moment - what does tag mean ? the site config tag? ))  

"You are tcsadmin. Do you want to create a local config folder in /TCS/runtimeStore/tcs/workspace?" 

Say no if the tcs environment is used for formal use - e.g. validation. Or a warning message will show on AboutTCS page: “***WARNING: Using /TCS/runtimeStore/tcs/workspace/localConfig - NOT VALID for clinical or formal use ***” 

((This is confusing at the moment - on the install do you not also want to set up the workspace folder ? if not , then how is local config folder set up ? later ? perhaps to do a test ))  

./install <component> <version> <site> <site-version> <group> <user email> 

In TCS environment can test an individual PTS component: 

./install <component> <version> <site> <site-version> <group> <user email> 

To install an environment using the local subversion server, before executing the ./install command, set an environment variable: 

if using subversion server: 

export SCM_SERVER=subversion.<site domain>.org  

if using nexus server:- 

export NEXUS_SERVER=nexus.<site domain>.org 

To change the default TCS installation path (do only for tcs, not for clinical): 

Before running the installation script, set the variable INSTALL_PATH

http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-12.0-STABLE/processConfigs/src/main/resources/

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # svn checkout http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-12.0-STABLE/processConfigs/src/main/resources  .

Add that dot , to checkout the contents of resources folder and not the resources folder . 

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # ls

resources

`mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # mv resources/* .  `

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # ls

config  resources  runtime

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # rm -rf resources/

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # ls

![](files/2021-11-18-13-39-31.png)

# PTS ; Install individual PTS process 

Why? 

Can test individual processes/components before the creation of a full PTS. 

Each .jar or .car file can be obtained, and manually installed/started to perform the desired tests. 

Java:- 

Obtain the .jar file that you wish to run from the Nexus repository. 

Rename this .jar file to a unique name indicating the purpose, and place this in /TCS/runtimeStore/tcs/runtime/renovated. 

Copy the associated startup script for this process, again to a unique name indicating the purpose. 

Do not rename or edit the original script 

C++ :- 

Obtain the new bin from the Nexus repository, and place it in /TCS/runtimeStore/tcs/runtime/renovated/<process folder>/bin/. 

Add a workspace in the local classpath with at least the runtime/ folder checked out from SVN. 

Modify the file /TCS/workspace/localConfig/runtime/<site>/<room>/<process>/resources/config.properties in order to set the name of the new .bin file to the property ‘config_name’. This should be done without the .bin extension. 

For example, a test in Skandion used: config_name =GTR-DNSH-Forte-HwReno-Cbct. 

Restart the process that is meant to be tested. 

Connect to the CU and check which bin is running (ps –ef | grep bin). 

It is possible that some library files will also need to be updated under /TCS/runtimeStore/tcs/runtime/renovated/<process folder>/lib/. 

# Workspace

http://masrnd.lln.iba/r-d-department/components/tc-pts/procedures/renovated-software-howtos#section-26. 

https://wiki.iba-group.com/doku.php?id=pt:technical:pts:workspace_usage.  

# PTS ; how to start TCS and clinical environments

Through NFS, the folder /TCS on mcrs3 is shared across mcrw1, tcrw1 , ( any others?) 

Referred to as: Clinical version 

folder: /TCS/runtimeStore/treatment 

run by username: clinical 

Installed by username: ccadmin 

Purpose:  treatment, patient QA , validation tests, Acceptance tests, Commissioning tests, physics mode 

Change control:  All files below /TCS/runtimeStore/treatment are immutable , except workspace. 

Started by: standard icons and startup scripts.  

Symbolic link:   ln -s /TCS/runtimeStore/treatment /TCS/runtime  

Referred to as: tcs or test version 

folder:  /TCS/runtimeStore/tcs 

run by username: tcs  

Installed by username: tcsadmin 

Purpose:  calibration ; testing  

Started by:  standard icons and startup scripts. 

Symbolic link:   ln -s /TCS/runtimeStore/tcs /TCS/runtime  

Installation: site.properties is copied to  /TCS/runtimeStore/tcs/runtime/renovated/sites-processConfig-SBF.110.jar 

-- in tcs mode the symbolic link /TCS/runtime points to /TCS/runtimeStore/tcs/runtime  

therefore the site properties jar file is also at the following path: /TCS/runtime/renovated/sites-processConfig-SBF.110.jar 

# PTS ; Example cases of looking in logs

- What value of a propery is the PTS software using?
- Properties are printed to the log files during start up, e.g.

grep main_timer pts-poss-positioning.log 

- Is there an error transferring plan from Mosaiq to Adapt Deliver?

tail -f pts-treat-proc....log 

# PTS ; Install individual PTS process 

Why? 

Can test individual processes/components before the creation of a full PTS. 

Each .jar or .car file can be obtained, and manually installed/started to perform the desired tests. 

Java:-

Obtain the .jar file that you wish to run from the Nexus repository. 

Rename this .jar file to a unique name indicating the purpose, and place this in /TCS/runtimeStore/tcs/runtime/renovated. 

Copy the associated startup script for this process, again to a unique name indicating the purpose. 

Do not rename or edit the original script 

C++ :- 

Obtain the new bin from the Nexus repository, and place it in /TCS/runtimeStore/tcs/runtime/renovated/<process folder>/bin/. 

Add a workspace in the local classpath with at least the runtime/ folder checked out from SVN. 

Modify the file /TCS/workspace/localConfig/runtime/<site>/<room>/<process>/resources/config.properties in order to set the name of the new .bin file to the property ‘config_name’. This should be done without the .bin extension. 

For example, a test in Skandion used: config_name =GTR-DNSH-Forte-HwReno-Cbct. 

Restart the process that is meant to be tested. 

Connect to the CU and check which bin is running (ps –ef | grep bin). 

It is possible that some library files will also need to be updated under /TCS/runtimeStore/tcs/runtime/renovated/<process folder>/lib/. 


# PTS ; How to bypass checksums

Restart the bdcu with a bypass

if you are in clinical, it should be :

/TCS/runtimeStore/clinical/runtime/renovated/start_stop.sh beamCommonProcess -sss TARGET=gwserver -Dbms.cyclo.expectedFirmwareVersion=DISABLED -Dbms.cyclo.expectedSrseuChecksum=DISABLED -Dbms.cyclo.expectedConfigurationVersion=DISABLED -Dbms.cyclo.expectedConfigurationChecksum=DISABLED -Dbms.cyclo.expectedHardwareChecksum=DISABLED -Dbms.cyclo.expectedSoftwareChecksum=DISABLED -Dbms.cyclo.expectedCriticalParametersChecksum=DISABLED -Dbms.cyclo.expectedSafetyChecksum=DISABLED -Dbms.blockingSafetyParametersChecking=false -Dbms.srcu0.expectedConfigurationChecksum=DISABLED -Dbms.srcu0.expectedHardwareChecksum=DISABLED -Dbms.srcu0.expectedSafetyChecksum=DISABLED -Dbms.srcu0.expectedSoftwareChecksum=DISABLED

# PTS ; Viewing PTS configs

You can tail multiple files with multitail ; see the tldr on it. 

e.g. multitail -Q 1 "ssh cfinch@mcrs3.ppi-rccn.org"

# Idea ; Test environment

Look at doing a whole installation of the PTS system using virtualbox containers and gns3, start with using linux containers perhaps. 

https://www.nsnam.org/releases/ns-allinone-3.29.tar.bz2 

# Control units

<https://d.docs.live.net/831fac39a1cc65a9/books/IBA/MID_48462_F0_BR_Control_Unit_Startup_Guide.docx> 

mid 16534 ; srcu service.doc
mid 41237 ; A procedure to burn a Siemens MMC card.docx
mid 47485 ; version dog , pt site version.docx
48462 ; BR control unit startup guide.docx
51337 ; BR X20 CPU replacement and update procedure.doc
57603 ; ACU S2C2 startup guide.docx
58400 ; HP Z840 PPVS workstation setup 
65570 ; Historical view of CU versions ; xlsx
70035 ; Leoni CFast card copy ; docx
86092 ; version dog installation

# Control units ; MMC cards : Flashing the cards 

Obtain the cards from red pencil case in fire safe .   

Log in to ControlTools (rdp to 10.3.20.34 ; sw_engi_tools)

Open VersionDog

Check out what is needed, accept the default path 

Open Simatic manager 

Turn on the seh utn monitor - on top of network cabinet in PSR. 

Open SEH UTN manager, icon is on the desktop

Put the card in Siemens prommer  

Simatic manager

delete what's on card,

copy across all blocks from the thing downloaded

Go to Srcu cabinet

Stop then turn off using f1 1, 24v to Srcu. This puts in hookup, power maintain mode 

# Control Units ; Updating the modules in Automation Studio

For CGCU 

Archive

According to the table here , Automation runtime version B4.26 is required. Mid 65570

Also , in Mid 48462: 

This asks for AS v 4.6  for CGCU B. 

But this seems to be a contradiction to the table shown above in 65570 , which ststaes that automation studio version 4.2.12 is required for CGCU B. 

Then moving on to the Visual component . 

This is required to be v4.26.5 ;  however it is not available , again:

Perhaps it is because it is already installed ?  But where can i find what is already installed ? 

e.g.

C:\VDog\PT_Sites\SBF.110 - Newcastle\CGCU\BR\Physical\CGCU_SL8001\Hardware.hw (Module: SEW_Controller) : Error 6854: Version 4.0 of frozen hardware module SEW_Controller not found.

![](files/2021-11-18-16-27-26.png)

![](files/2021-11-18-16-27-33.png)

![](files/2021-11-18-16-27-39.png)

![](files/2021-11-18-16-27-43.png)

![](files/2021-11-18-16-27-47.png)

# Control units ; Fixing an issue with the Siemens Prommer

```
#Prommer
$foo = Read-User('Is a Siemens USB Prommer available ? [Y/N]')
If ($foo -eq 'Y') {
Write-User 'Please connect the prommer now.'
$foo = Read-User 'Press enter when done'
Write-User "Change the 'Memore Card Parameter Assignment' to 'External prommer' then press 'OK'"
$foo = Read-User 'Press enter when ready'
Write-User "Starting 'C:\Windows\SysWOW64\S7epaesx.exe -App=STEP7'" 'DarkGray'
& C:\Windows\SysWOW64\S7epaesx.exe -App=STEP7
$foo = Read-User 'Press enter when done'
}
```

# Control units ; Editing the Config.txt file

Examples of the content of this config.txt file which gets copied to B&R cards; 

Bomarsund:

10.3.21.101,10.3.21.1,255.255.255.0,CNSH-CTRL1,1,PPI-RCCN,llndomgc1,goiba.net,10.3.20.13,130,1

10.3.21.75,10.3.21.1,255.255.255.0,wmebcu1,1,PPI-RCCN,llndomgc1,goiba.net,10.3.20.13,130,1,

10.3.21.75,10.3.21.1,255.255.255.0,xcu-1,1,SBF-110,mcrs3,ppi-rccn.org,10.3.20.13,130,1,

Reading: 

10.3.51.101,10.3.51.1,255.255.255.0,CNSH-CTRL1,1,SBF.115,mcrs3,ppi-rcctv.org,10.3.50.13,130,1

# Control units ; Buying the CU cards

https://uk.rs-online.com/web/p/plc-accessories/1769803/

https://uk.rs-online.com/web/p/compact-flash-cards/7582613/

https://uk.rs-online.com/web/p/compact-flash-cards/1249677/

Leoni ACU card; SAP part number: P4007995

Leoni MCU card; SAP part number: P4008903  

USB CFAST reader

https://uk.rs-online.com/web/p/compact-flash-cards/1249674/

https://uk.rs-online.com/web/p/sd-cards/1448084/


# Control units ; PLC battery warning light is on

what to do on site if see the battery red light is on?  

it will mean it will not work ? 

it will still work , but alert the site. 

## Example: ACU code update

- Open TIA Portal 
- Shutdown the power of the ACU (SIEMENS – SIMATIC S7_1500) 
- Remove the memory card 
- Select the main trunk of the ACU code 
- ![GetImage _1_.jpeg](../_resources/6335aec5ca3a4213aca864a5666bae3d.jpeg)
- Click on “Project” tab and then “Write to memory card” 
- Select the card slot from the card reader then click “Load” 
- ![GetImage _2_.jpeg](../_resources/db25bebabb45469e9af388429f225e70.jpeg)
- This operation can take several minutes 
- Insert the memory card 
- Power on the ACU 
- Check the switch positon on the ACU, switch on RUN position  

## Leoni ACU issue

Original image of the ACU available on the network and the G4L tool. 

Follow the Leoni procedure (see details in section below).

The ACU image used was a generic one, working for every site

So edit the configuration files ; enter the network configuration of the site.

Test:  do you have communication with Leoni and with Leoni webpage? 

# Change CU cards

```json
CU: SRCU
Type: Siemens MMC
Version: SRCU-A3.1
Software used: TiA
Card reader: Siemens Prommer
Card size: 2MB

CU: BLCU
Type: Siemens MMC
Version: BLCU-A4.0
Software used: Simatic S7
Card reader: Siemens Prommer
Card size: 4MB

CU: ACU
Type: SD card SMC
Version: ACU-C3.5a
Software used: TiA
Card reader: Normal card reader
Card size: 24MB

CU: CBCTCNSHCU
Type: Compact flash
Version: CNSHCU5.0
Software used: Automation Studio 4.2
Card reader: Normal card reader
Card size: 512MB

CU: CGCU	
Type: Compact flash 	
Version:
Software used: Automation Studio 4.2
Card reader: Normal card reader
Card size: 512MB

CU: WMEBCU
Type: Compact flash
Version: CNSHCU5.0
Software used: Automation Studio 4.2
Card reader: Normal card reader
Card size: 512MB

CU: XCU
Type: Compact flash
Version: XCU-A3.1
Software used: Automation Studio 4.2
Card reader: Normal card reader
Card size: 512MB

CU: Leoni ACU
Type: CFast L   (what does this L  mean? )
Version: 
Software used: 
Card reader: Normal card reader
Card size: 

CU: Leoni MCU
Type: CFast
Version: 
Software used: 
Card reader: Normal card reader
Card size: 

Site: F10
PLC model: X20SL80xx
CUs with this model: CBCTCNSHCU; CGCU
How to operate: manual

Site: F10
PLC model: X20SL81xx
CUs with this model: XCU, WMEBCU
How to operate: manual or remote
```

# Pridex ; Opening a route from pridex to nagios

A route through to mcrs3 ?

traceroute --tcp --port 2049 mcrs3.ppi-rccn.org

Edit the access control lists in mcrouter. 

# Pridex ; Validating pridex installation 

(base) ➜  pridex-deploy-validation git:(master) git remote get-url origin

git@gitlab.sw.goiba.net:pridex-public/pridex-deploy-validation.git# CUPS

The cups server on mcrs3 

is set up fine -- 

i can print from the admin web page to the printer -- but 

when pressing the 'print' button on the 'ABout TCS' process 

it shows 'bad command /usr/bin/lpr 

so can't print from mcrw1 -- even though have set it up through yast2 to be using the mcrs3 printer server 

and the connection is fine 

-- so i went on to google and it seems the fix may be to upgrade the cups server to latest version  

but when i do the apt search command for the server it only shows the older versions -- 

so perhaps i need to update the apt repositories on mcrs3  

-- are we allowed to do that  ? 

any of that make sense ? 

yes  

what version of SLES? (cat /etc/SuSE-release)  

SUSE Linux Enterprise Server 11 (x86_64) 

VERSION = 11 

PATCHLEVEL = 3  

it's fine, but the "printing" repository used at caen for the same version is no longer available..  

it looks like you need cups-client: 

mcrs3:~ # rpm -qf /usr/bin/lpr 

cups-client-1.3.9-8.46.56.1 

and it should be in an existing repository, SLES11-SP3-Updates  

what does "zypper search cups-client" return?  

on mcrs3? 

yes  

no  

hold on  

on mcrw1  

cfinch@mcrs3:/tcs_usr/cfinch $ zypper search cups-client 

Warning: Authentication required to access https://nu.novell.com/repo/$RCE/SLE11-SDK-SP3-Pool/sle-11-x86_64?credentials=NCCcredentials. You need to be root to be able to read the credentials from /etc/zypp/credentials.d/NCCcredentials. 

Authentication required for 'https://nu.novell.com/repo/$RCE/SLE11-SDK-SP3-Pool/sle-11-x86_64?credentials=NCCcredentials' 

User Name:  

as root?  

sorry as root : 

Refreshing service 'nu_novell_com'. 

Loading repository data... 

Reading installed packages... 

i | cups-client | CUPS Client Programs | package  

mcrw1 coming up 

cfinch@mcrw1:/tcs_usr/cfinch $ zypper search cups-client 

Loading repository data... 

Reading installed packages... 

i | cups-client | CUPS Client Programs | package  

same on mcrw1 

it is installed 

and on mcrw1, "which lpr" ?  

/usr/bin/lpr 

any reason not to open your firewall?  

no  

opening now 

open now 

mcrw1:~ # lpstat -d 

no system default destination 

mcrw1:~ # lpstat -a 

lpstat: No destinations added. 

mcrw1:~ #  

see MID 5951 section 36.4.7  

sorry just adding the mcrs3 print server again -- i temporarily added the printer as a local tcp printer to test it 

ok  

let me know when you have it reconfigured  

ok configured now 

9F57BD2F.PNG 

when try to print a test page from mcrw1 it failes  

yes, i just got the same  

lpstat -d 

https://github.com/apple/cups/issues/5211  

not even sure if that is entirely relevant -- 

it's a long read also (:| 

mcrw1:~ # tail -n 2 /var/log/cups/error_log  

E [22/May/2019:21:44:32 +0100] Unable to open listen socket for address [v1.::1]:631 - Cannot assign requested address. 

E [22/May/2019:21:45:06 +0100] Unable to open listen socket for address [v1.::1]:631 - Cannot assign requested address. 

mcrw1:~ #   

in mcrs3:/etc/cups/cupsd.conf: 

Only listen for connections from the local machine. 

Listen localhost:631 

Listen 10.3.50.13:631 

Listen /var/run/cups/cups.sock 

maybe that's not a problem..  

hm , yep , the <Location /> tag has allow from *.ppi-rcctv.org 

<Location /> 

Order Deny,Allow 

Deny From All 

Allow From 127.0.0.1 

Allow From 127.0.0.2 

Allow From *.wpe.org 

</Location> 

5951 has Order Deny,Allow  whereas  this one has Order allow,deny   

then Deny from all is missing from ours -- 

surely that wouldn't matter 

the cups server on mcrs3 

when pressing the 'print' button on the 'ABout TCS' process 

it shows 'bad command /usr/bin/lpr 

so can't print from mcrw1 -- even though have set it up through yast2 to be using the mcrs3 printer server 

it looks like you need cups-client: 

mcrs3:~ # rpm -qf /usr/bin/lpr 

cups-client-1.3.9-8.46.56.1 

and it should be in an existing repository, SLES11-SP3-Updates  

cfinch@mcrw1:/tcs_usr/cfinch $ zypper search cups-client 

Loading repository data... 

Reading installed packages... 

i | cups-client | CUPS Client Programs | package  

same on mcrw1 

it is installed 
  
and on mcrw1, "which lpr" ?  
  
/usr/bin/lpr 

mcrw1:~ # lpstat -d 

no system default destination 

mcrw1:~ # lpstat -a 

lpstat: No destinations added. 

mcrw1:~ #  

see MID 5951 section 36.4.7  
  
lpstat -d 

mcrw1:~ # tail -n 2 /var/log/cups/error_log  

E [22/May/2019:21:44:32 +0100] Unable to open listen socket for address [v1.::1]:631 - Cannot assign requested address. 

E [22/May/2019:21:45:06 +0100] Unable to open listen socket for address [v1.::1]:631 - Cannot assign requested address. 

in mcrs3:/etc/cups/cupsd.conf: 

 Only listen for connections from the local machine. 

Listen localhost:631 

Listen 10.3.50.13:631 

Listen /var/run/cups/cups.sock 

<Location /> 

Order Deny,Allow 

Deny From All 

Allow From 127.0.0.1 

Allow From 127.0.0.2 

Allow From *.wpe.org 

</Location> 
interface <NETWORK>
static ip_address=<STATICIP>/24
static routers=<ROUTERIP>
static domain_name_servers=<DNSIP>

# PTS ; install BMS separately 

i'm not familiar with this installing BMS separate to PTS ; normally i just install PTS ; do you have to install BMS separately to r12.2 ?

# Linux ; commands

du -m /database/pgsql/data/base/97926/* |sort -rn |head -10

nfsstat -m

nfsstat -rc

iostat -k -h -n 5

rpcinfo -p mcbackup

ps -eaf |grep nfs

ps -eo pcpu,pid,user,args |sort -k 1 -r |head -10

which sar

grep -i snapshot /etc/ibatab

as tcsadmin user : 

cp -r runtime/LookupStore/stability ../../tcs_pts12.2_12thFeb2022/workspace/runtime/LookupStore/

# Linux ; updating the OS ; before updating OS , make a rear backup

Crontab on nagios 

Is it set up for the rear backup ?  

[PSD-1882](https://prodg.jira.goiba.net/browse/PSD-1882) 

backupj remote_rear script 

From <https://teams.microsoft.com/multi-window/?agent=electron&version=21071502213> 


# Remote desktop ; dealing wiht the license issue

12 1 * * 1 /products/backupj/remote_rear > /dev/null 2>&1# Remote desktop license issue in Nice

Nice are reactivating the grace period for the remote desktop service on controlserver. They say if they don't do that then it stops working , and it causes a downtime because they can not connect to archestra and controlserver from mcrw.

However the last time it happened was April 2019, and have checked the RD License Manager and all seems ok -- it is running in per device mode (rather than per user mode) and there are 5 licenses. The site are afraid to not keep applying the workaround (deleting a registry key to reset the grace trial license) as they think the issue will return. However it could be that if we leave it then we don't see the issue arise. 

However, last night I looked on their controlserver and found a program called RD Licensigin diagnostic ; when ran that it shows there is an error ; the RD Host Server is connected to the RD license server but it says it needs credentials to connect . Looking up on internet , it seems that you need to provide the computer's Administrator credentials , and not just a user which has administrator rights. But it will not accept the credentials even though i have logged in to the OS with them and therefore know they are right. 

However, when i connect direct to the RD license manager I am able to and the licenses are installed there fine. So possibly the fault lies with the RD host server - it is unable to connect to the license server in order to do the brokering. 

So two ways to proceed:

1) Go ahead with the registry workaround to buy some time to be able to resolve this issue found by the RD Licensing Diagnoser. 

2) The issue found with the RD licensing diagnoser may not be a factor in the issue that the site found. Therefore allow the trial period to expire and see if the issue (that was last seen in 2019) is still present.

Click on provide credentials

Entering the Administrator credentials here however does not work - the dialogue just keeps returning

However can directly connect to RD Licensing manager and all seems ok

Could also try reactivating the server:

# SUSE ; update the registration key

Get key from email:

- Nice key: C91941EE2C80A9D9

Log in to:

- [x] mcrs3
- [ ] datarec
- [ ] mcbackup
- [ ] gwserver.

Find out version of SLES: 
`lsb_release -a`

If version >= SLES 12:
` # SUSEConnect -r ’C91941EE2C80A9D9’ -e ’philippe.andersson@iba-group.com’ `

If Version < SLES 12:
`# suse_register -n -a email=’philippe.andersson@iba-group.com’ -a regcode-sles=’C91941EE2C80A9D9’ `

Bomarsund code : FBEAE04F71089D22

Email pan to let know when servers are re-registered. He needs to update the IRM DB.

Note:

Each 3 years, Suse will email a new registration key. 

The registration runs out every 3 years and it is needed to access the update repository.

ref: mid 5951 chapter 22.2.3.1

If it goes wrong:

The email address has to be that of a registered Novell account 

(the one linked with the purchase, most likely), 

and the registration code is the one delivered to you by Novell upon purchase of the renewal.

Not needed if you’re already at SP1 or above.

See: http://www.novell.com/support/kb/doc.php?id=7010008

If this simple command doesn’t work (because it hangs forever, for instance), first run it again with the -d 2 parameter added (for extended debugging output). 

It the problem comes from CURL timing out, this can be a temporary issue with the Novell servers (it happens from time to time). 

In this case, just try again later.

In all other cases, please follow the recovery procedure below (provided by Novell tech. support9 ):

• Identify the configuration entry for nu.novell.com:

`# rug sl`

number | Status | Type | Name
 | URI
--+---------+------+-------------------------------------+----------------------
1 | Pending | ZYPP | SUSE Linux Enterprise Server 10 SP1 |
2 | Pending | NU
 | https://nu.novell.com
 | https://nu.novell.com
If rug doesn’t reply, kill zmd and restart it (see the “Stop and restart ZMD
daemon” steps below).
• Remove nu.novell.com from your current configuration (that’s item #2
in the ouput above):

`# rug sd 2`
• Stop the ZMD daemon (if it fails to stop, zap it with kill -9):
`# rczmd stop`
• Delete /etc/zmd/secret and /etc/zmd/deviceid.
• Restart the ZMD daemon:
`# rczmd start`
• Delete the suse register cache:
`# rm /var/cache/SuseRegister/lastzmdconfig.cache`
• Run suse register (replace parameters with suitable values, as explained
above):
`# suse_register -n -a email=’<email>’ -a regcode-sles=’<activation_code>’`
• Check again with rug sl. The “NU” entry line should have status =
Active.

# SCCHDRVM ; install

First check that it has not already been done by logging on the vcenter webadmin and seeing if SCCHDRVM is already there.

Log in to Historian on site .

Download the ControlVMs GitLab project (https://gitlab.sw.goiba.net/pdg/controlvms) 

Uncompress the zip file on the site's Historian in D:\Data\Temp

Via the vCenter, clone the actual Historian VM

Name it SCCHDRVM

Destination compute source: cnode3

Select datastore in which to store the configuration and disk files:  VM_FS 2  (3PAR-VMFS02)

Do not turn on after cloning

Once done, edit the settings of the VM and untick the "connect" box of the ethernet card

Turn on the machine

Via the console, log in as 'Administrator' with the root password or, if it does not work, default password

Execute 'D:\Data\Temp\RunSetEnv.bat' . comment from Fred:  it should be moved directly under c:/

Right click on 'D:\Data\Temp\SetEnvControl.ps1' then choose "Run with powershell"

Follow the instructions, the machine will reboot at the end

Still via the console, replace the host file (C:\Windows\System32\drivers\etc\hosts) content with the following:

localhost       historian

10.X.Y0.36     historian

10.X.Y0.36     controlserver

Contact Fred and control team about install of Galaxy ? 

How to do final test all working?

1.  Download the ControlVMs GitLab project https://gitlab.sw.goiba.net/pdg/auto-config-controlVMs  

(this link wasn't showing correctly on the site's historian browser, firefox nor ie . Therefore copied the download zip link , and pasted in to the file explorer. 

https://gitlab.sw.goiba.net/pdg/auto-config-controlVMs/-/archive/master/auto-config-controlVMs-master.zip

4. Uncompress the zip file on the site's Historian in D:\Data\Temp

5. Rename the ethernet card on Historian to "1_Default"

Control Panel\Network and Internet\Network and Sharing Center  , click on ethernet link 

4. The galaxy file should preferably be copied in advance before doing the cloning. It is in vDog

6. \\controlserver\data\temp    or  \\historian\data\temp   A2Admin_User ...

7. Via the vCenter, clone the actual Historian VM

8. name it SCCHDRVM

9. ressources from cnode3

10. storage on VM_FS 2

11. Do not turn on after cloning

12. Once done, edit the settings of the VM and untick the "connected" box and the "connect at power on" of the ethernet card

13. Turn on the machine

14. Via the console, log in as 'Administrator' with the root password or, if it does not work, default password is 'fgh'

15. Move the content of 'D:\Data\Temp\controvms' to 'C:\'

16. Execute 'C:\RunSetEnv.bat'

17. Follow the instructions, the machine will reboot at the end

18. Deploy galaxy:  This is documented in MID 66652 1.2.3/1.2.4

From <https://prodg.jira.goiba.net/browse/PSD-169> 

From <https://prodg.jira.goiba.net/browse/PSD-169> 

Update version dog 

https://iba.sharefile.com/share/view/sbca79b5f28c545fbb1a189af020b6585

![](files/2021-11-18-13-25-45.png)

![](files/2021-11-18-13-25-52.png)

![](files/2021-11-18-13-25-59.png)

![](files/2021-11-18-13-37-23.png)

# Pridex Instructions on how to integrate Nagios logs to Pridex

Install NFS service on Nagios:

On Nagios, look to see if the nfs service is already installed by going to yast and looking for it in Network Services. If not then install it using:

```bash
zypper install yast2-nfs-server
```

![Install NFS service](files/1-Nagios-NFS-Srv-Install.png "Nagios NFS service")*My caption*

Configure NFS service on Nagios:

![Configure the NFS service](files/2-Nagios-NFS-Srv-Config.png )*My caption*

Specify the directory to share on Nagios:

![NFS directory share](files/3-Nagios-NFS-Dir-Share.png )*My caption*

Configure the Access Control List on mcrouter:

Log in to mcrouter with manager@mcrouter. 

- `conf`
- `ip access-list extended "smi-in"`
- Then add the three lines to allow communication between nagios and pridex. Items 26, 27, 28 as shown in the image below.
- `write memory`
- Exit from mcrouter

![MCrouter ACL](files/4-MCRouter-ACL.png )

Create folder where nagios logs will be mounted on Pridex :

![Pridex mount](files/5-PrideX-MountPoint.png )*My caption*

Edit the /etc/fstab file on the Pridex VM :

After adding the line to /etc/fstab, save the file and then do `mount -a` to apply the specified mounts.

![Pridex fstab file](files/6-PrideX-Fstab.png )*My caption*

 Configure the filebeat container on the Pridex VM :

After adding the line to the filebeat.yml file, restart the filebeat container with `systemctl restart filebeat`

![Pridex filebeat config](files/7-PrideX-Filebeat.png )*My caption*

Check it worked:

If all is well then the site should appear on the following list:

[List of sites that are sending nagios logs to splunk](https://pridex-splunk-dev.sw.goiba.net:8000/en-US/app/pts/sysadmin__status?form.field1.earliest=%40d&form.field1.latest=now)

# PTS ; site config ; Update site configuration

svn co http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0j-RC1/processConfigs/src/main/resources/config/ . 

Make changes in workspace 

ssh cfinch@mcrs3 

su - tcs 
(password tcs) 

fd 

cd beamCommonProcess/ 

vim container.properties 

(in this example i had to change SRSEU checksum to D44C 

Checkout a copy of the stable branch and make the same changes in there 

Use tortoisesvn - right click on desktop and check out: 
http://sucellos.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-11.0-STABLE 

Make the same changes as were made to the workspace. 

update and check in. Put a good message -- possibly make a diff , tidy it and put it in. 
make a diff like: 
svn diff http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0e http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0g > diff_between_e_and_g.diff 

copy and paste it in to the commit message. This will then show up on the email message sent at the eujnd. 

Create the RC tag 

svn cp -m '[TAG] SBF.115-PTS-11.0.4-RC2' http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.115-PTS-11.0.4-validation/ http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0.4-RC2 --username cfinch 

copy the tag from RC to clinical 

svn cp -m '[TAG] SBF.110-PTS-11.0l'   http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0l-RC5 http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0l --username cfinch 

(((may need to add --username cfinch to the end of the command to make sure not doing it as bwang)))) 

Release the RC config 

ssh release@deblugh.lln.iba 
Dustin 

cd ~/target/ongoing/ 
ll 

(these last two steps will show total 0 hopefully as that will indicate no one else is currently checking anything in) 

cd ~/release 

./release-config SBF.115 PTS-11.0g-RC1 christopher.finch@iba-group.com 

exit 

./release-config SBF.115 PTS-11.0.4-RC2 christopher.finch@iba-group.com 

## Install the config to tcs environment 

Then log in to mcrs3 with cfinch   --   or try   [ ssh tcsadmin@mcrs3 ] 

Then 

su - tcsadmin 

(validation) 

cd /TCS/runtimeStore/tcs/foundation 

./install-site SBF.115 PTS-11.0.4-RC2 tcs christopher.finch@iba-group.com 

 
Create the clinical tag: 

svn cp -m '[TAG] SBF.115-PTS-11.0g'   http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.115-PTS-11-STABLE/     http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0g --username cfinch 

Release the clinical tag: 

ssh release@deblugh.lln.iba 

cd ~/target/ongoing/ 
ll 
(these last two steps will show total 0 hopefully as that will indicate no one else is currently checking anyting in) 

cd ~/release 

./release-config SBF.115 PTS-11.0g christopher.finch@iba-group.com 

Install the config to clinical environment 

Close running environment -> on mcrw1 do 'Force TCS shutdown' 

ssh cfinch@mcrs3 

cd /TCS/runtimeStore/treatment/foundation 

make sure you are logged in as cfinch here (and not root or tcsadmin or .. ) 

sudo -u ccadmin  ./install-site SBF.115  PTS-11.0g hosp  christopher.finch@iba-group.com 

## Update the bug 

on mcrs3 (or maybe use ubuntu on local laptop) 

svn diff http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0f http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0g-RC1 > diff_between_f_and_g-RC1.diff 

get file using filezilla 

comment tracking bug #103648 http://bugzilla.lln.iba/show_bug.cgi?id=103648 with the following comment template 

New tag released: 

Description:  

Link to bug describing the original problem: 

Diff: 

Bug number 97585 - update this tracking bug during the installation phase 

Bug number 103648 - update this tracking bug during the CS stage 

105609 - this is the tracking bug number for customer service of Reading for site config updates. 

## send the email 

in deblugh: 

ssh release@deblugh.lln.iba 

cd ~/release/release-extra/ 
  ./release-config-extra <Site> <Tag>  

This generates an email :- Look at the options shown for editing or sending it - i think ctrl-d is to send it . 

Lock the tag  

sudo 

–u ccadmin 

[DISPLAY=<display>:0.0] 

./install-site 

<site> 

<version> 

<group> 

| sudo | –u ccadmin | [DISPLAY=mcrw1:0.0] | ./install-site | PAT.126 | PTS-9.4y | hosp |

| sudo | -u ccadmin | [DISPLAY=mcrw1:0.0] | ./install-site | PAT.126 | PTS-9.4y | hosp |

| sudo | -u ccadmin || ./install-site | PAT.126 | PTS-9.4y | hosp |

|  |  | | ./install-site | SBF.110 | PTS-11.0d | hosp |

for Leuven , the install-site script is in tcsadmin's home folder 

Leuven bu number for tracking site config changes: 103977 

control - R  -- check it out, once connected as release user , have access to the history - so can have a look at what

Sharing the knowledge - using teamcity to release a tag seems easy 😊 . the following is from Xiongjun: 

Create first the tag using svn (this procedure hasn’t changed)  

Log on TeamCity 

Go to Tools | Release (Docker based) - http://teamcity.lln.iba/viewType.html?buildTypeId=Tools_ReleaseDockerBased_Config  

http://teamcity.sw.goiba.net/viewType.html?buildTypeId=Tools_ReleaseDockerBased_Config

On the line Release config, click on run on the top right corner  

Provide the requested parameters: Site name (e.g. SBF.112) and version (e.g.      PTS-12.0-RC40) 

![GetImage.jpeg](../_resources/e7b8d56995cc4366b70eda0a41cfd40d.jpeg)

send the email 

in deblugh: 

ssh release@deblugh.lln.iba 

cd ~/release/release-extra/ 

  ./release-config-extra <Site> <Tag>  

![](files/2021-11-18-16-00-26.png)

For sbf.112-R  

Go to the 

![](files/2021-11-18-16-00-46.png)

![](files/2021-11-18-16-00-53.png)

![](files/2021-11-18-16-00-59.png)

![](files/2021-11-18-16-01-05.png)

![](files/2021-11-18-16-01-13.png)

![](files/2021-11-18-16-01-19.png)

SBF.110	http://bugzilla.lln.iba/show_bug.cgi?id=103648	103648

How to find out what files have changed; useful if the requester just says 'I've just made the change in the workspace' 

find . -mmin -5 -type f -exec ls -l {} +

How to update workspace

How to install workspace

14 May 2021

17:14

http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-12.0-STABLE/processConfigs/src/main/resources/

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # svn checkout http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-12.0-STABLE/processConfigs/src/main/resources  .

Add that dot , to checkout the contents of resources folder and not the resources folder . 

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # ls

resources

` mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # mv resources/* .    `

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # ls

config  resources  runtime

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # rm -rf resources/

mcrs3:/TCS/runtimeStore/tcs/workspace/localConfig # ls

![](files/2021-11-18-16-01-56.png)

![](files/2021-11-18-16-02-02.png)

Update site configuration

svn co http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0j-RC1/processConfigs/src/main/resources/config/ . 

Make changes in workspace 

ssh cfinch@mcrs3 

su - tcs 

(password tcs) 

fd 

cd beamCommonProcess/ 

vim container.properties 

(in this example i had to change SRSEU checksum to D44C 

Checkout a copy of the stable branch and make the same changes in there 

Use tortoisesvn - right click on desktop and check out: 

http://sucellos.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-11.0-STABLE 

Make the same changes as were made to the workspace. 

update and check in. Put a good message -- possibly make a diff , tidy it and put it in. 

make a diff like: 

svn diff http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0e http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0g > diff_between_e_and_g.diff 

copy and paste it in to the commit message. This will then show up on the email message sent at the eujnd. 

Create the RC tag 

svn cp -m '[TAG] SBF.115-PTS-11.0.4-RC2' http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.115-PTS-11.0.4-validation/ http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0.4-RC2 --username cfinch 

copy the tag from RC to clinical 

svn cp -m '[TAG] SBF.110-PTS-11.0l'   http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0l-RC5 http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.110-PTS-11.0l --username cfinch 

(((may need to add --username cfinch to the end of the command to make sure not doing it as bwang)))) 

Release the RC config 

ssh release@deblugh.lln.iba 

Dustin 

cd ~/target/ongoing/ 

ll 

(these last two steps will show total 0 hopefully as that will indicate no one else is currently checking anything in) 

cd ~/release 

./release-config SBF.115 PTS-11.0g-RC1 christopher.finch@iba-group.com 

exit 

./release-config SBF.115 PTS-11.0.4-RC2 christopher.finch@iba-group.com 

## Install the config to tcs environment 

Then log in to mcrs3 with cfinch   --   or try   [ ssh tcsadmin@mcrs3 ] 

Then 

su - tcsadmin 

(validation) 

cd /TCS/runtimeStore/tcs/foundation 

./install-site SBF.115 PTS-11.0.4-RC2 tcs christopher.finch@iba-group.com 
 
Create the clinical tag: 

svn cp -m '[TAG] SBF.115-PTS-11.0g'   http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.115-PTS-11-STABLE/     http://subversion.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0g --username cfinch 

Release the clinical tag: 

ssh release@deblugh.lln.iba 

cd ~/target/ongoing/ 

ll 

(these last two steps will show total 0 hopefully as that will indicate no one else is currently checking anyting in) 

cd ~/release 

./release-config SBF.115 PTS-11.0g christopher.finch@iba-group.com 

Install the config to clinical environment 

Close running environment -> on mcrw1 do 'Force TCS shutdown' 

ssh cfinch@mcrs3 

cd /TCS/runtimeStore/treatment/foundation 

make sure you are logged in as cfinch here (and not root or tcsadmin or .. ) 

sudo -u ccadmin  ./install-site SBF.115  PTS-11.0g hosp  christopher.finch@iba-group.com 

## Update the bug 

on mcrs3 (or maybe use ubuntu on local laptop) 

svn diff http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0f http://sucellos.lln.iba/repos/tc/alcyone/tags/SBF.115-PTS-11.0g-RC1 > diff_between_f_and_g-RC1.diff 

get file using filezilla 

comment tracking bug #103648 http://bugzilla.lln.iba/show_bug.cgi?id=103648 with the following comment template 

New tag released: 

Description:  

Link to bug describing the original problem: 

Diff: 

Bug number 97585 - update this tracking bug during the installation phase 

Bug number 103648 - update this tracking bug during the CS stage 

105609 - this is the tracking bug number for customer service of Reading for site config updates. 

## send the email 

in deblugh: 

ssh release@deblugh.lln.iba 

cd ~/release/release-extra/ 
  ./release-config-extra <Site> <Tag>  

This generates an email :- Look at the options shown for editing or sending it - i think ctrl-d is to send it . 

Lock the tag  

sudo 

–u ccadmin 

[DISPLAY=<display>:0.0] 

./install-site 

<site> 

<version> 

<group> 

| sudo | –u ccadmin | [DISPLAY=mcrw1:0.0] | ./install-site | PAT.126 | PTS-9.4y | hosp |

| sudo | -u ccadmin | [DISPLAY=mcrw1:0.0] | ./install-site | PAT.126 | PTS-9.4y | hosp |

| sudo | -u ccadmin || ./install-site | PAT.126 | PTS-9.4y | hosp |

|  |  | | ./install-site | SBF.110 | PTS-11.0d | hosp |

for Leuven , the install-site script is in tcsadmin's home folder 

Leuven bu number for tracking site config changes: 103977 

control - R  -- check it out, once connected as release user , have access to the history - so can have a look at what

Sharing the knowledge - using teamcity to release a tag seems easy 😊 . the following is from Xiongjun: 

Create first the tag using svn (this procedure hasn’t changed)  

Log on TeamCity 

Go to project -> Tools | Release (Docker based) - http://teamcity.lln.iba/viewType.html?buildTypeId=Tools_ReleaseDockerBased_Config  

On the line Release config, click on run on the top right corner  

Provide the requested parameters: Site name (e.g. SBF.112) and version (e.g.      PTS-12.0-RC40) 

![GetImage.jpeg](../_resources/e7b8d56995cc4366b70eda0a41cfd40d.jpeg)

send the email 

in deblugh: 

ssh release@deblugh.lln.iba 

cd ~/release/release-extra/ 
  ./release-config-extra <Site> <Tag>  

Site config

# PTS ; Checksums 

Global checksum:

The ASK files have been moved to SVN repository since R8, 

and starting with R8.5.1, they also are included in a global checksum that is used to monitor any changes to the PTS and prevent its usage if necessary.  

# Pridex ; References

mid73288  

mid85246

[[Tldr-splunk]]

[[Pridex-vm-guide]]

https://iba2016.sharepoint.com/sites/PRIDEx2/SitePages/Using-Splunk.aspx

https://answers.splunk.com/answers/468768/how-to-search-for-and-display-the-count-of-events.html

# Pridex ; Fixing Pridex issues

just for info:   

a) 'iotedge list' to get list of module names ;  

b) 'iotedge logs -f --tail <module name>' to view the log for each module  

c) if one has failed then try 'iotedge restart <name of failed module>'  

d) if this hasn't worked then try restart of the pridex v

# Pridex ; Troubleshooting pridex logs not being sent 

systemctl [restart|status] [filebeat|iotedge|docker]

docker ps

iotedge list

iotedge logs -f --tail <moodule name>

iotedge restart <module name>

restart pridex vm

restart ptsarchestrabridge

Is your filebeat running? :

Filebeat forwards logs 

Check your NIFI for errors related to the logs module 

http://pridex.pvcpt.org:9090/nifi/  

http://pridex.<site-domain-name>:<port>/nifi  

config directory: 

/etc/filebeat

ps aux | grep filebeat    

ps -ef | grep filebeat

So there is a VM you can go and download and use for Filebeat ; Its in the deployment instructions ; MID 73288
  
## Post IoT deployment :

systemctl [restart|status] [filebeat|iotedge|docker]

docker ps

iotedge list

iotedge

restart pridex vm

restart ptsarchestrabridge

iotedge logs -f --tail <moodule name>

iotedge restart <module name>

traceroute --tcp --port 2049 mcrs3.ppi-rccn.org

Can i check now to see that pridex is sending logs now? is there a way? 

sourcetype="pridex_logs" host="*Bo*"  

## Pre IoT deployment
 
a. First check that the 3 processes are running:  systemctl status docker | iotedge | filebeat

b. 'iotedge list' to get list of module names ; 

c. 'iotedge logs -f --tail <module name>' to view the log for each module  

d. if one has failed then try 'iotedge restart <name of failed module>'  

e. if this hasn't worked then try restart of the pridex vm

f. Next to try is to restart the ptslogsforwarder service on controlserver

just for info:   

a) 'iotedge list' to get list of module names ;  

b) 'iotedge logs -f --tail <module name>' to view the log for each module  

c) if one has failed then try 'iotedge restart <name of failed module>'  

d) if this hasn't worked then try restart of the pridex vm

try just "ps -ef| grep filebeat" 

Do you know how to login to see your nifi? 

http://pridex.pvcpt.org:9090/nifi/  

http://pridex.<site-domain-name>:<port>/nifi  


## Examples 

In Leuven it was fixed by restarting Cogent bridge service on historian. 

In Bomarsund it was fixed by 

a) installing the license (downloaded from VersionDog) 

b) updating the subscribed signals using the csv file (where to get this csv file ?  - look at the metadoc for deployment of cogent ) 

c) The Pridex team restarting something on their side to enable the iot modules to send the data to the splunk indexing server. 

Please take some screenshots of the various Cogent bridge components

mention where they're running.

Then add some steps for troubleshooting in case of issues.

https://prodg.jira.goiba.net/browse/PSD-1581

Based on the Leuven experience we need a troubleshooting guide for the Cogent bridge. 

Please take some screenshots of the various Cogent bridge components

mention where they're running.

Then add some steps for troubleshooting in case of issues.

see references folder

ECR ; 112711

mid ; 87123 ; cogent archestra OPC bridge setup guide ; docx

mid ; 88638 ; cogent archestra opc bridge TPO ; docx# References

Useful documents:

MID16534 Vade Mecum of the SRCU servicemen

MID41237 Procedure to burn a Siemens MMC card

# SRCU ; Put SRCU in power maintain

mid67204

mid70677

mid16534

# SRCU ; How to start the SRCU with a new program stored on a memory card

Switch the PLC PSU off.

Eject any memory card present in the CPU.

Insert the memory card with the new program.

Wait a few minutes for the buffering capacitors of the PSU to be dicharged.

Switch the PLC PSU on.

Wait for the STOP indicator to stop blinking on the CPU. If it does not stop blinking, proceed as in Recovering from a false startup.

Perform a memory reset. Proceed as in How to perform a memory reset.

Wait for the RUN indicator to stop blinking on the CPU.

If no red or orange indicator is lit, the PLC is operational.

![](files/2021-11-19-13-46-51.png)

![](files/2021-11-19-13-46-58.png)

![](files/2021-11-19-13-47-06.png)

Warning – risk of quench, best practice is to ramp down to 300A before starting this task to limit the recovery time of a quench.

Turn the Maintain PTS power delivery key

Ensure after the key is turned the red light is lit on top of the cabinet (if not the system will quench when the PLC is turned off). Appearance may vary between SRCU cabinet versions.

Open the cabinet and turn off the number 1 on F1, it will turn from green to amber

Figure 1- Cabinet at SBF.110 & SBF.115 (note that the green lights are buttons too)

Figure 2 - Cabinet at SBF.109
 
The card to upload should arrive like this

Remove the card from the PLC and insert the new one
 
Push the lever on the SRCU down to stop

Turn number 1 on F1 on, it will turn from amber to green
 
To install the software the following must be done in order. 

1. Push the lever down and hold on the mres until it stops flashing (flashes twice)

2. Go back to stop

3. Push the lever down and hold on mres, it will flash really fast then slow down and flash another two times. Then it will remain steady

4. Go back to stop

5. Then push the lever up to run
 
The PLC and all the relevant DO will eventually go green

From <https://iba2016.sharepoint.com/sites/SBF.110-Bomarsund/Shared%20Documents/General/SRCU%20SD%20card%20change.docx> 

![](files/2021-11-18-13-11-30.png)

![](files/2021-11-18-13-11-38.png)

![](files/2021-11-18-13-11-45.png)

![](files/2021-11-18-13-12-39.png)

![](files/2021-11-18-13-12-53.png)

![](files/2021-11-18-13-13-02.png)

![](files/2021-11-18-13-13-17.png)

![](files/2021-11-18-13-13-30.png)

![](files/2021-11-18-13-13-38.png)

Ensure after the key is turned the red light is lit on top of the cabinet (if not the system will quench when the PLC is turned off). Appearance may vary between SRCU cabinet versions.

Open the cabinet and turn off the number 1 on F1, it will turn from green to amber

Figure 1- Cabinet at SBF.110 & SBF.115 (note that the green lights are buttons too)

Figure 2 - Cabinet at SBF.109
 
The card to upload should arrive like this

Remove the card from the PLC and insert the new one
 
Push the lever on the SRCU down to stop

Turn number 1 on F1 on, it will turn from amber to green

DO NOT press the “Release PTS power delivery” button until a search of all areas has been successful to ensure the code is running, and Archestra has been checked for any concerns.

# ssh

you wanna log in as cfinch?

here is cfinch public key

if you can show you have corresponding private key then i'll will let you in .

ssh client:

ssh cfinch@..

ssh-client message to ssh_agent: get me the private key 

ssh-agent :  retrieves the private key (from a db) 

ssh-agent to ssh_agent: here you are!

hackertarget.com/ssh-examples-tunnels

1. Proxy traffic over SSH using SOCKS

2. ssh tunnel (port-forward)

3. ssh tunnel forward to secondary remote host

4. ssh reverse tunnel

5. ssh reverse proxy

6. establish vpn over ssh

7. copy ssh key ssh-copy-id

8. run command remotely (non-interactive)

9. Remote packet capture and view in wireshark

10. ssh copy folder from local to remote ; copy remote folder to local tar archive

11. remote GUI applications with ssh x11 forwarding

12. copy files remotely with rsync and ssh

13. ssh over Tor network

14. ssh to ec2 instance

15. edit text files with VIM over ssh/scp

16. mount remote ssh location as local folder with sshfs

17. ssh multiplex using controlpath

18. streamvideo over ssh using vlc + sftp

19. two factor authentication 

20. bouncing through jump hosts with ssh and -J

21. block brute force attempts with iptables

22. modify port forwarding within a session with ~C


ssh-copy-id -i ./authorized_keys root@nagios.ppi-rccn.org

hi Jonathan, do you know about the ssh-copy-id command? :   ssh-copy-id -i ./authorized_keys root@nagios.ppi-rccn.org

Ssh sync

We still receive some sync errors from gwserver and mcbackup to nagios

We are working on a new solution for ssh key deployment and synchronization.
This would allow automatic update of ssh keys twice a day (at the moment it has to be done manually and can take months before up
date..).

https://prodg.jira.goiba.net/browse/PSD-299

https://prodg.jira.goiba.net/browse/PSD-994  

How to deploy the SSH key synchronization

This project aims to simplify the deployment of changes to local accounts and authorized key files on PT sites.

From <https://prodg.jira.goiba.net/browse/PSD-299> 

# Synergy ; Install 

- install synergy on vrxt{1|2|3}, tcrw1, mcrw1

startsynergy.sh 

Contents of /tcs_usr/clinical/.config/autostart-scripts/startsynergy.sh 

```
#!/bin/sh 
MACHINE=`uname -n` 
if [$MACHINE = tcrw1 ]; then 
  killall synergys 
  killall synergyc 
  sleep 1 
  synergys -c "/tcs_usr/clinical/synergyTCRW.conf" 
```

- prepare synergy\<hostname>.conf 

- Contents of /tcs_usr/clinical/.config/autostart-scripts/synergy\<hostname>.conf

- <see left, right etc stuff> 

# Disk space ; extend a logical volume 

Get info about the physical volumes, volume groups and logical volumes: 

pvs 

vgs 

lvs 

vgdisplay 

Find out the name of the logical volume to increase then: 

lvextend -L +2G /dev/vg00/lvol6 
 
doesn't work: 

resize2fs /dev/vg00/lvol6 

doesn't work: 

xfs_growfs /dev/vg00/lvol6 

Works! 

resize_reiserfs /dev/vg00/lvol6 

## Decrypt the password.txt file

gpg --decrypt -o /home/cfinch/svn/sysadmin/docs/config/trunk/root_passwords.txt /home/cfinch/svn/sysadmin/docs/config/trunk/root_passwords.txt.gpg

## Edit the password.txt file

Re-encrypt the file:

In here , you will find the script encrypt_root

/home/cfinch/svn/sysadmin/docs/config/trunk

Delete the old encrypted file

## Set up gpg for editing the password.txt file

Import everyones public keys so can encrypt the file with everyone's key

here:

/home/cfinch/svn/sysadmin/docs/config/trunk/GPG_pub_keys

`gpg --import ./*.txt`

![](2022-01-20-10-09-33.png)

![](2022-01-20-10-10-35.png)


# Archiving ; LUTs

Bug 106792, which contains the crontab entry I have used to implement the archiving

basically the treatment process parses every LUT that was ever created, which slows down comms with mosaiq, which eventually hits a timeout

where does the cron job run ? tcrw1?

mcrs3, clinical user

will prob need to implement it for the TCS users LUT's at some point, but not an issue here yet

To my knowledge there are no son bugs for the sites (an issue I have raised)

so bug 105235 was Royal Oaks original bug

we have slow communication with Mq
 
may have a positive effect on that 

theres is also a bug open for it to be implemented within the software

F09 is receiving 'ois polling error' errors ; 

What i did :

Cd /TCS/runtimeStore/tcs/workspace/runtime/LookupStore 

Cd ./stability

tar cvfz ../Archive/archive_of_stability_folder1.tar.gz .

Cd ./stability_compensation

tar cvfz ../Archive/archive_of_stability_compensation_folder1.tar.gz .

This archived the files to the Archive folder  (tar and zipped)

At the bottom of the bug:

![](files/2021-11-18-13-24-14.png)

Then at bottom of bug 106998

![](files/2021-11-18-13-24-25.png)


The treatment process reads the lookup tables (LUTs) ; this can slow down communication between adapt deliver and Mosaiq; This can cause a timeout.

Archive the lookup tables:

Set up a cron job on mcrs3; clinical user

Bug 106792 ;  contains the crontab entry used to implement the archiving

Archive 

Bug 105235 ; was Royal Oaks original bug

Will prob need to implement it for the TCS users LUT's at some point, but not an issue here yet

# Disk space ; extend a logical volume

Extend a logical volume:

Get info about the physical volumes, volume groups and logical volumes:

pvs

vgs

lvs

vgdisplay

Find out the name of the logical volume to increase then:

lvextend -L +2G /dev/vg00/lvol6

doesn't work:

resize2fs /dev/vg00/lvol6

doesn't work:

xfs_growfs /dev/vg00/lvol6

Works!

resize_reiserfs /dev/vg00/lvol6

# nfs ; set it up 

$ exportfs -ra

From <https://unix.stackexchange.com/questions/116971/nfs-server-changes-in-etc-exports-file-need-service-restart> 

newusers

or is it possible to specify new users in /etc/passwd from git 

# RAID ; show status

On a system with RAID e.g. mcrw or tcrw:

during start up press ctrl-p 


# Sysadmin ; power cycle servers

Current plan : -  

Switch on 3par  -- SITE TEAM required

Wait a few minutes , then ssh to t12-3par.ptccdh.org  (e.g. from nagios)

'showvv'   ,  should show that all logical volumes are 'normal' ; if so then 'exit'

may need to reset the cnodes at this point ; or/and take them out of maintenance mode; can use spcnode0# web admin 

then log in to cnode02  (can go via web page)

start / power up vcenter

log in to vcenter using web admin 

startup / power on the VMs in the following order :
 
mcrs3 (wait for it to finish booting before proceeding to the next one – open remote console to check)

datarec (wait for it to finish booting)

controlserver

replication

vma

vsp-3par

mcrs4, subversion, nexus, ssmc, historian (any order for these)

[Shutting down and restarting the infrastructure](../Work/Shutting%20down%20and%20restarting%20the%20infrastructure.md)

References : 

look at section 4.5 and 4.6 of the Unix system administration metadoc. 


# trxt12 ; Update sudo for Raspbian Jessie

sudoedit -s '\' `perl -e 'print "A" x 65536'`

From <http://bugzilla.lln.iba/show_bug.cgi?id=118090> 

Follow this 
https://www.thesecmaster.com/fix-the-new-sudo-vulnerability-cve-2021-3156/
Then make the newly installed sudo the one used ; by linking to it from ~/bin

pi@trxt12:~ $ vi ./.bashrc
pi@trxt12:~ $ vi ./.profile
pi@trxt12:~ $ ls
Desktop    Downloads  edid.txt                                     Music         Pictures  python_games  sudo-1.9.5p2.tar.gz  Videos         wallpaperO.sh
Documents  edid.dat   freexian-archive-keyring_2020.09.19_all.deb  oldconffiles  Public    sudo-1.9.5p2  Templates            wallpaperG.sh
pi@trxt12:~ $ mkdir bin
pi@trxt12:~ $ cd bin
pi@trxt12:~/bin $ ln -s /usr/local/bin/sudo ./sudo
pi@trxt12:~/bin $ ls
sudo
pi@trxt12:~/bin $ ls -lahtr
total 8.0K
drwxr-xr-x 23 pi pi 4.0K Sep  8 10:01 ..
lrwxrwxrwx  1 pi pi   19 Sep  8 10:02 sudo -> /usr/local/bin/sudo
drwxr-xr-x  2 pi pi 4.0K Sep  8 10:02 .
pi@trxt12:~/bin $ which sudo
/usr/local/bin/sudo
pi@trxt12:~/bin $ source ~/.profile
pi@trxt12:~/bin $ source ~/.bashrc
pi@trxt12:~/bin $ which sudo
/home/pi/bin/sudo
pi@trxt12:~/bin $ sudo --version
Sudo version 1.9.5p2
Sudoers policy plugin version 1.9.5p2
Sudoers file grammar version 48
Sudoers I/O plugin version 1.9.5p2
Sudoers audit plugin version 1.9.5p2

# Shutting down and restarting the infrastructure

References: look at section 4.5 and 4.6 of the Unix system administration metadoc. 

gt 

Close running applications, log out , shutdown:  

TCR: mcrw1, adapt insight 

TR: Raspberry pi Status monitor  

MCR: mcrw1; raspberry pi mcr-pi 

Set 3PAR to maintenance mode: 

Why?  

When the infrastructure is down, the VSP-3PAR stops sending monitoring data to HP.  

HP customer support interpret this as a failure of the 3PAR, create a support ticket and then call to inquire.  

This can be avoided by putting 3PAR to maintenance mode before the shut down. 

How? 

Open the VSP-3PAR Home Page https://f10-vsp.ppi-rccn.org 

Username: 3parcust  

Pwd: 3parInServ 

Select Support in the left-side menu. The current status of the maintenance mode is displayed there. It should be \OFF" 

Select SPmaint in the left-side menu. 

Select 3. InServ Conguration Management in the right-side menu (or 3. StoreServ Conguration Management, depending on the version of the SPOCC) 

Click the Modify button 

Set maintenance mode radio button to \ON"  

Click Update button to apply 

When prompted, set (select) the planned duration for the downtime (there is no way to set the 3PAR in maintenance mode forever) and apply 

Select Support in the left-side menu again. The current status of the maintenance mode should now be \ON" 

Notes: Maintenance mode does not hinder the regular operation of the SAN. Also, when the set duration for maintenance mode expires, the device should leave maintenance mode automatically. 

HP may call even after doing this but will be able to say that have done the correct procedure if they call.  

Who?  

SMI virtual machines (only if have smi-phy server (Proxmox server ?)) 

How?  

Open web page: smi-phy.ppi-rccn.org 

Login: 

Username: root 

Pwd: old Newcastle password 

Shutdown virtual machines: 

smis 

splunk 

Shutdown what? 

smi-p 

Shutdown how?  

ssh to smi-phy iLO board: 

ssh root@spsmi-phy 

old password 

Type 'VSP' to enter the virtual serial console 

login as 'root' 

type "shutdown -h now" 

wait for the server to turn off 

type 'Esc-(' to leave the console and return to the iLO prompt 

type 'exit' to close the iLO session 

Postfix

rcpostfix restart 

As of February 2016, the management of remote login by system administrators is defined by PRS-71298.

Direct root login is not permitted with password authentication, it is however possible to authenticate using a personal SSH key pair.
Logging-in via SSH key authentication is an alternative to using your personal account and becoming root.
![](files/2021-11-22-09-55-44.png)

![](files/2021-11-22-09-55-57.png)


# Troubleshooting ; finding info

Bugzilla search 
http://bugzilla.lln.iba/query.cgi

Metadoc search 
https://metadoc.goiba.net/metapro/powersearch.php

Smartsheets search 
[[to do  where is smartsheets ; how do i get access  ]]

Files:
use x1 search 
to search : 
onedrive
network drives
and local drives

Teams chats

Emails 
(can I find or retrieve the emails , a pst file or ost file ? , from old work?) - and then put this in to x1 indexing


If it is a software issue , such as bcp crashing:
Service max cases
Logs
Search the source code (download from svn) 
Pridex

# trxt12 ; raspberry pi 

\\llnfs03\departments\ESD\All\ProDG\Standardisation  

  get the trxt12 image and give it to Ryan ;  copy it to f09's office server; find the ip of the office server , may need to get in to the site to be able to ping the office server ;  or aperhaps not , look at the hosts file and find the office server .. 

dd bs=4M if=/dev/ of=nice-rpi-trxt12.img count=


# nix

/nix/var/nix/profiles/per_user/cfinch/profile

is pointed to by ~/.nix-profile

~/.nix-channel points to :
https://github.com/rycee/home-manager/archive/master.tar.gz home-manager
https:/nixos.org/channels/nixpgs-uupdate [nixpgs]

~/.nix-defexpr/channels pionts to 
/nix/var/nix/profiles/per-user/cfinch/channels --partial

channels_root are in /root/channels

types of terminal:
terminal primary
script
terminal secondary


# Backup ; use rsync

Don't change file on target
if target date > source date

```
#!/bin/bash
yes| cp ~/backup/time.txt ~/backup/time2.txt
echo `date +"%F-%I%p"` > ~/backup/time.txt
echo "" > ~/backup/rsync-`date+"%F-%I%p"`.log
rsync -avzhPR --chmod=Du=rwx,Dgo=rx,Fu=rw,Fgo=r --delete --stats --log-file=~/~/backup/~/backup/rsync-`date+"%F-%I%p"`.log exclude-from '~/exclude.txt' --link-dest=/home/backups/`cat ~/backup/time2.txt` -e 'ssh -p 12345' /home/cfinch/backups/`cat ~/backups/time.txt` /rsync-  .log
```


# what is this? 

1. create a password
2. chage -d 0 <user>
3. send template email

other strategy is to use the users uid as the password , and then just take a screenshot of the users .. see what Fred did

# datarec ; recdata

/RECdata 
/<user>/<patientID>/<plan_ID>/<beamID>/<fractionID>/here is zipped csv and xdr files

archiving script for RECData

/RECData/test move to /FS_bkup on mcbackup  /tmp_xxx

# socks proxy 

ssh -D 8888 user@host 
then use socks proxy in firefox

# Infrastructure ; network equipment

check fibers
verify have lights on ports
compare status of 1 and 2 ; cabels sames as cnode2



# ssh ; key sync

Sorting out users on NIS

log in as NIS from local ?
	- yes: log in as root from local? 
		- yes: view/compare the file from svn with local file, authorized_keys ; ssh_copy_id -i authorized_keys <server>  (but need to check the users first!)
		- no: login with nis from local , then su then scp the authorized_keys file
	- no: try root to mcrs3
		- yes: set up NIS users
		- no: get someone to set you up with login (then set up NIS users)


# trxt12 ; raspberyy pi image

where does one download the latest trxt12 image ? 

On Frederic M temp folder

Or 

README.md · master · PDG / Auto Config TRXT · GitLab (goiba.net)
\\t36.goiba.net\Public\trxt12-buster-20210315.img

# stop a raspberry pi going to sleep 

install xscreensaver  

launch xcreensaver from command line 

gui pops up 

then in mode, select disable screeen saver. 

# bug 110163 # VNC server

Start vcnserver on mcrw1:

x11vnc -display :0.0 -clip 3840x1080+0+1080 -autoport 5910 -bg -forever -shared -noxfixes -noxrecord -noxdamage -xwarppointer 

x11vnc -display :0.0 -clip 3840x1080+0+0 -autoport 5911 -bg -forever -shared -noxfixes -noxrecord -noxdamage -xwarppointer  

Port should be open on mcrw1; or firewall down.

but leave out the "-bg" so it will print messages to the screen  
or:

> -o /tmp/x11vnc.log

When i reran the command (after killing the process), it ran without a password set 
and now can connect to it

> ' warning , you are running x11vnc without a password' 

# VNC client

Clients: xtightvncviewer; realvnc-vnc-viewer  

Is it installed?

`apt search xtightvnc` 

`apt install xtightvncviewer`

Run with vncviewer command:

`vncviewer cgcu-ctrl1`

From vnc client to vnc server running on mcrw1:

`vncviewer mcrw1:5910`

mcrw1 has more than one display that you can VNC to, so more than one port is used  
Asks for password

Config and log files:

Directory ~/.vnc on the client (e.g. pi) 

> config.d

> identities

> ViewerStore

> vncviewer.log

KDE 4 mcrw1 :

Command for starting the vnc server is in ~/.kde4/Autostart/vncservers ?  

there is nothing in the clinical users Autostart folder 

KDE 5 mcrw1  (e.g. Reading) : 

~/.config/autostart-scripts  

KDE framework version: 5.45 

KDE Plasma version: 5.12 

i see -passwd F15 at the end of the command !! 

x11vnc is the server 

vncviewer is the viewer/client

vncviewer mcrw1:5910 -passwd F15  

shows the same on ps 

'you can create an x11vnc password file by running:' 

`x11vnc -storepasswd password /path/to/passfile`

# vnc ; Providing password on stdin

echo "ibapass" | vncviewer picoscope::5900 -autopass


# Caen pi for vnc (mcrxt1)

desktop shortcuts: 

clinical@mcrxt1:~/Desktop $ cat vnc-cgcu.desktop  

```
[Desktop Entry] 

Encoding=UTF-8 

Name=VNC to CGCU 

GenericName=VNC to CGCU 

Comment=VNC to the CGCU 

Exec=vncviewer 10.2.61.92 

Type=Application 

Icon=/usr/share/icons/hicolor/48x48/apps/vncserver48x48.png 

Terminal=false 
```

clinical@mcrxt1:~/Desktop $ ls vnc

> vnc-cgcu.desktop

> vnc-cnsh.desktop

> vnc-lynx.desktop

> vnc-picoscope.desktop

> vnc-tcrw1.desktop

> vnc-wmebcu.desktop

> vnc-xcu.desktop 

# vnc ; Miscellaneous

echo "ibapass" | vncviewer picoscope::5900 -autopass

clinical@mcrxt1:~ $ apt search xtightvncviewer 


on mcrw1, what's the output of "ps -ef | grep x11vnc" ?  

clinical  2099     1  0 May19 ?        00:03:05 x11vnc -display :0.0 -clip 3840x1080+0+1080 -autoport 5910 -bg -forever -shared -noxfixes -noxrecord -noxdamage -xwarppointer 

clinical  2177     1  0 May19 ?        00:03:05 x11vnc -display :0.0 -clip 3840x1080+0+0 -autoport 5911 -bg -forever -shared -noxfixes -noxrecord -noxdamage -xwarppointer  

do you have ~/.vnc/passwd file?  

do you have ~/.vnc/passwdfile file?  

yep it says 'VNC Viewer - Authentication' vnc server: mcrw1.ppi-rcctv.org:5910     ,,   and has username blanked out , only asking for password 

vnc connection to the CUs is possible from other computers?  
  
from mcrw1?  
  
yep no problem to xcu from mcrw

-- i only put the xcu ip address and not a port such as 5910 

how did you know that mcrw1 requires a port specifying? 

it's like that on all sites  
  
mcrw1 has more than one display that you can VNC to, so more than one port is used  

why they chose to have them all be non-standard.. i dunno  

the "-autoport 5910" part of the command configures that  
  
does mcrw1 have a different xtightvnc version? (zypper search vnc)  

that command returns dozens of packages with vnc in them --  the vnc viewer is called tigervnc 

i suppose you could try tigervnc on your pi  

am installing tiger vnc on mcr-pi 
  
it's already installed at caen  

vncviewer-tigervnc  

nevermind, i was looking at mcrw1, it's not already installed at caen on the pi  

yeah, and wierdly i can't seem to install it on the pi 

realvnc-vnc-viewer seems to be available in the repository at caen, you can try that one..  

ok, thanks but that is the one i have already been using unsuccessfully on pi... 

your mcrtx1 pi at Caen .. 

i thought you were using xtightvncviewer ?  

you can ping the CUs, right?  

is there a rule on the remote vnc saying which ips can connect  -- 

or something specified in mcrouter ? 

or a maximum number of vnc connection allowed somewhere ? 

-- i don't think any of those but  

that's easy to check on mcrw1, from the command you sent me i don't see any restrictions  

only the "-clip " options differs from what is present at caen  

i don't know how to check that on the CUs, but i doubt it would differ between sites..  

it seems anything trying to connect to mcrw1 is asking for vnc server password 

you didn't find anything under ~/.vnc/ ?  

but the problem for the CUs different in that can connect to them from mcrw1 but not my pi 

only on home folder of tcs there was  

password file  

inside it is gobbldegook encrypted word 

and it seems to connect to the CUs, but is disconnected immediately  

mcrw1 can connect fine but my pi seems to connect for a microsecond -- 

before saying trying to reconnect 

and you checked the home folder of clinical as well, right?  

yep nothing in that home folder 

and you tried "ibapass", "tcs", madness ?  

think so , will quickly try again 

tried all, including root password, all fail 

for mcrw1, one more idea is to manually start the server, then try to connect to it  

you may see some error message in the terminal  

sorry to ask again, but you confirm you've tried both xtightvncviewer, and realvnc-vnc-viewer on the pi?  

maybe silly question -- but    so to try xtightvncviewer how do i do that  

with "apt search xtightvnc", you can check whether it has "installed" printed next to it  

pressing raspberry pi icon , then internet  it shows  something called  VNC Viewer -- 

which i believe is RealVnc 

but there is no tight vnc icon in the 'start menu' 

at caen, only one of them is installed  

so it doesn't have installed printed  

ok, good  

apt install xtightvncviewer  

installing now 

maybe it will uninstall the realvnc one?  

automatically  

yes i think it did 

but where do i find the tightvncviewer ?? 

i would just type "vncviewer cgcu-ctrl1" ..  

ok , a miracle !! 

is there not a gui for tightvnc ? 

at caen, i made some desktop shortcuts: 

clinical@mcrxt1:~/Desktop $ cat vnc-cgcu.desktop  

[Desktop Entry] 

Encoding=UTF-8 

Name=VNC to CGCU 

GenericName=VNC to CGCU 

Comment=VNC to the CGCU 

Exec=vncviewer 10.2.61.92 

Type=Application 

Icon=/usr/share/icons/hicolor/48x48/apps/vncserver48x48.png 

Terminal=false 

clinical@mcrxt1:~/Desktop $   

ah cool, so you made a bunch of shortcuts on the desktop to the various cus? 

yes  

please may i have the list of tings you have shortcuts to ?? if that not too cheeky :) 

then i can quickly set them up here for the guys in morn 

will check mcrw1 

` clinical@mcrxt1:~/Desktop $ ls vnc*    `

vnc-cgcu.desktop  vnc-cnsh.desktop  vnc-ENGIE.desktop  vnc-lynx.desktop  vnc-picoscope.desktop  vnc-tcrw1.desktop  vnc-wmebcu.desktop  vnc-xcu.desktop 

i dunno how that ENGIE one got there.. it's a copy of the xcu one  

it works to mcrw1 too?  

still asks for darn password when doing vncviewer mcrw1:5910 

-- but i can maybe find out who did the install and ask them 

how do i connect to the server on mcrw1 ? like you suggested ? 

you mean how to restart vcnserver on mcrw1 manually?  

you already sent me the command to start it: 

but leave out the "-bg" so it will print messages to the screen  
  
ok so kill the process u think first? 

yes  

alternatively, you could do "-o /tmp/x11vnc.log" if it spams your terminal too much  

do you have anything in ~/.vnc/ on the pi?  

config.d   identities  ViewerStore   vncviewer.log 

vncviewer.log, that could be interesting  

great, when i reran the command (after killing) it ran it without a password set .. 

and now can connect to it , ahhh relief 

strange..  

' warning , you are running x11vnc without a password' 

you used the same command as in ~/.kde4/Autostart/vncservers ?  

'you can create an x11vnc password file by running:' 

x11vnc -storepasswd password /path/to/passfile 

you started it as clinical user?  

yerp 

there's something we don't understand.. maybe this will recur the next time it autostarts  

there is nothing in the clinical users Autostart folder 

either the autostart folder is somewhere else (you have something newer than KDE4?) or you haven't installed the accesspoint for clinical yet  

KDE framework version: 5.45 

KDE Plasma version: 5.12 

~/.config/autostart-scripts  

the Autostart folder is in the right place but nothing is inside it -- 

ah sure 

i see -passwd F15 at the end of the command !! 

ok, interesting  

the man page said that would show up in the output of the ps command, and therefore shouldn't be used..  

hm , man page perhaps wrong 

hmm but it would show up in ps 

i don't understand the mechanism the accesspoint uses for autostart with kde5  

but you can manually start x11vnc viewer with that -passwd flag, and see if it shows up in the output of "ps"  

i guess it won't, and that would explain everything  

yes i think the x11vnc program is hiding the password parameter -- trying it now  

there is an x11vnc viewer ? 

i think it is just a server ? 

x11vnc is the server, vncviewer is the viewer  

vncviewer mcrw1:5910 -passwd F15        

shows the same on ps 

so i don't know if one of the parameters -noxrecord -noxdamage  -shared   has an effect on hiding the password  --  

don't know but i think i have enough now to set up the pi with all the different servers 

ok  

do you have 2 status panels in your TR ? 

i'm not at caen, i don't remember  

it's up to the customer usually, they like to make their own decisions about the TR  

in Newcastle they use KVMs  but here they are trying to use vnc to vnc to the one next to the booth from the one on the back wall 

sure ok ,, also here the back wall mosaiq screen is off --  

but customer has not asked about it - yet 

is mosaiq iba's responsibility there?  

no , but it is a bit of a grey area -- we put in the screen during installation and therefore i think are expected to get it working on the screen -- but again i think it perhaps is a customer issue  

because it comes from their Mosaiq sequencer 

VNC

On mcrw1, in /tcs_usr/clinical/.kde4/Autostart/VNC

have changed this to F10---

# vcenter ; Install vsphere client on laptop 

![](2021-11-18-13-05-01.png)

![](2021-11-18-13-05-19.png)

# Vcenter ; command line

https://kb.vmware.com/s/article/2109887

to stop start services such as vsphere-client on vcenter

```
cd /bin
service-control --[stop|start] <servicename>
service-control --list
regenerate certificates
```

## Vcenter version 5: 

For normal tasks use the vsphere client on laptop. 

For configuring replication , use flash with the web gui

Right click on the VM and choose the option: All vSphere Replication Actions -> Configure Replication.

## Vcenter version 6.5

Username: administrator@sitedomain.org or administrator@vsphere.local

Password: root site password

still use flash for doing replication

## Vcenter version 6.7

Can use html5 instead of flash

Same credentials as version 6.5

For replications , use https://replication.sitedomain.org/dr
menu:  view details -> Replications tab -> New

## vcenter certificates

service-control --list

regenerate certificates

# wifi ; in f09

![Floorplan of f09](files/2021-11-24-12-37-15.png)

Floorplan with existing (Green) and proposed (yellow) AP positions for Newport.

# wifi ; in f10 

Copy f09 wifi floorplan 

[Xiongjun has a project management spread sheet in Teams](https://iba2016.sharepoint.com/sites/RemoteMonitoring/Shared%20Documents/Wifi/WIFI%20Devices%20All%20Sites.xlsx?d=w1a2e45c76fee46c1a891352cc633240e&csf=1&web=1&e=46ThOR)

[BOM](https://1drv.ms/x/s!AqllzKE5rB-Dh4ZQQJtGBHPktkyU6g)

[Question] are we going to make up our own ethernet cables ? 

[Question] cat 6 cabling :  do we have enough cables ?  appropriate lengths ? 

[Question] Fibre optic cables needed ?  only if > 100m cable run ?  in which case prob not 

[Question] this office switch already has PoE ?  

[Question] what model is this office switch ? (Aruba PoE+ switch ; 2530 8G PoE+ ? )

Aruba SPF Modules for PoE+ Switch	Aruba	J4858D	2	86.21	172.42	2 per switch

[Question] these SPF modules mentioned in the bom , they are only if using fibre optic ? 

Aruba Antenna	Aruba	AP-ANT-1W	 	 	 	3 per access point

[Question] There are 3 antennae per aruba ?   so that is 7 x 3 = 21 antennae ?  shouldn't there only be antennae for the HP wap ? and isn't there only 2 per wap , not 3 ? 

Cat 6 termination tools

[Question] what are these termination tools ? is this only if making up the cables ? 

LC Duplex connectors

[Question] what are these Duplex connectors ? are they needed ? they are included in the delivered kit ? 

cat 6 patch cables

[Question] how many of these do we need ? do we already have some ? 

LC Duplex connectors

![equipment](files/2021-11-24-12-37-03.png)

Can reuse an AP if is is Aruba IAP-304 [Question] are the arubas on site of this type ? what if they are different ?  we can keep them installed ?  and maybe appropriate in to the office network ? 

[Question] external antenna for the vault on the BOM? 

[Question] Is the planning complete ?  the final arrangement of waps ? 

[Question] Is the coverage adequate?  wifi coverage in vault ?  in treatment room? 

[Question] APs are already configured? By whom? 

![](files/2021-11-24-14-04-45.png)

AP 2 and 7 exist solely to maintain connectivity when moving between areas. 

The new WiFi network will cover 

all areas on site except for: 

gza room (gas room) and 

meeting room.

[Question] Are we hoping to recreate what we already have in terms of coverage ? If so then is 7 APs enough ? 

[Question] we are keeping the APs that are for maintaining connectivity when moving between areas ? Lone working is still an issue? 

[Question] What is the arrangement of APs for the vault ? directly inside the vault? or place AP 1 outside the vault with an antenna going in? AP1 also serves teh gantry pit ? 2 antennae?

[Question] This is for only f10 , when f15 ?   and is Newport getting updated ? 

[Question] PoE?

[Question] Currently the HPv3 phone is set to be 2.4GHz and surrounding attenae to be 5GHz , now with the introduction of the new phones for r12 , perhaps we can flip this config ?  since 5GHz is intended for short distances which makes more sense for the HP? 

[Todo] Find building layout diagrams

[Todo] Draw the current arrangement of APs ; and then the proposed arrangement

Mission WO ; [WO-00166698](https://goiba.lightning.force.com/lightning/r/SVMXC__Service_Order__c/a1T0600000JgveqEAB/view)

Contained in mission WO ; 

[WO-00166698](https://goiba.lightning.force.com/lightning/r/SVMXC__Service_Order__c/a1T0600000JgvelEAB/view)

https://prodg.jira.goiba.net/browse/PSD-1860

# wifi ; To see which wireless access point one is connected to

Open cmd, 

Run netsh wlan show interfaces 

Get the mac address of the wifi AP from BSSID 

It will be useful to know , when a dropout of wifi or internet occurs, which AP you are connected to. 

# wifi ; in f15

It Office network setup 

The Linksys wifi AP has mac (BSSID) address of 58:ef:68:b7:70:1d 

The MCR (above ceiling tiles in the treatment control room) wifi AP has mac (BSSID) address of 90:4c:81:dc:4d:a0 

The TR1 (from the antennae inside the TR) wifi AP has mac (BSSID) address of 38:17:c3:76:60:00 

PLease find in attachment the MID  74838 that is currently being reviewed.  

So, it is not the validated version.  

Would you assess the gap between our installation and the proposed version?  

I think having noticed version of the server is not matching for example, neither some of the given ports.  
Reading No TCS network in the office (kitchen) 

Linksys 12000AC installed in office in port 63. On management LAN. 

Linksys is on 10.3.20.204   and 10.3.20.208

how to configure the aruba waps

Configure the antennae


# Personal ; How to backup and restore WSL2

https://www.virtualizationhowto.com/2021/01/wsl2-backup-and-restore-images-using-import-and-export/

https://www.linuxcapable.com/how-to-install-java-17-lts-jdk-17-on-opensuse-15-leap/How to connect to vibration PC and the Pycpic app

# pcvibration ; Viewing the pycpic app

## Using x server 
Forward the pycpic display to local x server

`ssh vibration@pcvibration.ppi-rccn.org -X`

(passwd: balancing) 

`$ pycpic` 

## Using vnc
vncviewer pcvibration:0  will connect to port 5900 
vncviewer pcvibration:1 will connect to port 5901

-- use pcvibration:1  because 5901 is set up on the pc 

## Run the picoscope app on pcvibration 

`$ picoscope`

If have difficulty logging in directly to pcvibration , can do a ssh hop through nagios.

# pcvibration ; troubleshooting

Seems to confirm that the newer picoscope doesn’t work with the current pycpic setup, worth feeding back to BearingBox_Technical@iba-group.com 

Ok so now seem to have a stable set up 😊  This is it: 

Use the new picoscope with the picoscope pc (which runs windows) . I installed the latest picoscope program from the picotech/downloads website (updating the drivers alone was not enough). 

Then this frees up the old picoscope to be used with the vibration pc (linux openSUSE 15.1) , and we know this works with the pycpic program on that box.  

This is in place now , so I think that is our solution. 
  
So the latest driver for the picoscope was already installed on the vibration pc – from when the pc was first set up. 

However something new I have tried, I installed the latest picoscope application on the vibration pc – as part of this it installs the drivers for all the picoscope models.  

When I ran some vibration acquisitions it worked for the first two but then again returned to the saturated data problem.  

I then opened the picoscope application on the vibration pc, and the signal seemed to drop and then settle after a few seconds, as if running the continuous acquisition was causing it to right itself somehow. 

Then I have ran about 10 acquisitions in a row and it has stayed stable – so I’m tempted to say it is resolved but will hold off saying that at the moment.  

I have set it away acquiring every 10 mins instead of the normal 60 mins and will see if it keeps working today and tomorrow.  

The data is sending fine to Pridex.  

Am on it , hopefully new drivers will fix our issue. 

@Christopher Can you confirm if you have checked this? If not can you please make a point to do it today or tomorrow? 

Newer picoscopes require a newer driver, which still works with the old ones also. An easy way to tell is the USB connection to the scope itself is different. FYI the UK spare picoscope is a newer model. 

What is stopping this from working? Is this the picoscope issue still? 

@Mark had mentioned an issue that he had with the picoscope in Newport? Sorry but I forget the exact issue now – but something to do with the USB drivers maybe? 

Vibration pc setup

Use the new picoscope with the picoscope pc (which runs windows) . I installed the latest picoscope program from the picotech/downloads website (updating the drivers alone was not enough). 

Then this frees up the old picoscope to be used with the vibration pc (linux openSUSE 15.1) , and we know this works with the pycpic program on that box.  

Seems to confirm that the newer picoscope doesn’t work with the current pycpic setup, worth feeding back to BearingBox_Technical@iba-group.com 

Please create a bug for the fact that the new picoscope doesn’t work with the pycpic. What? 

# security ; A local privilege escalation vulnerability 

Where? 

on polkit's pkexec utility. 

How? 

pkexec is a setuid tool

setuid allows unprivileged users to run commands as privileged users

Current version of pkexec has bug which executes environment variables as commands. 

An attacker can make pkexec execute code with priveldged rights. 

Opensuse:

mcrw1, 

tcrwX, 

nagios

gwserver (the Pyramid scanning controller version runs opensuse) 

Debian:

mcrs4, 

pridex 

SLES15.x 

Some mcbackup 

Non-vulnerable :

SLES11.3 ;  SLES11.4 

gwserver (with Dekimo SC)

Reference :

https://nvd.nist.gov/vuln/detail/CVE-2021-4034

NVD rating: 7.8/10 (high)

 Fix :

chmod 0755 /usr/bin/pkexec

On Suse distributions also: 

edit /etc/permissions.easy and '/etc/permissions.secure'

comment out the 'pkexec' line inside 

or change its mode from '4755' to '0755' 

Otherwise, running 'chkstat' (which may be called by various system utilities, such as RPM-included scripts) could re-open the vulnerability.

 instructions :

G:\My Drive\Work\pkexec-vulnerability-fix

script  :

and the script pkexec-fix.sh

Ticket  :

https://prodg.jira.goiba.net/browse/PSD-2469

# Personal ; svn stuff

Following https://proteome.gs.washington.edu/~frewen/svn-branch-maintanence.html   

First merging pts11 stable branch to f10's trunk; 

svn checkout http://subversion.lln.iba/repos/tc/alcyone/trunk/dev/sites/SBF.110

svn update

Svn status -u

svn log --stop-on-copy http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-11.0-STABLE

Find the first commit in this list returned by previous command:

svn merge --dry-run -r122539:HEAD http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-11.0-STABLE

svn merge -r122539:HEAD http://subversion.lln.iba/repos/tc/alcyone/branches/SBF.110-PTS-11.0-STABLE

## svn renaming a branch

If you made a typo or a similar mistake when naming your new branch, and you want to rename it, is very simple:

svn move http://svn.domain.com/project/branches/old/ http://svn.domain.com/project/branches/new

Remember to switch any working copies of the old branch though:

svn switch http://svn.domain.com/project/branches/new

From <https://blog.tatedavies.com/2015/05/14/rename-a-branch-in-svn/> 

# To sort ; Random pictures

![](files/2021-11-19-13-36-47.png)

![](files/2021-11-19-13-36-55.png)

![](files/2021-11-19-13-37-07.png)

![](files/2021-11-19-13-37-17.png)

![](files/2021-11-19-13-37-26.png)

![](files/2021-11-19-13-37-32.png)

![](files/2021-11-19-13-37-39.png)

![](files/2021-11-19-13-37-45.png)

![](files/2021-11-19-13-37-54.png)

![](files/2021-11-19-13-38-01.png)

![](files/2021-11-19-13-38-07.png)

![](files/2021-11-19-13-38-17.png)

![](files/2021-11-19-13-38-24.png)

![](files/2021-11-19-13-38-37.png)

![](files/2021-11-19-13-38-43.png)

![](files/2021-11-19-13-38-50.png)

![](files/2021-11-19-13-38-56.png)

![](files/2021-11-19-13-39-04.png)

![](files/2021-11-19-13-39-10.png)

![](files/2021-11-19-13-39-16.png)

![](files/2021-11-19-13-39-35.png)

![](files/2021-11-19-13-39-46.png)

![](files/2021-11-19-13-39-52.png)

![](files/2021-11-19-13-39-58.png)

![](files/2021-11-19-13-40-12.png)

![](files/2021-11-19-13-40-21.png)


# passwords

IBA Office ; Keypress  ;  123 

T&D webstorage 

tdgd9789 

ibapass 

webstorage-service.com/member/login.php 

Sequencer 
iPOne013 
rcctvRG2 

Sequencer 
Mosaiq 
IBATV 
pass 

Admin 
MagiX-115-tr1 

## PTS ; r12.1 ;  People to help with the upgrade 

Frederic salmon ; Henri Bourmack ; Pinchard ; Cathy 
 	
# PTS ; r12.1 ; BDSIO ; updating firmware ; Questions

with the b and r modules under the blcu , 

there are two sections that look the same , 

on the left but has profinet calbes , 

on the right has an ethernet cable , 

why there are two? 

only on the left when we had to do the F0 configuration but not the right , why	

the arrows on a b and r , why they have to be in a specific configuration , such as x16 knob at 0 and x0 knob at 1 ; 

they shud only be like this when booting the plc ? or they need to be kept like this , or we shud change them after booted ..	

when should we use simatic .. what is the point of it , e.g. on w/e mentioning look at it , but i don't know what it would tell us , or what to look at ..	

B and r lights and statuses ;   --> MID_48462 	

what do the bdcio b andr modules do	

i'd like to know what the lights mean on the plcs , what it means when they are flashing ; what they are connected to ; how to troubleshoot modbus connection error ; what are the arrows knobs on b and r , what are all the settings for the arrows , 1 .. n fw_ackn etc. , what order do they get started in , does it matter , does the srcu show errors when another plc is in error .. .. when changing blcu do we need to first turn magnets off , what happens if don't , what trips , how to bring the tripped contactors back , what is the tdps	
 
see end of report for these things ;  BB was able to find from wiring diagrams that wmebcu is powered from tdps , wihch means ist is incorrectly wired ,  as it is meant to be powered from cgcu pdc . this means that the tdps needs to be switched on from archestra to bring wmebcu up ;  and in turn srcu needs wmebcu cabinet up because it needs to detect 24v signal from safety plc. 


# Send to site before doing an intervention

- Task

- Jira ticket ID or a SvMax work order

- Software Engineer name

Christopher Finch

- Estimated time to finish the mission

2 hours

- Local team requirements 

Open FW 

Mock treatment

Morning walkthrough

- Impact on the system

No impact on the clinical system.

Toyohashi ; upgrade acu to acuv4 ; to be able to prerform cryo maintenance ; 
upgraded the system ,  it was ok ;  have connection wiht acu 

issue is that everything is blinking in red   (archestra)



10.2.80.36ddfdsfdsd

server/checksum ;  engines ; put EN_ACUSC 1 and 2 to scan state .. 

mid 79818on a switch can find what IP is connected to each port ;  then look up the ip in the hosts file ; 


sh arp


du -m /database/pgsql/data/base/97926/* |sort -rn |head -10

nfsstat -m

nfsstat -rc

iostat -k -h -n 5

 rpcinfo -p mcbackup

 ps -eaf |grep nfs

 ps -eo pcpu,pid,user,args |sort -k 1 -r |head -10

 which sar

 grep -i snapshot /etc/ibatab


as tcsadmin user : 

 ./install PTS 12.2.0-ER9 SBF.110 PTS-12.1e odhalle@iba-group.com

./install PTS 12.2.0-ER8 SBF.110 PTS-12.1e odhalle@iba-group.com

./install PTS 12.2.0-ER8 SBF.110 PTS-12.1e odhalle@iba-group.com

 grep "About" -R *

 ./install BMS 12.2.0-ER14 SBF.110 PTS-12.1e odhalle@iba-group.com

 view /TCS/runtimeStore/log/output/pts-beam-common-process--20220212_184549.log





 cp -r runtime/LookupStore/stability ../../tcs_pts12.2_12thFeb2022/workspace/runtime/LookupStore/

# Network drives
```
C:\Users\ahfjf>wmic path Win32_LogicalDisk Where DriveType="4" get DeviceID, ProviderName
DeviceID  ProviderName
F:        \\F15RCCTVFS1\Finance
K:        \\F15RCCTVFS1\Documentation
M:        \\LLNFS03\Departments
N:        \\LLNFS01\products_data
P:        \\F15RCCTVFS1\Public
U:        \\LLNFS03\Common
V:        \\F15RCCTVFS1\Common
X:        \\LLNFS01\Business_Lines\Particle-Therapy
Y:        \\F15RCCTVFS1\Management
Z:        \\wsl$\Ubuntu-20.04
```
